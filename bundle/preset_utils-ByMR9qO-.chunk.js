import{a6 as e,S as t,v as i,al as s,T as a,g as n,h as o,C as l,j as r,u as d,an as c,ax as h,bf as m,bg as u,bh as p,q as g,y as f,x as I,Y as w,N as v,ap as b,O as x,bi as S,G as E,bj as y,aj as P,a9 as k,bk as C,bl as L,aG as T,bm as N,bn as _,bo as A,bp as R,ao as D,bq as M,_ as V,br as U,bs as W,P as F,c as O,bt as H,bu as q,bv as B,bw as z,bx as j,aB as $,by as G,l as K,bz as J,bA as Z,bB as Y,bC as Q,bD as X,bE as ee,bF as te,Z as ie,w as se,D as ae,bG as ne,i as oe,bH as le,bI as re,bJ as de,e as ce,bK as he,E as me,ai as ue,am as pe,o as ge,U as fe,f as Ie,a5 as we,bL as ve,bM as be,bN as xe,bO as Se,bP as Ee,bQ as ye,bR as Pe,bS as ke,bT as Ce,bU as Le,bV as Te,bW as Ne,F as _e,bX as Ae,bY as Re,bZ as De,b_ as Me,b$ as Ve,c0 as Ue,c1 as We,b2 as Fe,c2 as Oe,c3 as He,c4 as qe,ak as Be,ae as ze,c5 as je,aA as $e,ab as Ge,a$ as Ke,ac as Je,ad as Ze,aN as Ye,b9 as Qe,aO as Xe,ar as et,aw as tt,at as it,ah as st,aa as at,ag as nt,as as ot,aS as lt,b5 as rt,af as dt,c6 as ct,c7 as ht,c8 as mt,c9 as ut,aT as pt,ca as gt,cb as ft,cc as It,cd as wt,ce as vt,cf as bt,cg as xt,ch as St,ci as Et,cj as yt,ck as Pt,cl as kt,cm as Ct,R as Lt,cn as Tt,k as Nt,I as _t,co as At,cp as Rt,cq as Dt,a1 as Mt,cr as Vt,cs as Ut,ct as Wt,cu as Ft,cv as Ot,cw as Ht,cx as qt,cy as Bt,cz as zt,cA as jt,cB as $t,cC as Gt,s as Kt,p as Jt,cD as Zt,cE as Yt,cF as Qt,cG as Xt,cH as ei,cI as ti,cJ as ii,cK as si,cL as ai,cM as ni,cN as oi,cO as li,cP as ri,cQ as di,cR as ci,cS as hi,cT as mi,a7 as ui,cU as pi,cV as gi,cW as fi,cX as Ii,cY as wi,cZ as vi,b as bi,c_ as xi,c$ as Si,d0 as Ei,d1 as yi,d2 as Pi,d3 as ki,d4 as Ci,d5 as Li,d6 as Ti,d7 as Ni,d8 as _i,d9 as Ai,da as Ri,db as Di,dc as Mi,dd as Vi,de as Ui,df as Wi,dg as Fi,dh as Oi,di as Hi,dj as qi,dk as Bi,dl as zi,dm as ji,dn as $i,dp as Gi,dq as Ki,dr as Ji,ds as Zi,dt as Yi,du as Qi,dv as Xi,dw as es,dx as ts,dy as is,dz as ss,dA as as,dB as ns,dC as os,dD as ls,dE as rs,dF as ds,dG as cs,dH as hs,dI as ms,dJ as us,dK as ps,dL as gs,dM as fs,dN as Is,dO as ws,dP as vs,dQ as bs,dR as xs,dS as Ss,dT as Es,dU as ys,dV as Ps,dW as ks,dX as Cs,dY as Ls,dZ as Ts,d_ as Ns,d$ as _s,e0 as As,e1 as Rs,e2 as Ds,e3 as Ms,e4 as Vs,e5 as Us,e6 as Ws,e7 as Fs,e8 as Os,z as Hs,e9 as qs,ea as Bs,eb as zs,ec as js,ed as $s,ee as Gs,ef as Ks,eg as Js,eh as Zs,ei as Ys,ej as Qs,ek as Xs,el as ea,em as ta,en as ia,eo as sa,ep as aa,eq as na,er as oa,es as la,et as ra,eu as da,ev as ca,ew as ha,ex as ma,ey as ua,ez as pa,eA as ga,eB as fa,eC as Ia,eD as wa,eE as va,eF as ba,r as xa,a2 as Sa,eG as Ea,eH as ya,eI as Pa,eJ as ka,eK as Ca,eL as La,eM as Ta,eN as Na,eO as _a,eP as Aa,a0 as Ra,Q as Da,eQ as Ma,eR as Va,eS as Ua,eT as Wa,a3 as Fa,a4 as Oa,eU as Ha}from"./detailed_results-B-MfQter.chunk.js";import{t as qa,M as Ba,T as za,i as ja}from"./index-CuUCtUeR.chunk.js";var $a=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e[e.Launched=3]="Launched",e))($a||{});const Ga={phase:e.Phase1,status:0},Ka={[t.SpecBalanceDruid]:{phase:e.Phase4,status:1},[t.SpecFeralDruid]:{phase:e.Phase4,status:1},[t.SpecFeralTankDruid]:{phase:e.Phase1,status:0},[t.SpecRestorationDruid]:{phase:e.Phase1,status:0},[t.SpecElementalShaman]:{phase:e.Phase4,status:1},[t.SpecEnhancementShaman]:{phase:e.Phase4,status:1},[t.SpecRestorationShaman]:{phase:e.Phase1,status:0},[t.SpecHunter]:{phase:e.Phase4,status:1},[t.SpecMage]:{phase:e.Phase4,status:1},[t.SpecRogue]:{phase:e.Phase4,status:1},[t.SpecTankRogue]:{phase:e.Phase4,status:1},[t.SpecHolyPaladin]:{phase:e.Phase1,status:0},[t.SpecProtectionPaladin]:{phase:e.Phase1,status:0},[t.SpecRetributionPaladin]:{phase:e.Phase4,status:1},[t.SpecHealingPriest]:{phase:e.Phase1,status:0},[t.SpecShadowPriest]:{phase:e.Phase4,status:1},[t.SpecWarlock]:{phase:e.Phase4,status:1},[t.SpecTankWarlock]:{phase:e.Phase4,status:1},[t.SpecWarrior]:{phase:e.Phase4,status:1},[t.SpecProtectionWarrior]:{phase:e.Phase1,status:0}};function Ja(e){return Object.keys(i).map((e=>parseInt(e))).filter((t=>i[t]==e&&Ka[t].status>0))}const Za=5;class Ya{constructor(e,t){this.buffs=s.create(),this.compChangeEmitter=new a,this.buffsChangeEmitter=new a,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=a.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,s.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,i){if(t<0||t>=5)throw new Error("Invalid player index: "+t);i!=this.players[t]&&a.freezeAllAndDo((()=>{const s=this.players[t];if(null!=s&&(s.changeEmitter.off(this.playerChangeListener),s.setParty(null)),null!=i){const s=i.getParty();s&&s.setPlayer(e,i.getPartyIndex(),null),this.players[t]=i,i.changeEmitter.on(this.playerChangeListener),i.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return s.clone(this.buffs)}setBuffs(e,t){s.equals(this.buffs,t)||(this.buffs=s.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return n.create({players:this.players.map((i=>null==i?o.create():i.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||s.create());for(let i=0;i<5;i++){if(!t.players[i]||t.players[i].class==l.ClassUnknown){this.setPlayer(e,i,null);continue}const s=t.players[i],a=r(s),n=this.players[i];if(n&&a==n.spec)n.fromProto(e,s);else{const t=new Pn(a,this.sim);t.fromProto(e,s),this.setPlayer(e,i,t)}}}))}}const Qa=d(c).length,Xa=d(h).length;class en{constructor(e,t){this.stat=e,this.pseudoStat=t}isStat(){return null!=this.stat}isPseudoStat(){return null!=this.pseudoStat}getStat(){if(!this.isStat())throw new Error("Not a stat!");return this.stat}getPseudoStat(){if(!this.isPseudoStat())throw new Error("Not a pseudo stat!");return this.pseudoStat}equals(e){return this.stat==e.stat&&this.pseudoStat==e.pseudoStat}getName(e){return this.isStat()?m(this.stat,e):u.get(this.pseudoStat)}getProtoValue(e){return this.isStat()?e.stats[this.stat]:e.pseudoStats[this.pseudoStat]}setProtoValue(e,t){this.isStat()?e.stats[this.stat]=t:e.pseudoStats[this.pseudoStat]=t}static fromStat(e){return new en(e,null)}static fromPseudoStat(e){return new en(null,e)}static getAll(){const e=d(c).filter((e=>![c.StatEnergy,c.StatRage].includes(e))),t=d(h);return[e.map((e=>en.fromStat(e))),t.map((e=>en.fromPseudoStat(e)))].flat()}}class tn{constructor(e,t){this.stats=tn.initStatsArray(Qa,e),this.pseudoStats=tn.initStatsArray(Xa,t)}static initStatsArray(e,t){let i=t?.slice(0,e)||[];i.length<e&&(i=i.concat(new Array(e-(t?.length||0)).fill(0)));for(let s=0;s<e;s++)null==i[s]&&(i[s]=0);return i}equals(e){return this.stats.every(((t,i)=>t==e.getStat(i)))&&this.pseudoStats.every(((t,i)=>t==e.getPseudoStat(i)))}getStat(e){return this.stats[e]}getPseudoStat(e){return this.pseudoStats[e]}getUnitStat(e){return e.isStat()?this.stats[e.getStat()]:this.pseudoStats[e.getPseudoStat()]}withStat(e,t){const i=this.stats.slice();return i[e]=t,new tn(i,this.pseudoStats)}withPseudoStat(e,t){const i=this.pseudoStats.slice();return i[e]=t,new tn(this.stats,i)}withUnitStat(e,t){return e.isStat()?this.withStat(e.getStat(),t):this.withPseudoStat(e.getPseudoStat(),t)}addStat(e,t){return this.withStat(e,this.getStat(e)+t)}addPseudoStat(e,t){return this.withPseudoStat(e,this.getPseudoStat(e)+t)}add(e){return new tn(this.stats.map(((t,i)=>t+e.stats[i])),this.pseudoStats.map(((t,i)=>t+e.pseudoStats[i])))}subtract(e){return new tn(this.stats.map(((t,i)=>t-e.stats[i])),this.pseudoStats.map(((t,i)=>t-e.pseudoStats[i])))}scale(e){return new tn(this.stats.map(((t,i)=>t*e)),this.pseudoStats.map(((t,i)=>t*e)))}computeEP(e){let t=0;return this.stats.forEach(((i,s)=>{t+=i*e.stats[s]})),this.pseudoStats.forEach(((i,s)=>{t+=i*e.pseudoStats[s]})),t}belowCaps(e){for(const[t,i]of this.stats.entries())if(e.stats[t]>0&&i>e.stats[t])return!1;return!0}asArray(){return this.stats.slice()}toJson(){return p.toJson(this.toProto())}toProto(){return p.create({stats:this.stats.slice(),pseudoStats:this.pseudoStats.slice()})}static fromJson(e){return tn.fromProto(p.fromJson(e))}static fromMap(e,t){const i=new Array(Qa).fill(0);Object.entries(e).forEach((e=>{const[t,s]=e;i[Number(t)]=s}));const s=new Array(Xa).fill(0);return t&&Object.entries(t).forEach((e=>{const[t,i]=e;s[Number(t)]=i})),new tn(i,s)}static fromProto(e){return e?new tn(e.stats,e.pseudoStats):new tn}}class sn extends g{constructor(e,t){const i=I();super(e,"copy-button",f("button",{className:`btn ${t.extraCssClasses?.join(" ")??""}`,ref:i},f("i",{className:"fas fa-copy me-1"}),t.text??"Copy to Clipboard")),this.config=t;const s=i.value;let a=!1;s.addEventListener("click",(()=>{if(a)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{a=!0,navigator.clipboard.writeText(e);const t=s.innerHTML;s.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout((()=>{s.innerHTML=t,a=!1}),1500)}})),t.tooltip&&qa(s,{content:t.tooltip})}}class an extends w{constructor(e,t,i){super(e,"talents-picker-root",t,i),this.config=i,this.pointsPerRow=i.pointsPerRow,this.numRows=Math.max(...i.trees.map((e=>e.talents.map((e=>e.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...i.trees.map((e=>e.talents.map((e=>e.location.colIdx)).flat())).flat())+1;const s=()=>t.getLevel()-9;this.maxPoints=s();const n=()=>this.maxPoints-t.getTalentTreePoints().reduce(((e,t)=>e+t),0),o=I(),l=I(),r=I(),d=I(),c=I();this.rootElem.appendChild(f("div",{className:"talents-picker-inner"},f("div",{className:"talents-picker-header"},f("div",{className:"d-flex"},f("label",null,"Points Remaining:",f("span",{ref:o},n()))),f("div",{className:"talents-picker-actions",ref:l})),f("div",{id:"talents-carousel",className:"carousel slide"},f("div",{className:"carousel-inner",ref:r}),f("button",{className:"carousel-control-prev",type:"button",ref:d},f("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),f("span",{className:"visually-hidden"},"Previous")),f("button",{className:"carousel-control-next",type:"button",ref:c},f("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),f("span",{className:"visually-hidden"},"Next")))));const h=r.value,m=d.value,u=c.value;a.onAny([t.levelChangeEmitter,t.talentsChangeEmitter]).on((()=>{this.setMaxPoints(s()),o.value.textContent=`${n()}`})),new sn(l.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>t.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.trees=i.trees.map(((e,t)=>{const s=document.createElement("div");return h.appendChild(s),s.classList.add("carousel-item"),1===t&&s.classList.add("active"),new nn(s,e,this,i.klass,t)})),this.trees.forEach((e=>e.talents.forEach((e=>e.setPoints(0,!1)))));let p=0;m.addEventListener("click",(()=>{p>=1||(p+=1,h.style.transform=`translateX(${33.3*p}%)`,h.children[Math.abs(p-2)%3].classList.remove("active"),h.children[Math.abs(p-1)%3].classList.add("active"))})),u.addEventListener("click",(()=>{p<=-1||(p-=1,h.style.transform=`translateX(${33.3*p}%)`,h.children[Math.abs(p)%3].classList.remove("active"),h.children[Math.abs(p)+1].classList.add("active"))})),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((e=>e.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(e){const t=e.split("-");this.trees.forEach(((e,i)=>e.setTalentsString(t[i]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((e=>e.update()))}get numPoints(){return v(this.trees.map((e=>e.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(e){e!=this.maxPoints&&(this.maxPoints=e,this.updateTrees())}}class nn extends g{constructor(e,t,i,s,n){super(e,"talent-tree-picker-root"),this.config=t,this.numPoints=0,this.picker=i,this.rootElem.appendChild(f(x,null,f("div",{className:"talent-tree-header"},f("img",{src:b(s,n),className:"talent-tree-icon"}),f("span",{className:"talent-tree-title"}),f("label",{className:"talent-tree-points"}),f("button",{className:"talent-tree-reset btn btn-link link-danger"},f("i",{className:"fa fa-times"}))),f("div",{className:"talent-tree-background"}),f("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${t.backgroundUrl}')`;const o=this.rootElem.querySelector(".talent-tree-main");o.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,o.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const l="3.5rem";o.style.height=`calc(${l} * ${this.picker.numRows})`,o.style.maxWidth=`calc(${l} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${l} * ${this.picker.numCols+2})`,this.talents=t.talents.map((e=>new ln(o,e,this))),this.talents.forEach((e=>{e.config.prereqLocation&&this.getTalent(e.config.prereqLocation).config.childLocations.push(e.config.location)}));const r=(e,t)=>{e.initChildReqs(),e.zIndex=t;for(const i of e.config.childLocations){const s=this.getTalent(i);s.parentReq=e.getChildReqArrow(i),r(s,t-2)}};for(const a of this.talents)0!=a.config.childLocations.length&&void 0===a.config.prereqLocation&&r(a,20);const d=this.rootElem.querySelector(".talent-tree-reset");qa(d,{content:"Reset talent points"}),d.addEventListener("click",(e=>{this.talents.forEach((e=>e.setPoints(0,!1))),this.picker.inputChanged(a.nextEventID())}))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.getMaxSpendablePoints()}`,this.talents.forEach((e=>e.update()))}getTalent(e){const t=this.talents.find((t=>t.getRow()==e.rowIdx&&t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return this.talents.map((e=>String(e.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(e){this.talents.forEach(((t,i)=>t.setPoints(Number(e.charAt(i)),!1)))}getMaxSpendablePoints(){return this.picker.maxPoints}}class on extends g{constructor(e,t,i){super(e,"talent-picker-req-arrow",document.createElement("div")),this.zIdx=0,this.parentLoc=t,this.childLoc=i,this.rootElem.style.gridRow=String(t.rowIdx+1),this.rootElem.style.gridColumn=String(t.colIdx+1);let s=Math.max(t.rowIdx,i.rowIdx)+1,a=Math.max(t.colIdx,i.colIdx)+1;t.rowIdx==i.rowIdx?(this.dir=t.colIdx<i.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(t.colIdx-i.colIdx)),a="left"==this.dir?a+1:a-1):t.colIdx==i.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(t.rowIdx-i.rowIdx)),s+=1):(this.dir=t.colIdx<i.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(t.colIdx-i.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(t.rowIdx-i.rowIdx)),s+=1,a="rightdown"==this.dir?a+1:a-1,this.rootElem.appendChild(f("div",null))),this.rootElem.style.gridRowEnd=String(s),this.rootElem.style.gridColumnEnd=String(a),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(e)}setReqFufilled(e){e?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class ln extends g{constructor(e,t,i){super(e,"talent-picker-root",document.createElement("a")),this.config=t,this.tree=i,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay),this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(a.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{if(e.preventDefault(),null==this.longTouchTimer)return;clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;let t=this.getPoints()+1;this.config.maxPoints<t&&(t=0),this.setPoints(t,!0),this.tree.picker.inputChanged(a.nextEventID())})),this.rootElem.addEventListener("mousedown",(e=>{S(e)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(a.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const e of this.config.childLocations)this.childReqs.push(new on(this.rootElem.parentElement,this.config.location,e))}getChildReqArrow(e){for(const t of this.childReqs)if(t.childLoc===e)return t;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx);for(const t of this.childReqs)t.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const e=Number(this.rootElem.dataset.points);return isNaN(e)?0:e}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(e){const t=this.getPoints();if(e>t){const i=e-t;if(this.tree.picker.numPoints+i>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const i=t-e,s=[...Array(this.tree.picker.numRows).keys()].map((e=>this.tree.talents.filter((t=>t.getRow()==e)))).map((e=>v(e.map((e=>e.getPoints())))));s[this.getRow()]-=i;const a=s.map(((e,t)=>v(s.slice(0,t+1))));if(!this.tree.talents.every((e=>0==e.getPoints()||0==e.getRow()||a[e.getRow()-1]>=e.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const e of this.config.childLocations)if(this.tree.getTalent(e).getPoints()>0)return!1}return!0}setPoints(e,t){const i=this.getPoints();if(e=Math.max(0,e),e=Math.min(this.config.maxPoints,e),t&&!this.canSetPoints(e))return;this.tree.numPoints+=e-i,this.rootElem.dataset.points=String(e),this.pointsDisplay.textContent=e+"/"+this.config.maxPoints,this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const s=this.getSpellIdForPoints(e);E.fromSpellId(s).fill().then((e=>{e.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${e.iconUrl}')`}))}getSpellIdForPoints(e){const t=Math.max(0,e-1);if(this.config.spellIds[t])return this.config.spellIds[t];throw new Error(`No rank ${e} for talent ${String(this.config.fieldName)}`)}update(){const e=this.canSetPoints(this.getPoints()+1);e?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(e||this.isFull())}}function rn(e){return e.forEach((e=>{e.talents.forEach(((t,i)=>{if(t.childLocations=[],0!=i){const s=e.talents[i-1];if(t.location.rowIdx<s.location.rowIdx||t.location.rowIdx==s.location.rowIdx&&t.location.colIdx<=s.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fieldName)}`)}if(t.spellIds.length<t.maxPoints){let e=t.spellIds[t.spellIds.length-1];for(let i=t.spellIds.length;i<t.maxPoints;i++)e++,t.spellIds.push(e)}}))})),e}const dn=rn([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/283.jpg",talents:[{fieldName:"improvedWrath",location:{rowIdx:0,colIdx:0},spellIds:[16814,16815,16816,16817,16818],maxPoints:5},{fieldName:"naturesGrasp",location:{rowIdx:0,colIdx:1},spellIds:[16689],maxPoints:1},{fieldName:"improvedNaturesGrasp",location:{rowIdx:0,colIdx:2},spellIds:[17245,17247,17248,17249],maxPoints:4,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedEntanglingRoots",location:{rowIdx:1,colIdx:0},spellIds:[16918,16919,16920],maxPoints:3},{fieldName:"improvedMoonfire",location:{rowIdx:1,colIdx:1},spellIds:[16821,16822,16823,16824,16825],maxPoints:5},{fieldName:"naturalWeapons",location:{rowIdx:1,colIdx:2},spellIds:[16902,16903,16904,16905,16906],maxPoints:5},{fieldName:"naturalShapeshifter",location:{rowIdx:1,colIdx:3},spellIds:[16833,16834,16835],maxPoints:3},{fieldName:"improvedThorns",location:{rowIdx:2,colIdx:0},spellIds:[16836,16839,16840],maxPoints:3},{fieldName:"omenOfClarity",location:{rowIdx:2,colIdx:2},spellIds:[16864],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"naturesReach",location:{rowIdx:2,colIdx:3},spellIds:[16819,16820],maxPoints:2},{fieldName:"vengeance",location:{rowIdx:3,colIdx:1},spellIds:[16909,16910,16911,16912,16913],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedStarfire",location:{rowIdx:3,colIdx:2},spellIds:[16850,16923,16924,16925,16926],maxPoints:5},{fieldName:"naturesGrace",location:{rowIdx:4,colIdx:1},spellIds:[16880],maxPoints:1},{fieldName:"moonglow",location:{rowIdx:4,colIdx:2},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"moonfury",location:{rowIdx:5,colIdx:1},spellIds:[16896,16897,16899,16900,16901],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"moonkinForm",location:{rowIdx:6,colIdx:1},spellIds:[24858],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/281.jpg",talents:[{fieldName:"ferocity",location:{rowIdx:0,colIdx:1},spellIds:[16934,16935,16936,16937,16938],maxPoints:5},{fieldName:"feralAggression",location:{rowIdx:0,colIdx:2},spellIds:[16858,16859,16860,16861,16862],maxPoints:5},{fieldName:"feralInstinct",location:{rowIdx:1,colIdx:0},spellIds:[16947,16948,16949,16950,16951],maxPoints:5},{fieldName:"brutalImpact",location:{rowIdx:1,colIdx:1},spellIds:[16940,16941],maxPoints:2},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[16929,16930,16931,16932,16933],maxPoints:5},{fieldName:"felineSwiftness",location:{rowIdx:2,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"feralCharge",location:{rowIdx:2,colIdx:1},spellIds:[16979],maxPoints:1},{fieldName:"sharpenedClaws",location:{rowIdx:2,colIdx:2},spellIds:[16942,16943,16944],maxPoints:3},{fieldName:"improvedShred",location:{rowIdx:3,colIdx:0},spellIds:[16966,16968],maxPoints:2},{fieldName:"predatoryStrikes",location:{rowIdx:3,colIdx:1},spellIds:[16972,16974,16975],maxPoints:3},{fieldName:"bloodFrenzy",location:{rowIdx:3,colIdx:2},spellIds:[16952,16954],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"primalFury",location:{rowIdx:3,colIdx:3},spellIds:[16958,16961],maxPoints:2},{fieldName:"savageFury",location:{rowIdx:4,colIdx:0},spellIds:[16998,16999],maxPoints:2},{fieldName:"faerieFireFeral",location:{rowIdx:4,colIdx:2},spellIds:[16857],maxPoints:1},{fieldName:"heartOfTheWild",location:{rowIdx:5,colIdx:1},spellIds:[17003,17004,17005,17006,24894],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"leaderOfThePack",location:{rowIdx:6,colIdx:1},spellIds:[17007],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/282.jpg",talents:[{fieldName:"improvedMarkOfTheWild",location:{rowIdx:0,colIdx:1},spellIds:[17050,17051,17053,17054,17055],maxPoints:5},{fieldName:"furor",location:{rowIdx:0,colIdx:2},spellIds:[17056,17058,17059,17060,17061],maxPoints:5},{fieldName:"improvedHealingTouch",location:{rowIdx:1,colIdx:0},spellIds:[17069,17070,17071,17072,17073],maxPoints:5},{fieldName:"naturesFocus",location:{rowIdx:1,colIdx:1},spellIds:[17063,17065,17066,17067,17068],maxPoints:5},{fieldName:"improvedEnrage",location:{rowIdx:1,colIdx:2},spellIds:[17079,17082],maxPoints:2},{fieldName:"reflection",location:{rowIdx:2,colIdx:1},spellIds:[17106,17107,17108],maxPoints:3},{fieldName:"insectSwarm",location:{rowIdx:2,colIdx:2},spellIds:[5570],maxPoints:1},{fieldName:"subtlety",location:{rowIdx:2,colIdx:3},spellIds:[17118,17119,17120,17121,17122],maxPoints:5},{fieldName:"tranquilSpirit",location:{rowIdx:3,colIdx:1},spellIds:[24968,24969,24970,24971,24972],maxPoints:5},{fieldName:"improvedRejuvenation",location:{rowIdx:3,colIdx:3},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:0},spellIds:[17116],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"giftOfNature",location:{rowIdx:4,colIdx:2},spellIds:[17104,24943,24944,24945,24946],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedTranquility",location:{rowIdx:4,colIdx:3},spellIds:[17123,17124],maxPoints:2},{fieldName:"improvedRegrowth",location:{rowIdx:5,colIdx:2},spellIds:[17074,17075,17076,17077,17078],maxPoints:5},{fieldName:"swiftmend",location:{rowIdx:6,colIdx:1},spellIds:[18562],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),cn=rn([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/361.jpg",talents:[{fieldName:"improvedAspectOfTheHawk",location:{rowIdx:0,colIdx:1},spellIds:[19552,19553,19554,19555,19556],maxPoints:5},{fieldName:"enduranceTraining",location:{rowIdx:0,colIdx:2},spellIds:[19583,19584,19585,19586,19587],maxPoints:5},{fieldName:"improvedEyesOfTheBeast",location:{rowIdx:1,colIdx:0},spellIds:[19557,19558],maxPoints:2},{fieldName:"improvedAspectOfTheMonkey",location:{rowIdx:1,colIdx:1},spellIds:[19549,19550,19551,24386,24387],maxPoints:5},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[19609,19610,19612],maxPoints:3},{fieldName:"improvedRevivePet",location:{rowIdx:1,colIdx:3},spellIds:[24443,19575],maxPoints:2},{fieldName:"pathfinding",location:{rowIdx:2,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"bestialSwiftness",location:{rowIdx:2,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"unleashedFury",location:{rowIdx:2,colIdx:2},spellIds:[19616,19617,19618,19619,19620],maxPoints:5},{fieldName:"improvedMendPet",location:{rowIdx:3,colIdx:1},spellIds:[19572,19573],maxPoints:2},{fieldName:"ferocity",location:{rowIdx:3,colIdx:2},spellIds:[19598,19599,19600,19601,19602],maxPoints:5},{fieldName:"spiritBond",location:{rowIdx:4,colIdx:0},spellIds:[19578,20895],maxPoints:2},{fieldName:"intimidation",location:{rowIdx:4,colIdx:1},spellIds:[19577],maxPoints:1},{fieldName:"bestialDiscipline",location:{rowIdx:4,colIdx:3},spellIds:[19590,19592],maxPoints:2},{fieldName:"frenzy",location:{rowIdx:5,colIdx:2},spellIds:[19621,19622,19623,19624,19625],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bestialWrath",location:{rowIdx:6,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/363.jpg",talents:[{fieldName:"improvedConcussiveShot",location:{rowIdx:0,colIdx:1},spellIds:[19407,19412,19413,19414,19415],maxPoints:5},{fieldName:"efficiency",location:{rowIdx:0,colIdx:2},spellIds:[19416,19417,19418,19419,19420],maxPoints:5},{fieldName:"improvedHuntersMark",location:{rowIdx:1,colIdx:1},spellIds:[19421,19422,19423,19424,19425],maxPoints:5},{fieldName:"lethalShots",location:{rowIdx:1,colIdx:2},spellIds:[19426,19427,19429,19430,19431],maxPoints:5},{fieldName:"aimedShot",location:{rowIdx:2,colIdx:0},spellIds:[19434],maxPoints:1},{fieldName:"improvedArcaneShot",location:{rowIdx:2,colIdx:1},spellIds:[19454,19455,19456,19457,19458],maxPoints:5},{fieldName:"hawkEye",location:{rowIdx:2,colIdx:3},spellIds:[19498,19499,19500],maxPoints:3},{fieldName:"improvedSerpentSting",location:{rowIdx:3,colIdx:1},spellIds:[19464,19465,19466,19467,19468],maxPoints:5},{fieldName:"mortalShots",location:{rowIdx:3,colIdx:2},spellIds:[19485,19487,19488,19489,19490],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"scatterShot",location:{rowIdx:4,colIdx:0},spellIds:[19503],maxPoints:1},{fieldName:"barrage",location:{rowIdx:4,colIdx:1},spellIds:[19461,19462,24691],maxPoints:3},{fieldName:"improvedScorpidSting",location:{rowIdx:4,colIdx:2},spellIds:[19491,19493,19494],maxPoints:3},{fieldName:"rangedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[19507,19508,19509,19510,19511],maxPoints:5},{fieldName:"trueshotAura",location:{rowIdx:6,colIdx:1},spellIds:[19506],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/362.jpg",talents:[{fieldName:"monsterSlaying",location:{rowIdx:0,colIdx:0},spellIds:[24293,24294,24295],maxPoints:3},{fieldName:"humanoidSlaying",location:{rowIdx:0,colIdx:1},spellIds:[19151,19152,19153],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:2},spellIds:[19295,19297,19298,19300,19301],maxPoints:5},{fieldName:"entrapment",location:{rowIdx:1,colIdx:0},spellIds:[19184,19387,19388,19389,19390],maxPoints:5},{fieldName:"savageStrikes",location:{rowIdx:1,colIdx:1},spellIds:[19159,19160],maxPoints:2},{fieldName:"improvedWingClip",location:{rowIdx:1,colIdx:2},spellIds:[19228,19232,19233,19234,19235],maxPoints:5},{fieldName:"cleverTraps",location:{rowIdx:2,colIdx:0},spellIds:[19239,19245],maxPoints:2},{fieldName:"survivalist",location:{rowIdx:2,colIdx:1},spellIds:[19255,19256,19257,19258,19259],maxPoints:5},{fieldName:"deterrence",location:{rowIdx:2,colIdx:2},spellIds:[19263],maxPoints:1},{fieldName:"trapMastery",location:{rowIdx:3,colIdx:0},spellIds:[19376,19377],maxPoints:2},{fieldName:"surefooted",location:{rowIdx:3,colIdx:1},spellIds:[19290,19294,24283],maxPoints:3},{fieldName:"improvedFeignDeath",location:{rowIdx:3,colIdx:3},spellIds:[19286,19287],maxPoints:2},{fieldName:"killerInstinct",location:{rowIdx:4,colIdx:1},spellIds:[19370,19371,19373],maxPoints:3},{fieldName:"counterattack",location:{rowIdx:4,colIdx:2},spellIds:[19306],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"lightningReflexes",location:{rowIdx:5,colIdx:2},spellIds:[19168,19180,19181,24296,24297],maxPoints:5},{fieldName:"wyvernSting",location:{rowIdx:6,colIdx:1},spellIds:[19386],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),hn=rn([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/81.jpg",talents:[{fieldName:"arcaneSubtlety",location:{rowIdx:0,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneFocus",location:{rowIdx:0,colIdx:1},spellIds:[11222,12839,12840,12841,12842],maxPoints:5},{fieldName:"improvedArcaneMissiles",location:{rowIdx:0,colIdx:2},spellIds:[11237,12463,12464,16769,16770],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:1,colIdx:0},spellIds:[6057,6085],maxPoints:2},{fieldName:"magicAbsorption",location:{rowIdx:1,colIdx:1},spellIds:[29441,29444,29445,29446,29447],maxPoints:5},{fieldName:"arcaneConcentration",location:{rowIdx:1,colIdx:2},spellIds:[11213,12574,12575,12576,12577],maxPoints:5},{fieldName:"magicAttunement",location:{rowIdx:2,colIdx:0},spellIds:[11247,12606],maxPoints:2},{fieldName:"improvedArcaneExplosion",location:{rowIdx:2,colIdx:1},spellIds:[11242,12467,12469],maxPoints:3},{fieldName:"arcaneResilience",location:{rowIdx:2,colIdx:2},spellIds:[28574],maxPoints:1},{fieldName:"improvedManaShield",location:{rowIdx:3,colIdx:0},spellIds:[11252,12605],maxPoints:2},{fieldName:"improvedCounterspell",location:{rowIdx:3,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"arcaneMeditation",location:{rowIdx:3,colIdx:3},spellIds:[18462,18463,18464],maxPoints:3},{fieldName:"presenceOfMind",location:{rowIdx:4,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"arcaneMind",location:{rowIdx:4,colIdx:2},spellIds:[11232,12500,12501,12502,12503],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"arcaneInstability",location:{rowIdx:5,colIdx:1},spellIds:[15058,15059,15060],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"arcanePower",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/41.jpg",talents:[{fieldName:"improvedFireball",location:{rowIdx:0,colIdx:1},spellIds:[11069,12338,12339,12340,12341],maxPoints:5},{fieldName:"impact",location:{rowIdx:0,colIdx:2},spellIds:[11103,12357,12358,12359,12360],maxPoints:5},{fieldName:"ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846,12847,12848],maxPoints:5},{fieldName:"flameThrowing",location:{rowIdx:1,colIdx:1},spellIds:[11100,12353],maxPoints:2},{fieldName:"improvedFireBlast",location:{rowIdx:1,colIdx:2},spellIds:[11078,11080,12342],maxPoints:3},{fieldName:"incinerate",location:{rowIdx:2,colIdx:0},spellIds:[18459,18460],maxPoints:2},{fieldName:"improvedFlamestrike",location:{rowIdx:2,colIdx:1},spellIds:[11108,12349,12350],maxPoints:3},{fieldName:"pyroblast",location:{rowIdx:2,colIdx:2},spellIds:[11366],maxPoints:1},{fieldName:"burningSoul",location:{rowIdx:2,colIdx:3},spellIds:[11083,12351],maxPoints:2},{fieldName:"improvedScorch",location:{rowIdx:3,colIdx:0},spellIds:[11095,12872,12873],maxPoints:3},{fieldName:"improvedFireWard",location:{rowIdx:3,colIdx:1},spellIds:[11094,13043],maxPoints:2},{fieldName:"masterOfElements",location:{rowIdx:3,colIdx:3},spellIds:[29074,29075,29076],maxPoints:3},{fieldName:"criticalMass",location:{rowIdx:4,colIdx:1},spellIds:[11115,11367,11368],maxPoints:3},{fieldName:"blastWave",location:{rowIdx:4,colIdx:2},spellIds:[11113],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firePower",location:{rowIdx:5,colIdx:2},spellIds:[11124,12378,12398,12399,12400],maxPoints:5},{fieldName:"combustion",location:{rowIdx:6,colIdx:1},spellIds:[11129],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/61.jpg",talents:[{fieldName:"frostWarding",location:{rowIdx:0,colIdx:0},spellIds:[11189,28332],maxPoints:2},{fieldName:"improvedFrostbolt",location:{rowIdx:0,colIdx:1},spellIds:[11070,12473,16763,16765,16766],maxPoints:5},{fieldName:"elementalPrecision",location:{rowIdx:0,colIdx:2},spellIds:[29438,29439,29440],maxPoints:3},{fieldName:"iceShards",location:{rowIdx:1,colIdx:0},spellIds:[11207,12672,15047,15052,15053],maxPoints:5},{fieldName:"frostbite",location:{rowIdx:1,colIdx:1},spellIds:[11071,12496,12497],maxPoints:3},{fieldName:"improvedFrostNova",location:{rowIdx:1,colIdx:2},spellIds:[11165,12475],maxPoints:2},{fieldName:"permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"piercingIce",location:{rowIdx:2,colIdx:0},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"coldSnap",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"improvedBlizzard",location:{rowIdx:2,colIdx:3},spellIds:[11185,12487,12488],maxPoints:3},{fieldName:"arcticReach",location:{rowIdx:3,colIdx:0},spellIds:[16757,16758],maxPoints:2},{fieldName:"frostChanneling",location:{rowIdx:3,colIdx:1},spellIds:[11160,12518,12519],maxPoints:3},{fieldName:"shatter",location:{rowIdx:3,colIdx:2},spellIds:[11170,12982,12983,12984,12985],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"iceBlock",location:{rowIdx:4,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"improvedConeOfCold",location:{rowIdx:4,colIdx:2},spellIds:[11190,12489,12490],maxPoints:3},{fieldName:"wintersChill",location:{rowIdx:5,colIdx:2},spellIds:[11180,28592,28593,28594,28595],maxPoints:5},{fieldName:"iceBarrier",location:{rowIdx:6,colIdx:1},spellIds:[11426],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),mn=rn([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/382.jpg",talents:[{fieldName:"divineStrength",location:{rowIdx:0,colIdx:1},spellIds:[20262,20263,20264,20265,20266],maxPoints:5},{fieldName:"divineIntellect",location:{rowIdx:0,colIdx:2},spellIds:[20257,20258,20259,20260,20261],maxPoints:5},{fieldName:"spiritualFocus",location:{rowIdx:1,colIdx:1},spellIds:[20205,20206,20207,20208,20209],maxPoints:5},{fieldName:"improvedSealOfRighteousness",location:{rowIdx:1,colIdx:2},spellIds:[20224,20225,20330,20331,20332],maxPoints:5},{fieldName:"healingLight",location:{rowIdx:2,colIdx:0},spellIds:[20237,20238,20239],maxPoints:3},{fieldName:"consecration",location:{rowIdx:2,colIdx:1},spellIds:[26573],maxPoints:1},{fieldName:"improvedLayOnHands",location:{rowIdx:2,colIdx:2},spellIds:[20234,20235],maxPoints:2},{fieldName:"unyieldingFaith",location:{rowIdx:2,colIdx:3},spellIds:[9453,25836],maxPoints:2},{fieldName:"illumination",location:{rowIdx:3,colIdx:1},spellIds:[20210,20212,20213,20214,20215],maxPoints:5},{fieldName:"improvedBlessingOfWisdom",location:{rowIdx:3,colIdx:2},spellIds:[20244,20245],maxPoints:2},{fieldName:"divineFavor",location:{rowIdx:4,colIdx:1},spellIds:[20216],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"lastingJudgement",location:{rowIdx:4,colIdx:2},spellIds:[20359,20360,20361],maxPoints:3},{fieldName:"holyPower",location:{rowIdx:5,colIdx:2},spellIds:[5923,5924,5925,5926,25829],maxPoints:5},{fieldName:"holyShock",location:{rowIdx:6,colIdx:1},spellIds:[20473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/383.jpg",talents:[{fieldName:"improvedDevotionAura",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140,20141,20142],maxPoints:5},{fieldName:"redoubt",location:{rowIdx:0,colIdx:2},spellIds:[20127,20130,20135,20136,20137],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:0},spellIds:[20189,20192,20193],maxPoints:3},{fieldName:"guardiansFavor",location:{rowIdx:1,colIdx:1},spellIds:[20174,20175],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:3},spellIds:[20143,20144,20145,20146,20147],maxPoints:5},{fieldName:"blessingOfKings",location:{rowIdx:2,colIdx:0},spellIds:[20217],maxPoints:1},{fieldName:"improvedRighteousFury",location:{rowIdx:2,colIdx:1},spellIds:[20468,20469,20470],maxPoints:3},{fieldName:"shieldSpecialization",location:{rowIdx:2,colIdx:2},spellIds:[20148,20149,20150],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[20096,20097,20098,20099,20100],maxPoints:5},{fieldName:"improvedHammerOfJustice",location:{rowIdx:3,colIdx:1},spellIds:[20487,20488,20489],maxPoints:3},{fieldName:"improvedConcentrationAura",location:{rowIdx:3,colIdx:2},spellIds:[20254,20255,20256],maxPoints:3},{fieldName:"blessingOfSanctuary",location:{rowIdx:4,colIdx:1},spellIds:[20911],maxPoints:1},{fieldName:"reckoning",location:{rowIdx:4,colIdx:2},spellIds:[20177,20179,20180,20181,20182],maxPoints:5},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[20196,20197,20198,20199,20200],maxPoints:5},{fieldName:"holyShield",location:{rowIdx:6,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/381.jpg",talents:[{fieldName:"improvedBlessingOfMight",location:{rowIdx:0,colIdx:1},spellIds:[20042,20045,20046,20047,20048],maxPoints:5},{fieldName:"benediction",location:{rowIdx:0,colIdx:2},spellIds:[20101,20102,20103,20104,20105],maxPoints:5},{fieldName:"improvedJudgement",location:{rowIdx:1,colIdx:0},spellIds:[25956,25957],maxPoints:2},{fieldName:"improvedSealOfTheCrusader",location:{rowIdx:1,colIdx:1},spellIds:[20335,20336,20337],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:2},spellIds:[20060,20061,20062,20063,20064],maxPoints:5},{fieldName:"vindication",location:{rowIdx:2,colIdx:0},spellIds:[9452,26016,26021],maxPoints:3},{fieldName:"conviction",location:{rowIdx:2,colIdx:1},spellIds:[20117,20118,20119,20120,20121],maxPoints:5},{fieldName:"sealOfCommand",location:{rowIdx:2,colIdx:2},spellIds:[20375],maxPoints:1},{fieldName:"pursuitOfJustice",location:{rowIdx:2,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"eyeForAnEye",location:{rowIdx:3,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"improvedRetributionAura",location:{rowIdx:3,colIdx:2},spellIds:[20091,20092],maxPoints:2},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[20111,20112,20113],maxPoints:3},{fieldName:"sanctityAura",location:{rowIdx:4,colIdx:2},spellIds:[20218],maxPoints:1},{fieldName:"vengeance",location:{rowIdx:5,colIdx:1},spellIds:[20049,20056,20057,20058,20059],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"repentance",location:{rowIdx:6,colIdx:1},spellIds:[20066],maxPoints:1}]}]),un=rn([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/201.jpg",talents:[{fieldName:"unbreakableWill",location:{rowIdx:0,colIdx:1},spellIds:[14522,14788,14789,14790,14791],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14524,14525,14526,14527,14528],maxPoints:5},{fieldName:"silentResolve",location:{rowIdx:1,colIdx:0},spellIds:[14523,14784,14785,14786,14787],maxPoints:5},{fieldName:"improvedPowerWordFortitude",location:{rowIdx:1,colIdx:1},spellIds:[14749,14767],maxPoints:2},{fieldName:"improvedPowerWordShield",location:{rowIdx:1,colIdx:2},spellIds:[14748,14768,14769],maxPoints:3},{fieldName:"martyrdom",location:{rowIdx:1,colIdx:3},spellIds:[14531,14774],maxPoints:2},{fieldName:"innerFocus",location:{rowIdx:2,colIdx:1},spellIds:[14751],maxPoints:1},{fieldName:"meditation",location:{rowIdx:2,colIdx:2},spellIds:[14521,14776,14777],maxPoints:3},{fieldName:"improvedInnerFire",location:{rowIdx:3,colIdx:0},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"mentalAgility",location:{rowIdx:3,colIdx:1},spellIds:[14520,14780,14781,14782,14783],maxPoints:5},{fieldName:"improvedManaBurn",location:{rowIdx:3,colIdx:3},spellIds:[14750,14772],maxPoints:2},{fieldName:"mentalStrength",location:{rowIdx:4,colIdx:1},spellIds:[18551,18552,18553,18554,18555],maxPoints:5},{fieldName:"divineSpirit",location:{rowIdx:4,colIdx:2},spellIds:[14752],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"forceOfWill",location:{rowIdx:5,colIdx:2},spellIds:[18544,18547,18548,18549,18550],maxPoints:5},{fieldName:"powerInfusion",location:{rowIdx:6,colIdx:1},spellIds:[10060],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/202.jpg",talents:[{fieldName:"healingFocus",location:{rowIdx:0,colIdx:0},spellIds:[14913,15012],maxPoints:2},{fieldName:"improvedRenew",location:{rowIdx:0,colIdx:1},spellIds:[14908,15020,17191],maxPoints:3},{fieldName:"holySpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14889,15008,15009,15010,15011],maxPoints:5},{fieldName:"spellWarding",location:{rowIdx:1,colIdx:1},spellIds:[27900,27901,27902,27903,27904],maxPoints:5},{fieldName:"divineFury",location:{rowIdx:1,colIdx:2},spellIds:[18530,18531,18533,18534,18535],maxPoints:5},{fieldName:"holyNova",location:{rowIdx:2,colIdx:0},spellIds:[15237],maxPoints:1},{fieldName:"blessedRecovery",location:{rowIdx:2,colIdx:1},spellIds:[27811,27815,27816],maxPoints:3},{fieldName:"inspiration",location:{rowIdx:2,colIdx:3},spellIds:[14892,15362,15363],maxPoints:3},{fieldName:"holyReach",location:{rowIdx:3,colIdx:0},spellIds:[27789,27790],maxPoints:2},{fieldName:"improvedHealing",location:{rowIdx:3,colIdx:1},spellIds:[14912,15013,15014],maxPoints:3},{fieldName:"searingLight",location:{rowIdx:3,colIdx:2},spellIds:[14909,15017],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedPrayerOfHealing",location:{rowIdx:4,colIdx:0},spellIds:[14911,15018],maxPoints:2},{fieldName:"spiritOfRedemption",location:{rowIdx:4,colIdx:1},spellIds:[20711],maxPoints:1},{fieldName:"spiritualGuidance",location:{rowIdx:4,colIdx:2},spellIds:[14901,15028,15029,15030,15031],maxPoints:5},{fieldName:"spiritualHealing",location:{rowIdx:5,colIdx:2},spellIds:[14898,15349,15354,15355,15356],maxPoints:5},{fieldName:"lightwell",location:{rowIdx:6,colIdx:1},spellIds:[724],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/203.jpg",talents:[{fieldName:"spiritTap",location:{rowIdx:0,colIdx:1},spellIds:[15270,15335,15336,15337,15338],maxPoints:5},{fieldName:"blackout",location:{rowIdx:0,colIdx:2},spellIds:[15268,15323,15324,15325,15326],maxPoints:5},{fieldName:"shadowAffinity",location:{rowIdx:1,colIdx:0},spellIds:[15318,15272,15320],maxPoints:3},{fieldName:"improvedShadowWordPain",location:{rowIdx:1,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"shadowFocus",location:{rowIdx:1,colIdx:2},spellIds:[15260,15327,15328],maxPoints:5},{fieldName:"improvedPsychicScream",location:{rowIdx:2,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",location:{rowIdx:2,colIdx:1},spellIds:[15273,15312,15313,15314,15316],maxPoints:5},{fieldName:"mindFlay",location:{rowIdx:2,colIdx:2},spellIds:[15407],maxPoints:1},{fieldName:"improvedFade",location:{rowIdx:3,colIdx:1},spellIds:[15274,15311],maxPoints:2},{fieldName:"shadowReach",location:{rowIdx:3,colIdx:2},spellIds:[17322,17323,17325],maxPoints:3},{fieldName:"shadowWeaving",location:{rowIdx:3,colIdx:3},spellIds:[15257,15331,15332,15333,15334],maxPoints:5},{fieldName:"silence",location:{rowIdx:4,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"vampiricEmbrace",location:{rowIdx:4,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"improvedVampiricEmbrace",location:{rowIdx:4,colIdx:2},spellIds:[27839,27840],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkness",location:{rowIdx:5,colIdx:2},spellIds:[15259,15307,15308,15309,15310],maxPoints:5},{fieldName:"shadowform",location:{rowIdx:6,colIdx:1},spellIds:[15473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),pn=rn([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/182.jpg",talents:[{fieldName:"improvedEviscerate",location:{rowIdx:0,colIdx:0},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"remorselessAttacks",location:{rowIdx:0,colIdx:1},spellIds:[14144,14148],maxPoints:2},{fieldName:"malice",location:{rowIdx:0,colIdx:2},spellIds:[14138,14139,14140,14141,14142],maxPoints:5},{fieldName:"ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"murder",location:{rowIdx:1,colIdx:1},spellIds:[14158,14159],maxPoints:2},{fieldName:"improvedSliceAndDice",location:{rowIdx:1,colIdx:3},spellIds:[14165,14166,14167],maxPoints:3},{fieldName:"relentlessStrikes",location:{rowIdx:2,colIdx:0},spellIds:[14179],maxPoints:1},{fieldName:"improvedExposeArmor",location:{rowIdx:2,colIdx:1},spellIds:[14168,14169],maxPoints:2},{fieldName:"lethality",location:{rowIdx:2,colIdx:2},spellIds:[14128,14132,14135,14136,14137],maxPoints:5,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"vilePoisons",location:{rowIdx:3,colIdx:1},spellIds:[16513,16514,16515,16719,16720],maxPoints:5},{fieldName:"improvedPoisons",location:{rowIdx:3,colIdx:2},spellIds:[14113,14114,14115,14116,14117],maxPoints:5},{fieldName:"coldBlood",location:{rowIdx:4,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"improvedKidneyShot",location:{rowIdx:4,colIdx:2},spellIds:[14174,14175,14176],maxPoints:3},{fieldName:"sealFate",location:{rowIdx:5,colIdx:1},spellIds:[14186,14190,14193,14194,14195],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"vigor",location:{rowIdx:6,colIdx:1},spellIds:[14983],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/181.jpg",talents:[{fieldName:"improvedGouge",location:{rowIdx:0,colIdx:0},spellIds:[13741,13792,13793],maxPoints:3},{fieldName:"improvedSinisterStrike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863],maxPoints:2},{fieldName:"lightningReflexes",location:{rowIdx:0,colIdx:2},spellIds:[13712,13788,13789,13790,13791],maxPoints:5},{fieldName:"improvedBackstab",location:{rowIdx:1,colIdx:0},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:1},spellIds:[13713,13853,13854,13855,13856],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:2},spellIds:[13705,13832,13843,13844,13845],maxPoints:5},{fieldName:"endurance",location:{rowIdx:2,colIdx:0},spellIds:[13742,13872],maxPoints:2},{fieldName:"riposte",location:{rowIdx:2,colIdx:1},spellIds:[14251],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedSprint",location:{rowIdx:2,colIdx:3},spellIds:[13743,13875],maxPoints:2},{fieldName:"improvedKick",location:{rowIdx:3,colIdx:0},spellIds:[13754,13867],maxPoints:2},{fieldName:"daggerSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[13706,13804,13805,13806,13807],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:2},spellIds:[13715,13848,13849,13851,13852],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[13709,13800,13801,13802,13803],maxPoints:5},{fieldName:"bladeFlurry",location:{rowIdx:4,colIdx:1},spellIds:[13877],maxPoints:1},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[13960,13961,13962,13963,13964],maxPoints:5},{fieldName:"fistWeaponSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[13707,13966,13967,13968,13969],maxPoints:5},{fieldName:"weaponExpertise",location:{rowIdx:5,colIdx:1},spellIds:[30919,30920],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"aggression",location:{rowIdx:5,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"adrenalineRush",location:{rowIdx:6,colIdx:1},spellIds:[13750],maxPoints:1}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/183.jpg",talents:[{fieldName:"masterOfDeception",location:{rowIdx:0,colIdx:1},spellIds:[13958,13970,13971,13972,13973],maxPoints:5},{fieldName:"opportunity",location:{rowIdx:0,colIdx:2},spellIds:[14057,14072,14073,14074,14075],maxPoints:5},{fieldName:"sleightOfHand",location:{rowIdx:1,colIdx:0},spellIds:[30892,30893],maxPoints:2},{fieldName:"elusiveness",location:{rowIdx:1,colIdx:1},spellIds:[13981,14066],maxPoints:2},{fieldName:"camouflage",location:{rowIdx:1,colIdx:2},spellIds:[13975,14062,14063,14064,14065],maxPoints:5},{fieldName:"initiative",location:{rowIdx:2,colIdx:0},spellIds:[13976,13979,13980],maxPoints:3},{fieldName:"ghostlyStrike",location:{rowIdx:2,colIdx:1},spellIds:[14278],maxPoints:1},{fieldName:"improvedAmbush",location:{rowIdx:2,colIdx:2},spellIds:[14079,14080,14081],maxPoints:3},{fieldName:"setup",location:{rowIdx:3,colIdx:0},spellIds:[13983,14070,14071],maxPoints:3},{fieldName:"improvedSap",location:{rowIdx:3,colIdx:1},spellIds:[14076,14094,14095],maxPoints:3},{fieldName:"serratedBlades",location:{rowIdx:3,colIdx:2},spellIds:[14171,14172,14173],maxPoints:3},{fieldName:"heightenedSenses",location:{rowIdx:4,colIdx:0},spellIds:[30894,30895],maxPoints:2},{fieldName:"preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"dirtyDeeds",location:{rowIdx:4,colIdx:2},spellIds:[14082,14083],maxPoints:2},{fieldName:"hemorrhage",location:{rowIdx:4,colIdx:3},spellIds:[16511],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"deadliness",location:{rowIdx:5,colIdx:2},spellIds:[30902,30903,30904,30905,30906],maxPoints:5},{fieldName:"premeditation",location:{rowIdx:6,colIdx:1},spellIds:[14183],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),gn=rn([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/261.jpg",talents:[{fieldName:"convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109,16110,16111,16112],maxPoints:5},{fieldName:"concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106,16107,16108],maxPoints:5},{fieldName:"earthsGrasp",location:{rowIdx:1,colIdx:0},spellIds:[16043,16130],maxPoints:2},{fieldName:"elementalWarding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"callOfFlame",location:{rowIdx:1,colIdx:2},spellIds:[16038,16160,16161],maxPoints:3},{fieldName:"elementalFocus",location:{rowIdx:2,colIdx:0},spellIds:[16164],maxPoints:1},{fieldName:"reverberation",location:{rowIdx:2,colIdx:1},spellIds:[16040,16113,16114,16115,16116],maxPoints:5},{fieldName:"callOfThunder",location:{rowIdx:2,colIdx:2},spellIds:[16041,16117,16118,16119,16120],maxPoints:5},{fieldName:"improvedFireTotems",location:{rowIdx:3,colIdx:0},spellIds:[16086,16544],maxPoints:2},{fieldName:"eyeOfTheStorm",location:{rowIdx:3,colIdx:1},spellIds:[29062,29064,29065],maxPoints:3},{fieldName:"elementalDevastation",location:{rowIdx:3,colIdx:3},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"stormReach",location:{rowIdx:4,colIdx:0},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalFury",location:{rowIdx:4,colIdx:1},spellIds:[16089],maxPoints:1},{fieldName:"lightningMastery",location:{rowIdx:5,colIdx:2},spellIds:[16578,16579,16580,16581,16582],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"elementalMastery",location:{rowIdx:6,colIdx:1},spellIds:[16166],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/263.jpg",talents:[{fieldName:"ancestralKnowledge",location:{rowIdx:0,colIdx:1},spellIds:[17485,17486,17487,17488,17489],maxPoints:5},{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[16253,16298],maxPoints:5},{fieldName:"guardianTotems",location:{rowIdx:1,colIdx:0},spellIds:[16258,16293],maxPoints:2},{fieldName:"thunderingStrikes",location:{rowIdx:1,colIdx:1},spellIds:[16255,16302,16303,16304,16305],maxPoints:5},{fieldName:"improvedGhostWolf",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"improvedLightningShield",location:{rowIdx:1,colIdx:3},spellIds:[16261,16290],maxPoints:3},{fieldName:"enhancingTotems",location:{rowIdx:2,colIdx:0},spellIds:[16259,16295],maxPoints:2},{fieldName:"twoHandedAxesAndMaces",location:{rowIdx:2,colIdx:2},spellIds:[16269],maxPoints:1},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[16254,16271,16272,16273,16274],maxPoints:5},{fieldName:"flurry",location:{rowIdx:3,colIdx:1},spellIds:[16256,16281,16282,16283,16284],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"toughness",location:{rowIdx:3,colIdx:2},spellIds:[16252,16306,16307,16308,16309],maxPoints:5},{fieldName:"improvedWeaponTotems",location:{rowIdx:4,colIdx:0},spellIds:[29192,29193],maxPoints:2},{fieldName:"elementalWeapons",location:{rowIdx:4,colIdx:1},spellIds:[16266,29079,29080],maxPoints:3},{fieldName:"parry",location:{rowIdx:4,colIdx:2},spellIds:[16268],maxPoints:1},{fieldName:"weaponMastery",location:{rowIdx:5,colIdx:2},spellIds:[29082,29084,29086,29087,29088],maxPoints:5},{fieldName:"stormstrike",location:{rowIdx:6,colIdx:1},spellIds:[17364],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/262.jpg",talents:[{fieldName:"improvedHealingWave",location:{rowIdx:0,colIdx:1},spellIds:[16182,16226,16227,16228,16229],maxPoints:5},{fieldName:"tidalFocus",location:{rowIdx:0,colIdx:2},spellIds:[16179,16214,16215,16216,16217],maxPoints:5},{fieldName:"improvedReincarnation",location:{rowIdx:1,colIdx:0},spellIds:[16184,16209],maxPoints:2},{fieldName:"ancestralHealing",location:{rowIdx:1,colIdx:1},spellIds:[16176,16235,16240],maxPoints:3},{fieldName:"totemicFocus",location:{rowIdx:1,colIdx:2},spellIds:[16173,16222,16223,16224,16225],maxPoints:5},{fieldName:"naturesGuidance",location:{rowIdx:2,colIdx:0},spellIds:[16180,16196,16198],maxPoints:3},{fieldName:"healingFocus",location:{rowIdx:2,colIdx:1},spellIds:[16181,16230,16232,16233,16234],maxPoints:5},{fieldName:"totemicMastery",location:{rowIdx:2,colIdx:2},spellIds:[16189],maxPoints:1},{fieldName:"healingGrace",location:{rowIdx:2,colIdx:3},spellIds:[29187,29189,29191],maxPoints:3},{fieldName:"restorativeTotems",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205,16206,16207,16208],maxPoints:5},{fieldName:"tidalMastery",location:{rowIdx:3,colIdx:2},spellIds:[16194,16218,16219,16220,16221],maxPoints:5},{fieldName:"healingWay",location:{rowIdx:4,colIdx:0},spellIds:[29206,29202,29205],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:2},spellIds:[16188],maxPoints:1},{fieldName:"purification",location:{rowIdx:5,colIdx:2},spellIds:[16178,16210,16211,16212,16213],maxPoints:5},{fieldName:"manaTideTotem",location:{rowIdx:6,colIdx:1},spellIds:[16190],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),fn=rn([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/302.jpg",talents:[{fieldName:"suppression",location:{rowIdx:0,colIdx:1},spellIds:[18174,18175,18176,18177,18178],maxPoints:5},{fieldName:"improvedCorruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:5},{fieldName:"improvedCurseOfWeakness",location:{rowIdx:1,colIdx:0},spellIds:[18179,18180,18181],maxPoints:3},{fieldName:"improvedDrainSoul",location:{rowIdx:1,colIdx:1},spellIds:[18213,18372],maxPoints:2},{fieldName:"improvedLifeTap",location:{rowIdx:1,colIdx:2},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedDrainLife",location:{rowIdx:1,colIdx:3},spellIds:[17804,17805,17806,17807,17808],maxPoints:5},{fieldName:"improvedCurseOfAgony",location:{rowIdx:2,colIdx:0},spellIds:[18827,18829,18830],maxPoints:3},{fieldName:"felConcentration",location:{rowIdx:2,colIdx:1},spellIds:[17783,17784,17785,17786,17787],maxPoints:5},{fieldName:"amplifyCurse",location:{rowIdx:2,colIdx:2},spellIds:[18288],maxPoints:1},{fieldName:"grimReach",location:{rowIdx:3,colIdx:0},spellIds:[18218,18219],maxPoints:2},{fieldName:"nightfall",location:{rowIdx:3,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"improvedDrainMana",location:{rowIdx:3,colIdx:3},spellIds:[17864,18393],maxPoints:2},{fieldName:"siphonLife",location:{rowIdx:4,colIdx:1},spellIds:[18265],maxPoints:1},{fieldName:"curseOfExhaustion",location:{rowIdx:4,colIdx:2},spellIds:[18223],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedCurseOfExhaustion",location:{rowIdx:4,colIdx:3},spellIds:[18310,18311,18312,18313],maxPoints:4,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"shadowMastery",location:{rowIdx:5,colIdx:1},spellIds:[18271,18272,18273,18274,18275],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkPact",location:{rowIdx:6,colIdx:1},spellIds:[18220],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/303.jpg",talents:[{fieldName:"improvedHealthstone",location:{rowIdx:0,colIdx:0},spellIds:[18692,18693],maxPoints:2},{fieldName:"improvedImp",location:{rowIdx:0,colIdx:1},spellIds:[18694,18695,18696],maxPoints:3},{fieldName:"demonicEmbrace",location:{rowIdx:0,colIdx:2},spellIds:[18697,18698,18699,18700,18701],maxPoints:5},{fieldName:"improvedHealthFunnel",location:{rowIdx:1,colIdx:0},spellIds:[18703,18704],maxPoints:2},{fieldName:"improvedVoidwalker",location:{rowIdx:1,colIdx:1},spellIds:[18705,18706,18707],maxPoints:3},{fieldName:"felIntellect",location:{rowIdx:1,colIdx:2},spellIds:[18731,18743,18744,18745,18746],maxPoints:5},{fieldName:"improvedSayaad",location:{rowIdx:2,colIdx:0},spellIds:[18754,18755,18756],maxPoints:3},{fieldName:"felDomination",location:{rowIdx:2,colIdx:1},spellIds:[18708],maxPoints:1},{fieldName:"felStamina",location:{rowIdx:2,colIdx:2},spellIds:[18748],maxPoints:5},{fieldName:"masterSummoner",location:{rowIdx:3,colIdx:1},spellIds:[18709,18710],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"unholyPower",location:{rowIdx:3,colIdx:2},spellIds:[18769,18770,18771,18772,18773],maxPoints:5},{fieldName:"improvedSubjugateDemon",location:{rowIdx:4,colIdx:0},spellIds:[18821,18823,18824,18825],maxPoints:5},{fieldName:"demonicSacrifice",location:{rowIdx:4,colIdx:1},spellIds:[18788],maxPoints:1},{fieldName:"improvedFirestone",location:{rowIdx:4,colIdx:3},spellIds:[18767,18768],maxPoints:2},{fieldName:"masterDemonologist",location:{rowIdx:5,colIdx:2},spellIds:[23785,23822,23823,23824,23825],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"soulLink",location:{rowIdx:6,colIdx:1},spellIds:[19028],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"improvedSpellstone",location:{rowIdx:6,colIdx:2},spellIds:[18774,18775],maxPoints:2}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/301.jpg",talents:[{fieldName:"improvedShadowBolt",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801,17802,17803],maxPoints:5},{fieldName:"cataclysm",location:{rowIdx:0,colIdx:2},spellIds:[17778,17779,17780,17781,17782],maxPoints:5},{fieldName:"bane",location:{rowIdx:1,colIdx:1},spellIds:[17788,17789,17790,17791,17792],maxPoints:5},{fieldName:"aftermath",location:{rowIdx:1,colIdx:2},spellIds:[18119,18120,18121,18122,18123],maxPoints:5},{fieldName:"improvedFirebolt",location:{rowIdx:2,colIdx:0},spellIds:[18126,18127],maxPoints:2},{fieldName:"improvedLashOfPain",location:{rowIdx:2,colIdx:1},spellIds:[18128],maxPoints:2},{fieldName:"devastation",location:{rowIdx:2,colIdx:2},spellIds:[18130,18131,18132,18133,18134],maxPoints:5},{fieldName:"shadowburn",location:{rowIdx:2,colIdx:3},spellIds:[17877],maxPoints:1},{fieldName:"intensity",location:{rowIdx:3,colIdx:0},spellIds:[18135,18136],maxPoints:2},{fieldName:"destructiveReach",location:{rowIdx:3,colIdx:1},spellIds:[17917,17918],maxPoints:2},{fieldName:"improvedSearingPain",location:{rowIdx:3,colIdx:3},spellIds:[17927,17929,17930,17931,17932],maxPoints:5},{fieldName:"pyroclasm",location:{rowIdx:4,colIdx:0},spellIds:[18096,18073],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"improvedImmolate",location:{rowIdx:4,colIdx:1},spellIds:[17815,17833,17834,17835,17836],maxPoints:5},{fieldName:"ruin",location:{rowIdx:4,colIdx:2},spellIds:[17959],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"emberstorm",location:{rowIdx:5,colIdx:2},spellIds:[17954,17955,17956,17957,17958],maxPoints:5},{fieldName:"conflagrate",location:{rowIdx:6,colIdx:1},spellIds:[17962],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),In=rn([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/161.jpg",talents:[{fieldName:"improvedHeroicStrike",location:{rowIdx:0,colIdx:0},spellIds:[12282,12663,12664],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:1},spellIds:[16462,16463,16464,16465,16466],maxPoints:5},{fieldName:"improvedRend",location:{rowIdx:0,colIdx:2},spellIds:[12286,12658,12659],maxPoints:3},{fieldName:"improvedCharge",location:{rowIdx:1,colIdx:0},spellIds:[12285,12697],maxPoints:2},{fieldName:"tacticalMastery",location:{rowIdx:1,colIdx:1},spellIds:[12295,12676,12677,12678,12679],maxPoints:5},{fieldName:"improvedThunderClap",location:{rowIdx:1,colIdx:3},spellIds:[12287,12665,12666],maxPoints:3},{fieldName:"improvedOverpower",location:{rowIdx:2,colIdx:0},spellIds:[12290,12963],maxPoints:2},{fieldName:"angerManagement",location:{rowIdx:2,colIdx:1},spellIds:[12296],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"deepWounds",location:{rowIdx:2,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[12163,12711,12712,12713,12714],maxPoints:5},{fieldName:"impale",location:{rowIdx:3,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"axeSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[12700,12781,12783,12784,12785],maxPoints:5},{fieldName:"sweepingStrikes",location:{rowIdx:4,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[12284,12701,12702,12703,12704],maxPoints:5},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[12281,12812,12813,12814,12815],maxPoints:5},{fieldName:"polearmSpecialization",location:{rowIdx:5,colIdx:0},spellIds:[12165,12830,12831,12832,12833],maxPoints:5},{fieldName:"improvedHamstring",location:{rowIdx:5,colIdx:2},spellIds:[12289,12668,23695],maxPoints:3},{fieldName:"mortalStrike",location:{rowIdx:6,colIdx:1},spellIds:[12294],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/164.jpg",talents:[{fieldName:"boomingVoice",location:{rowIdx:0,colIdx:1},spellIds:[12321,12835,12836,12837,12838],maxPoints:5},{fieldName:"cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852,12853,12855,12856],maxPoints:5},{fieldName:"improvedDemoralizingShout",location:{rowIdx:1,colIdx:1},spellIds:[12324,12876,12877,12878,12879],maxPoints:5},{fieldName:"unbridledWrath",location:{rowIdx:1,colIdx:2},spellIds:[12322,12999,13e3,13001,13002],maxPoints:5},{fieldName:"improvedCleave",location:{rowIdx:2,colIdx:0},spellIds:[12329,12950,20496],maxPoints:3},{fieldName:"piercingHowl",location:{rowIdx:2,colIdx:1},spellIds:[12323],maxPoints:1},{fieldName:"bloodCraze",location:{rowIdx:2,colIdx:2},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"improvedBattleShout",location:{rowIdx:2,colIdx:3},spellIds:[12318,12857,12858,12860,12861],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:0},spellIds:[23584,23585,23586,23587,23588],maxPoints:5},{fieldName:"improvedExecute",location:{rowIdx:3,colIdx:1},spellIds:[20502,20503],maxPoints:2},{fieldName:"enrage",location:{rowIdx:3,colIdx:2},spellIds:[12317,13045,13046,13047,13048],maxPoints:5},{fieldName:"improvedSlam",location:{rowIdx:4,colIdx:0},spellIds:[12862,12330,20497,20498,20499],maxPoints:5},{fieldName:"deathWish",location:{rowIdx:4,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"improvedIntercept",location:{rowIdx:4,colIdx:3},spellIds:[20504,20505],maxPoints:2},{fieldName:"improvedBerserkerRage",location:{rowIdx:5,colIdx:0},spellIds:[20500,20501],maxPoints:2},{fieldName:"flurry",location:{rowIdx:5,colIdx:2},spellIds:[12319,12971,12972,12973,12974],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bloodthirst",location:{rowIdx:6,colIdx:1},spellIds:[23881],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/163.jpg",talents:[{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:1},spellIds:[12298,12724,12725,12726,12727],maxPoints:5},{fieldName:"anticipation",location:{rowIdx:0,colIdx:2},spellIds:[12297,12750,12751,12752,12753],maxPoints:5},{fieldName:"improvedBloodrage",location:{rowIdx:1,colIdx:0},spellIds:[12301,12818],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:2},spellIds:[12299,12761,12762,12763,12764],maxPoints:5},{fieldName:"ironWill",location:{rowIdx:1,colIdx:3},spellIds:[12300,12959,12960,12961,12962],maxPoints:5},{fieldName:"lastStand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"improvedShieldBlock",location:{rowIdx:2,colIdx:1},spellIds:[12945,12307,12944],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRevenge",location:{rowIdx:2,colIdx:2},spellIds:[12797,12799,12800],maxPoints:3},{fieldName:"defiance",location:{rowIdx:2,colIdx:3},spellIds:[12303,12788,12789,12791,12792],maxPoints:5},{fieldName:"improvedSunderArmor",location:{rowIdx:3,colIdx:0},spellIds:[12308,12810,12811],maxPoints:3},{fieldName:"improvedDisarm",location:{rowIdx:3,colIdx:1},spellIds:[12313,12804,12807],maxPoints:3},{fieldName:"improvedTaunt",location:{rowIdx:3,colIdx:2},spellIds:[12302,12765],maxPoints:2},{fieldName:"improvedShieldWall",location:{rowIdx:4,colIdx:0},spellIds:[12312,12803],maxPoints:2},{fieldName:"concussionBlow",location:{rowIdx:4,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"improvedShieldBash",location:{rowIdx:4,colIdx:2},spellIds:[12311,12958],maxPoints:2},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[16538,16539,16540,16541,16542],maxPoints:5},{fieldName:"shieldSlam",location:{rowIdx:6,colIdx:1},spellIds:[23922],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),wn={[l.ClassUnknown]:[],[l.ClassDruid]:dn,[l.ClassShaman]:gn,[l.ClassHunter]:cn,[l.ClassMage]:hn,[l.ClassRogue]:pn,[l.ClassPaladin]:mn,[l.ClassPriest]:un,[l.ClassWarlock]:fn,[l.ClassWarrior]:In};function vn(e,t){return function(e,t,i){return t.split("-").forEach(((t,s)=>{const a=i[s];[...t].forEach(((t,i)=>{const s=a.talents[i],n=parseInt(t);s.fieldName&&(1==s.maxPoints?e[s.fieldName]=1==n:e[s.fieldName]=n)}))})),e}(y[e].talentsCreate(),t,wn[i[e]])}class bn{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:E.fromProto(e.id)}))),i=e.auras.map((e=>({data:e,id:E.fromProto(e.id)})));await Promise.all([...t,...i].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>le(e.id.name,t.id.name))),i=i.sort(((e,t)=>le(e.id.name,t.id.name)));let s=!1;return e.name!=this.name&&(this.name=e.name,s=!0),(t.length!=this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,s=!0),(i.length!=this.auras.length||i.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=i,s=!0),s}}class xn{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let s=t;s<e.length;s++)this.metadatas.push(new bn);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const i=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!=this.metadatas.length||i.some((e=>e))}asList(){return this.metadatas.slice()}}const Sn={};function En(e){const t=Sn[e];if(!t)throw new Error("No config registered for Spec: "+e);return t}const yn=class e{constructor(t,i){this.name="",this.buffs=P.create(),this.consumes=k.create(),this.bonusStats=new tn,this.gear=new C({}),this.enableItemSwap=!1,this.itemSwapGear=new L({}),this.profession1=0,this.profession2=0,this.aplRotation=T.create(),this.talentsString="",this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.healingModel=N.create(),this.healingEnabled=!1,this.isbUsingShadowflame=!0,this.isbSbFrequency=3,this.isbCrit=25,this.isbWarlocks=1,this.isbSpriests=0,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new tn,this.currentStats=_.create(),this.metadata=new bn,this.petMetadatas=new xn,this.nameChangeEmitter=new a("PlayerName"),this.buffsChangeEmitter=new a("PlayerBuffs"),this.consumesChangeEmitter=new a("PlayerConsumes"),this.bonusStatsChangeEmitter=new a("PlayerBonusStats"),this.gearChangeEmitter=new a("PlayerGear"),this.itemSwapChangeEmitter=new a("PlayerItemSwap"),this.professionChangeEmitter=new a("PlayerProfession"),this.raceChangeEmitter=new a("PlayerRace"),this.levelChangeEmitter=new a("PlayerLevel"),this.rotationChangeEmitter=new a("PlayerRotation"),this.talentsChangeEmitter=new a("PlayerTalents"),this.specOptionsChangeEmitter=new a("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new a("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new a("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new a("PlayerHealingModel"),this.epWeightsChangeEmitter=new a("PlayerEpWeights"),this.miscOptionsChangeEmitter=new a("PlayerMiscOptions"),this.currentStatsEmitter=new a("PlayerCurrentStats"),this.epRatiosChangeEmitter=new a("PlayerEpRatios"),this.epRefStatChangeEmitter=new a("PlayerEpRefStat"),this.sim=i,this.party=null,this.raid=null,this.spec=t,this.race=A[this.spec][0],this.level=R[Ka[this.spec].phase],this.specTypeFunctions=y[this.spec],this.specOptions=this.specTypeFunctions.optionsCreate();const s=Sn[this.spec];if(!s)throw new Error("Could not find spec config for spec: "+this.spec);this.autoRotationGenerator=s.autoRotation,s.simpleRotation?this.simpleRotationGenerator=s.simpleRotation:this.simpleRotationGenerator=null;for(let e=0;e<D.ItemSlotRanged+1;++e)this.itemEPCache[e]=new Map;this.changeEmitter=a.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.itemSwapChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.levelChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter],"PlayerChange")}getSpecIcon(){return M(this.spec,this.getTalentsString())}getClass(){return i[this.spec]}getClassColor(){return V[this.getClass()]}isSpec(e){return this.spec==e}isClass(e){return this.getClass()==e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null==e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter((e=>null!=e&&e!=this))}getItems(e){return this.sim.db.getItems(e).filter((t=>U(this,t,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>this.computeRandomSuffixEP(e)>0))}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>W(e,this.spec)))}getRunes(e){return this.sim.db.getRunes(e,this.getClass())}hasRune(e,t){return this.getEquippedItem(e)?.rune?.id===t}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let i=0;i<D.ItemSlotRanged+1;++i)this.itemEPCache[i]=new Map}getDefaultEpRatios(t,i){const s=new Array(e.numEpRatios).fill(0);return i?s[1]=1:t?(s[2]=1,s[3]=1):s[0]=1,s}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,i,s,a){return await this.sim.statWeights(this,t,i,s,a)}getCurrentStats(){return _.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),i=await e,s=await t;return i||s}getName(){return this.name}setName(e,t){t!=this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!=this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getLevel(){return this.level}setLevel(e,t){t!=this.level&&(this.level=t,this.levelChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!=this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!=this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!=F.ProfessionUnknown))}setProfessions(e,t){a.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||F.ProfessionUnknown),this.setProfession2(e,t[1]||F.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(F.Blacksmithing)}getFaction(){return O[this.getRace()]}getBuffs(){return P.clone(this.buffs)}setBuffs(e,t){P.equals(this.buffs,t)||(this.buffs=P.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return k.clone(this.consumes)}setConsumes(e,t){k.equals(this.consumes,t)||(this.consumes=k.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return!1}equipItem(e,t,i){this.setGear(e,this.gear.withEquippedItem(t,i,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.itemSwapChangeEmitter.emit(e))}equipItemSwapitem(e,t,i){this.setItemSwapGear(e,this.itemSwapGear.withEquippedItem(t,i,this.canDualWield2H()))}getItemSwapItem(e){return this.itemSwapGear.getEquippedItem(e)}getItemSwapGear(){return this.itemSwapGear}setItemSwapGear(e,t){t.equals(this.itemSwapGear)||(this.itemSwapGear=t,this.itemSwapChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=(this.currentStats.finalStats?.stats[c.StatMeleeCrit]||0)/H,i=(this.currentStats.finalStats?.stats[c.StatMeleeHit]||0)/q,s=(this.currentStats.finalStats?.stats[c.StatExpertise]||0)/B/4,a=void 0!==this.getGear().getEquippedItem(D.ItemSlotOffHand)?.item.weaponSpeed,n=a&&this.spec!=t.SpecWarrior?27:8,o=this.getInFrontOfTarget()?14:0,l=6.5+o,r=Math.max(n-i,0),d=Math.max(6.5-s,0)+Math.max(o-s,0);let h=0;if(this.spec===t.SpecEnhancementShaman){h=3*this.getTalents().elementalDevastation}this.sim.raid.getDebuffs();const m=64.8-r-d-h;return{meleeCrit:e,meleeHit:i,expertise:s,suppression:4.8,glancing:40,debuffCrit:0,hasOffhandWeapon:a,meleeHitCap:n,expertiseCap:l,remainingMeleeHitCap:r,remainingExpertiseCap:d,baseCritCap:m,specSpecificOffset:h,playerCritCapDelta:e-m+0}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=z.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return j.clone(this.aplRotation.simple?.cooldowns||j.create())}setSimpleCooldowns(e,t){j.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=z.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}setAplRotation(e,t){T.equals(t,this.aplRotation)||(this.aplRotation=T.clone(t),this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type==$.TypeUnknown?$.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e==$.TypeAuto&&this.autoRotationGenerator){const e=T.clone(this.autoRotationGenerator(this));return e.type=$.TypeAuto,e}if(e==$.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=T.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=$.TypeSimple,t}return this.aplRotation}getTalents(){return null==this.talents&&(this.talents=vn(this.spec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!=this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTree(){return G(this.getTalentsString())}getTalentTreePoints(){return K(this.getTalentsString())}getTalentTreeIcon(){return M(this.spec,this.getTalentsString())}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!=this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!=this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!=this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!=this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,i=t.dualWield;0==e.cadenceSeconds&&(e.cadenceSeconds=1.5*t.swingSpeed,i&&(e.cadenceSeconds/=2)),0==e.hps&&(e.hps=.175*t.minBaseDamage/t.swingSpeed,i&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!=e.cadenceSeconds&&0!=e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return N.clone(this.healingModel)}setHealingModel(e,t){N.equals(this.healingModel,t)||(this.healingModel=N.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}getIsbUsingShadowflame(){return this.isbUsingShadowflame}setIsbUsingShadowflame(e,t){t!=this.isbUsingShadowflame&&(this.isbUsingShadowflame=t,this.changeEmitter.emit(e))}getIsbSbFrequency(){return this.isbSbFrequency}setIsbSbFrequency(e,t){t!=this.isbSbFrequency&&(this.isbSbFrequency=t,this.changeEmitter.emit(e))}getIsbCrit(){return this.isbCrit}setIsbCrit(e,t){t!=this.isbCrit&&(this.isbCrit=t,this.changeEmitter.emit(e))}getIsbWarlocks(){return this.isbWarlocks}setIsbWarlocks(e,t){t!=this.isbWarlocks&&(this.isbWarlocks=t,this.changeEmitter.emit(e))}getIsbSpriests(){return this.isbSpriests}setIsbSpriests(e,t){t!=this.isbSpriests&&(this.isbSpriests=t,this.changeEmitter.emit(e))}computeStatsEP(e){return null==e?0:e.computeEP(this.epWeights)}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);const t=this.computeStatsEP(new tn(e.stats));return this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new tn(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeItemEP(e,t){if(null==e)return 0;const i=this.itemEPCache[t].get(e.id);if(void 0!==i)return i;let s=new tn(e.stats);if(e.weaponSpeed>0){const i=J(e);t==D.ItemSlotMainHand?s=s.withPseudoStat(h.PseudoStatMainHandDps,i):t==D.ItemSlotOffHand?s=s.withPseudoStat(h.PseudoStatOffHandDps,i):t==D.ItemSlotRanged&&(s=s.withPseudoStat(h.PseudoStatRangedDps,i))}let a=0;if(e.randomSuffixOptions.length>0){const t=e.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e))));a=Math.max(...t)}let n=s.computeEP(this.epWeights)+a;return e.unique&&(n-=.01),this.itemEPCache[t].set(e.id,n),n}setWowheadData(e,t){const i=[],s=de(),a=s?s+".":"";i.push(`domain=${a}classic`),null!=e.enchant&&i.push("ench="+e.enchant.effectId),i.push("pcs="+this.gear.asArray().filter((e=>null!=e)).map((e=>e.item.id)).join(":")),t.dataset.wowhead=i.join("&"),t.dataset.whtticon="false"}filterItemData(t,i,s){const a=this.sim.getFilters(),n=(e,t)=>e.filter((e=>t(i(e))));if(0!=a.minIlvl&&(t=n(t,(e=>e.ilvl>=a.minIlvl))),0!=a.maxIlvl&&(t=n(t,(e=>e.ilvl<=a.maxIlvl))),a.factionRestriction!=Z.UNSPECIFIED&&(t=n(t,(e=>e.factionRestriction==a.factionRestriction||e.factionRestriction==Z.UNSPECIFIED))),a.sources.includes(Y.SourceCrafting)||(t=n(t,(e=>!e.sources.some((e=>"crafted"==e.source.oneofKind))))),a.sources.includes(Y.SourceQuest)||(t=n(t,(e=>!e.sources.some((e=>"quest"==e.source.oneofKind))))),a.sources.includes(Y.SourceReputation)||(t=n(t,(e=>!e.sources.some((e=>"rep"==e.source.oneofKind))))),!a.sources.includes(Y.SourceDungeon))for(const e in Q){const i=Q[e];"number"==typeof i&&(t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==i)))))}if(!a.sources.includes(Y.SourceRaid)){const e=[];for(const t in X){const i=X[t];"number"==typeof i&&0!=i&&e.push(i)}t=n(t,(t=>!t.sources.some((t=>"drop"==t.source.oneofKind&&e.includes(t.source.drop.zoneId)))))}for(const e in ee){const i=ee[e];"number"==typeof i&&0!=i&&(t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==i)))))}if(!a.sources.includes(Y.SourceWorldBOE))for(const e in X){"number"==typeof X[e]&&(t=n(t,(e=>0==e.randomSuffixOptions.length)))}return e.ARMOR_SLOTS.includes(s)?t=n(t,(e=>!!a.armorTypes.includes(e.armorType))):e.WEAPON_SLOTS.includes(s)?t=n(t,(e=>{if(!a.weaponTypes.includes(e.weaponType))return!1;if(!a.oneHandedWeapons&&e.handType!=re.HandTypeTwoHand)return!1;if(!a.twoHandedWeapons&&e.handType==re.HandTypeTwoHand)return!1;const t=s==D.ItemSlotMainHand?a.minMhWeaponSpeed:a.minOhWeaponSpeed,i=s==D.ItemSlotMainHand?a.maxMhWeaponSpeed:a.maxOhWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(i>0&&e.weaponSpeed>i)})):s==D.ItemSlotRanged&&(t=n(t,(e=>{if(!a.rangedWeaponTypes.includes(e.rangedWeaponType))return!1;const t=a.minRangedWeaponSpeed,i=a.maxRangedWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(i>0&&e.weaponSpeed>i)}))),t}filterEnchantData(e,t,i,s){return s?e.filter((e=>{const i=t(e);return!!te(i,s.item)})):e}makeUnitReference(){return null==this.party?ie():se(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(),t=this.getItemSwapGear().toDatabase();return ae.mergeSimDatabases(e,t)}toProto(e,t,i){const s=e=>!i||0==i.length||i.includes(e),a=this.getGear(),n=t?this.getResolvedAplRotation():this.aplRotation;let l=o.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return s(Rn.Gear)&&o.mergePartial(l,{equipment:a.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.getEnableItemSwap(),itemSwap:this.getItemSwapGear().toProto()}),s(Rn.Talents)&&o.mergePartial(l,{talentsString:this.getTalentsString()}),s(Rn.Rotation)&&o.mergePartial(l,{cooldowns:j.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),s(Rn.Consumes)&&o.mergePartial(l,{consumes:this.getConsumes()}),s(Rn.Miscellaneous)&&(o.mergePartial(l,{name:this.getName(),race:this.getRace(),level:this.getLevel(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),isbUsingShadowflame:this.getIsbUsingShadowflame(),isbSbFrequency:this.getIsbSbFrequency(),isbCrit:this.getIsbCrit(),isbWarlocks:this.getIsbWarlocks(),isbSpriests:this.getIsbSpriests()}),l=ne(this.spec,l,this.getSpecOptions())),s(Rn.External)&&o.mergePartial(l,{buffs:this.getBuffs()}),l}fromProto(e,t,i){const s=e=>!i||0==i.length||i.includes(e);t.rotation?.type==$.TypeLegacy&&(t.rotation.type=$.TypeAuto),a.freezeAllAndDo((()=>{s(Rn.Gear)&&(this.setGear(e,t.equipment?this.sim.db.lookupEquipmentSpec(t.equipment):new C({})),this.setEnableItemSwap(e,t.enableItemSwap),this.setItemSwapGear(e,t.itemSwap?this.sim.db.lookupItemSwap(t.itemSwap):new L({})),this.setBonusStats(e,tn.fromProto(t.bonusStats||p.create()))),s(Rn.Talents)&&this.setTalentsString(e,t.talentsString),s(Rn.Rotation)&&(t.rotation?.type!=$.TypeUnknown&&t.rotation?.type!=$.TypeLegacy||(t.rotation||(t.rotation=T.create()),t.rotation.type=$.TypeAuto),this.setAplRotation(e,t.rotation||T.create())),s(Rn.Consumes)&&this.setConsumes(e,t.consumes||k.create()),s(Rn.Miscellaneous)&&(this.setSpecOptions(e,this.specTypeFunctions.optionsFromPlayer(t)),this.setName(e,t.name),this.setLevel(e,t.level),this.setRace(e,t.race),this.setProfession1(e,t.profession1),this.setProfession2(e,t.profession2),this.setReactionTime(e,t.reactionTimeMs),this.setChannelClipDelay(e,t.channelClipDelayMs),this.setInFrontOfTarget(e,t.inFrontOfTarget),this.setDistanceFromTarget(e,t.distanceFromTarget),this.setHealingModel(e,t.healingModel||N.create()),this.setIsbSbFrequency(e,t.isbSbFrequency),this.setIsbCrit(e,t.isbCrit),this.setIsbWarlocks(e,t.isbWarlocks),this.setIsbSpriests(e,t.isbSpriests)),s(Rn.External)&&this.setBuffs(e,t.buffs||P.create())}))}clone(t){const i=new e(this.spec,this.sim);return i.fromProto(t,this.toProto()),i}applySharedDefaults(e){a.freezeAllAndDo((()=>{this.setEnableItemSwap(e,!1),this.setItemSwapGear(e,new L({})),this.setReactionTime(e,200),this.setInFrontOfTarget(e,oe(this.spec)),this.setHealingModel(e,N.create({burstWindow:oe(this.spec)?6:0})),this.setSimpleCooldowns(e,j.create({hpPercentForDefensives:oe(this.spec)?.35:0})),this.setBonusStats(e,new tn),this.setAplRotation(e,T.create({type:$.TypeAuto}))}))}getMatchingSpellActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?E.fromSpellId(t.id):null}getMatchingItemActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?E.fromItemId(t.id):null}};yn.numEpRatios=6,yn.ARMOR_SLOTS=[D.ItemSlotHead,D.ItemSlotShoulder,D.ItemSlotChest,D.ItemSlotWrist,D.ItemSlotHands,D.ItemSlotLegs,D.ItemSlotWaist,D.ItemSlotFeet],yn.WEAPON_SLOTS=[D.ItemSlotMainHand,D.ItemSlotOffHand];let Pn=yn;class kn{constructor(e){this.duration=120,this.durationVariation=15,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.useHealth=!1,this.targetsChangeEmitter=new a,this.durationChangeEmitter=new a,this.executeProportionChangeEmitter=new a,this.changeEmitter=new a,this.sim=e,this.targetsMetadata=new xn,e.waitForInit().then((()=>{const t=e.raid.getPlayer(0)?.getLevel()??ce,i=kn.getPresetTargetForLevel(t,e);this.targets=[i.target],[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}))}get primaryTarget(){return he.clone(this.targets[0])}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,i)=>he.equals(t,e.targets[i].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||he.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,i){this.targets[i]=t.target||he.create(),this.targetsChangeEmitter.emit(e)}toProto(){return me.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,useHealth:this.useHealth,targets:this.targets})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){const t=this.sim.raid.getPlayer(0)?.getLevel()??ce,i=kn.getPresetTargetForLevel(t,this.sim);this.fromProto(e,me.create({duration:120,durationVariation:15,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,targets:[i.target]}))}static getPresetTargetForLevel(e,t){const i=t.db.getAllPresetTargets();return i.find((t=>t?.target?.level&&t?.target?.level>e))??i[0]}}const Cn=8;class Ln{constructor(e){this.buffs=ue.create(),this.debuffs=pe.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new a,this.buffsChangeEmitter=new a,this.debuffsChangeEmitter=new a,this.tanksChangeEmitter=new a,this.targetDummiesChangeEmitter=new a,this.numActivePartiesChangeEmitter=new a,this.sim=e,this.parties=[...Array(8).keys()].map((t=>{const i=new Ya(this,e);return i.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),i.changeEmitter.on((e=>this.changeEmitter.emit(e))),i})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=a.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return v(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=ge.Unknown?e.type==ge.Player?this.getPlayer(e.index):e.type==ge.Self&&t||null:null}setPlayer(e,t,i){this.parties[Math.floor(t/5)].setPlayer(e,t%5,i)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return ue.clone(this.buffs)}setBuffs(e,t){ue.equals(this.buffs,t)||(this.buffs=ue.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return pe.clone(this.debuffs)}setDebuffs(e,t){pe.equals(this.debuffs,t)||(this.debuffs=pe.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>fe.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,i)=>fe.equals(e,t[i])))||(this.tanks=t.map((e=>fe.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return Ie.create({parties:this.parties.map((i=>i.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){t.debuffs?.curseOfElements&&t.debuffs.curseOfElementsNew==we.TristateEffectMissing&&(t.debuffs.curseOfElementsNew=we.TristateEffectRegular,t.debuffs.curseOfElements=!1),t.debuffs?.curseOfShadow&&t.debuffs.curseOfShadowNew==we.TristateEffectMissing&&(t.debuffs.curseOfShadowNew=we.TristateEffectRegular,t.debuffs.curseOfShadow=!1),a.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||ue.create()),this.setDebuffs(e,t.debuffs||pe.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let i=0;i<8;i++)t.parties[i]?this.parties[i].fromProto(e,t.parties[i]):this.parties[i].clear(e)}))}clear(e){a.freezeAllAndDo((()=>{for(let t=0;t<8;t++)this.parties[t].clear(e)}))}}var Tn=(e=>(e.bulkSimAsync="bulkSimAsync",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e))(Tn||{});const Nn=`/${Te}/sim_worker.js`;class _n{constructor(e){this.workers=[];for(let t=0;t<e;t++)this.workers.push(new An)}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.numTasksRunning<t.numTasksRunning?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,"")}async computeStats(e){const t=await this.makeApiCall(Tn.computeStats,ve.toBinary(e));return be.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t){console.log("Stat weights request: "+xe.toJsonString(e));const i=this.getLeastBusyWorker(),s=i.makeTaskId();i.addPromiseFunc(this.getProgressName(s),this.newProgressHandler(s,i,t),Se);const a=await i.doApiCall(Tn.statWeightsAsync,xe.toBinary(e),s),n=Ee.fromBinary(a);return console.log("Stat weights result: "+ye.toJsonString(n.finalWeightResult)),n.finalWeightResult}async bulkSimAsync(e,t){console.log("bulk sim request: "+Pe.toJsonString(e,{enumAsInteger:!0}));const i=this.getLeastBusyWorker(),s=i.makeTaskId();i.addPromiseFunc(this.getProgressName(s),this.newProgressHandler(s,i,t),Se);const a=await i.doApiCall(Tn.bulkSimAsync,Pe.toBinary(e),s),n=Ee.fromBinary(a),o=ke.toJson(n.finalBulkResult);return console.log("bulk sim result: "+JSON.stringify(o)),n.finalBulkResult}async raidSimAsync(e,t){console.log("Raid sim request: "+Ce.toJsonString(e));const i=this.getLeastBusyWorker(),s=i.makeTaskId();i.addPromiseFunc(this.getProgressName(s),this.newProgressHandler(s,i,t),Se);const a=await i.doApiCall(Tn.raidSimAsync,Ce.toBinary(e),s),n=Ee.fromBinary(a),o=Le.toJson(n.finalRaidResult);return delete o.logs,console.log("Raid sim result: "+JSON.stringify(o)),n.finalRaidResult}newProgressHandler(e,t,i){return s=>{const a=Ee.fromBinary(s);i(a),null==a.finalRaidResult&&null==a.finalWeightResult&&t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,i),Se)}}}class An{constructor(){this.numTasksRunning=0,this.taskIdsToPromiseFuncs={},this.worker=new window.Worker(Nn);let e=null;this.onReady=new Promise(((t,i)=>{e=t})),this.worker.addEventListener("message",(({data:t})=>{const{id:i,msg:s,outputData:a}=t;switch(s){case"ready":this.postMessage({msg:"setID",id:"1"}),e();break;case"idConfirm":break;default:if(!this.taskIdsToPromiseFuncs[i])return void console.warn("Unrecognized result id: ",i);const t=this.taskIdsToPromiseFuncs[i];delete this.taskIdsToPromiseFuncs[i],this.numTasksRunning--,t[0](a)}}))}addPromiseFunc(e,t,i){this.taskIdsToPromiseFuncs[e]=[t,i]}makeTaskId(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<16;i++)e+=t.charAt(Math.floor(62*Math.random()));return e}async doApiCall(e,t,i){this.numTasksRunning++,await this.onReady;const s=new Promise(((s,a)=>{i||(i=this.makeTaskId()),this.taskIdsToPromiseFuncs[i]=[s,a],this.postMessage({msg:e,id:i,inputData:t})}));return await s}postMessage(e){this.worker.postMessage(e)}}var Rn=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(Rn||{});const Dn=class e{constructor(){this.iterations=3e3,this.phase=Ne,this.faction=_e.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.showEPValues=!1,this.language="",this.db_=null,this.iterationsChangeEmitter=new a,this.phaseChangeEmitter=new a,this.factionChangeEmitter=new a,this.fixedRngSeedChangeEmitter=new a,this.lastUsedRngSeedChangeEmitter=new a,this.filtersChangeEmitter=new a,this.showDamageMetricsChangeEmitter=new a,this.showThreatMetricsChangeEmitter=new a,this.showHealingMetricsChangeEmitter=new a,this.showExperimentalChangeEmitter=new a,this.showEPValuesChangeEmitter=new a,this.languageChangeEmitter=new a,this.crashEmitter=new a,this.unitMetadataEmitter=new a("UnitMetadata"),this.simResultEmitter=new a,this.bulkSimStartEmitter=new a,this.bulkSimResultEmitter=new a,this.lastUsedRngSeed=0,this.modifyRaidProto=()=>{},this.workerPool=new _n(1),this._initPromise=ae.get().then((e=>{this.db_=e})),this.raid=new Ln(this),this.encounter=new kn(this),this.settingsChangeEmitter=a.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.showEPValuesChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=a.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),a.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e)))}waitForInit(){return this._initPromise}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{e.equipment&&this.db.lookupEquipmentSpec(e.equipment)}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),i=this.encounter.toProto();return Ce.create({raid:t,encounter:i,simOptions:Ae.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,i){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const s=Pe.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=s.baseSettings&&null!=s.baseSettings.simOptions&&(s.baseSettings.simOptions.debugFirstIteration=!1),!s.baseSettings?.raid||0==s.baseSettings?.raid?.parties.length||0==s.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const n=s.baseSettings.raid.parties[0].players[0].database;n?.items.push(...t.items),n?.enchants.push(...t.enchants),this.bulkSimStartEmitter.emit(a.nextEventID(),s);const o=await this.workerPool.bulkSimAsync(s,i);if(""!=o.errorResult)throw new Vn(o.errorResult);return this.bulkSimResultEmitter.emit(a.nextEventID(),o),o}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=this.makeRaidSimRequest(!1),s=await this.workerPool.raidSimAsync(i,t);if(""!=s.errorResult)throw new Vn(s.errorResult);const a=await Re.makeNew(i,s);return this.simResultEmitter.emit(e,a),a}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const t=this.makeRaidSimRequest(!0),i=await this.workerPool.raidSimAsync(t,(()=>{}));if(""!=i.errorResult)throw new Vn(i.errorResult);const s=await Re.makeNew(t,i);return this.simResultEmitter.emit(e,s),s}async updateCharacterStats(e){if(0==e)return;e=a.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),i=ve.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),s=await this.workerPool.computeStats(i);""==s.errorResult?a.freezeAllAndDo((async()=>{const i=s.raidStats.parties.map(((i,s)=>i.players.map(((i,a)=>{const n=t[5*s+a];return n?(n.setCurrentStats(e,i),n.updateMetadata()):null})))).flat().filter((e=>null!=e)),a=this.encounter.targetsMetadata.update(s.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(i.concat([a]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new Vn(s.errorResult))}async statWeights(e,t,i,s,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),ye.create();{const n=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[fe.create({type:ge.Player,index:0})]:[],o=xe.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:Ae.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:n,statsToWeigh:t,pseudoStatsToWeigh:i,epReferenceStat:s});return await this.workerPool.statWeightsAsync(o,a)}}getUnitMetadata(e,t,i){if(!e||e.type==ge.Unknown)return this.getUnitMetadata(i,t,i);if(e.type==ge.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==ge.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==ge.Pet){const i=this.raid.getPlayerFromUnitReference(e.owner,t);return i?i.getPetMetadatas().asList()[e.index]:void 0}return e.type==ge.Self?t?.getMetadata():e.type==ge.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&t>0&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(a.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return De.clone(this.filters)}setFilters(e,t){De.equals(t,this.filters)||(this.filters=De.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||Me())!=this.language&&(this.language=t,Ve(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),Ue.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showEpValues:this.getShowEPValues(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,i){a.freezeAllAndDo((()=>{this.setIterations(t,i.iterations||3e3),this.setPhase(t,i.phase||Ne),this.setFixedRngSeed(t,Number(i.fixedRngSeed)),this.setShowDamageMetrics(t,i.showDamageMetrics),this.setShowThreatMetrics(t,i.showThreatMetrics),this.setShowHealingMetrics(t,i.showHealingMetrics),this.setShowExperimental(t,i.showExperimental),this.setShowEPValues(t,i.showEpValues),this.setLanguage(t,i.language),this.setFaction(t,i.faction||_e.Alliance);const s=i.filters||e.defaultFilters();0==s.armorTypes.length&&(s.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==s.weaponTypes.length&&(s.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==s.rangedWeaponTypes.length&&(s.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==s.sources.length&&(s.sources=e.ALL_SOURCES.slice()),0==s.raids.length&&(s.raids=e.ALL_RAIDS.slice()),this.setFilters(t,s)}))}applyDefaults(t,i,s){this.fromProto(t,Ue.create({iterations:3e3,phase:Ne,faction:_e.Alliance,showDamageMetrics:!s,showThreatMetrics:i,showHealingMetrics:s,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1}))}static defaultFilters(){return De.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};Dn.MAX_RNG_SEED=Math.pow(2,32)-1,Dn.ALL_ARMOR_TYPES=d(We).filter((e=>0!=e)),Dn.ALL_WEAPON_TYPES=d(Fe).filter((e=>0!=e)),Dn.ALL_RANGED_WEAPON_TYPES=d(Oe).filter((e=>0!=e)),Dn.ALL_SOURCES=d(Y).filter((e=>0!=e)),Dn.ALL_RAIDS=d(X).filter((e=>0!=e));let Mn=Dn;class Vn extends Error{constructor(e){super(e),this.errorStr=e}}var Un=(e=>(e.Vertical="vertical",e.Horizontal="Horizontal",e))(Un||{});class Wn extends w{constructor(e,t,i){super(e,"icon-picker-root",t,i),this.incrementValue=()=>{0==this.config.states||this.currentValue+this.step<this.config.states*this.step?(this.currentValue+=this.step,this.inputChanged(a.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(a.nextEventID()))},this.decrementValue=()=>{this.currentValue>0?this.currentValue-=this.step:0===this.config.states?this.currentValue=this.step:this.currentValue=(this.config.states-1)*this.step,this.inputChanged(a.nextEventID())},this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=i,this.currentValue=0,this.step=i.step??1,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const s=Boolean(this.config.improvedId);s&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!s&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const n=I(),o=I(),l=I();this.rootAnchor.appendChild(f("div",{className:"icon-input-level-container"},f("a",{ref:n,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),f("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),f("span",{ref:l,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=n.value,this.improvedAnchor2=o.value,this.counterElem=l.value,this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0),this.init();const r=()=>{this.config.actionId(this.modObject)?.fillAndSet(this.rootAnchor,!0,!0),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))};r(),this.config.changedEvent(this.modObject).on(r);const d=i.reverse?this.decrementValue:this.incrementValue,c=i.reverse?this.incrementValue:this.decrementValue;this.rootAnchor.addEventListener("click",(e=>{e.preventDefault(),d()})),this.rootAnchor.addEventListener("mousedown",(e=>{S(e)&&(e.preventDefault(),c())})),this.rootAnchor.addEventListener("contextmenu",(e=>e.preventDefault()))}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId(this.modObject):2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId(this.modObject)}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(a.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(a.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId(this.modObject)&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}class Fn extends w{constructor(e,t,i){if(super(e,"icon-enum-picker-root",t,i),this.rootElem.classList.add("icon-picker","vertical"===(i.direction??Un.Vertical)?"dropdown":"dropend"),this.config=i,this.currentValue=this.config.zeroValue,i.tooltip){const e=qa(this.rootElem,{content:i.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}this.rootElem.appendChild(f(x,null,f("a",{href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),f("ul",{className:"dropdown-menu"}),f("label",{className:"form-label"}))),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.buttonText=this.rootElem.querySelector("label"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.numColumns&&(this.dropdownMenu.style.gridTemplateColumns=`repeat(${this.config.numColumns}, 1fr)`),this.config.direction==Un.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.config.values.forEach(((e,t)=>{const i=document.createElement("li");i.classList.add("icon-dropdown-option","dropdown-option"),this.dropdownMenu.appendChild(i);const s=document.createElement("a");s.classList.add("icon-picker-button"),s.dataset.whtticon="false",s.dataset.disableWowheadTouchTooltip="true",i.appendChild(s);const n=()=>{this.setImage(s,e),this.showValueWhen(e)?i.classList.remove("hide"):(i.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(a.nextEventID())))};if(this.config.changedEvent(this.modObject).on(n),n(),s.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(a.nextEventID())})),e.tooltip){const t=qa(s,{content:e.tooltip});this.addOnDisposeCallback((()=>t.destroy()))}})),this.init();const s=()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))};s(),this.config.changedEvent(this.modObject).on(s)}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(a.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(a.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const i=t.actionId?.(this.modObject);i?(this.setActionImage(e,i),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.href="",e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId(this.modObject)&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId?.(this.modObject))&&(!e.showWhen||e.showWhen(this.modObject))}}function On(e,t,i){return{inputs:e,label:t,direction:i,showWhen:t=>e.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function Hn(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),enableWhen:e.enableWhen?i=>e.enableWhen(t(i)):void 0,showWhen:e.showWhen?i=>e.showWhen(t(i)):void 0,extraCssClasses:e.extraCssClasses}}function qn(e){return Hn({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSpecOptions();a[e.fieldName]=s,i.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Bn(e){return Hn({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSimpleRotation();a[e.fieldName]=s,i.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function zn(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,defaultValue:e.defaultValue,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),enableWhen:e.enableWhen?i=>e.enableWhen(t(i)):void 0,showWhen:e.showWhen?i=>e.showWhen(t(i)):void 0,extraCssClasses:e.extraCssClasses}}function jn(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSpecOptions();a[e.fieldName]=s,i.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const i=t.setValue;t.setValue=(e,t,s)=>i(e,t,s/100)}return zn(t)}function $n(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSimpleRotation();a[e.fieldName]=s,i.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const i=t.setValue;t.setValue=(e,t,s)=>i(e,t,s/100)}return zn(t)}function Gn(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,values:e.values,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),enableWhen:e.enableWhen?i=>e.enableWhen(t(i)):void 0,showWhen:e.showWhen?i=>e.showWhen(t(i)):void 0}}function Kn(e){return Gn({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSpecOptions();a[e.fieldName]=s,i.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function Jn(e){return Gn({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSimpleRotation();a[e.fieldName]=s,i.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function Zn(e){const t=e.getModObject;return{type:"icon",actionId:i=>e.actionId(t(i)),states:e.states,showWhen:e.showWhen,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),extraCssClasses:e.extraCssClasses}}function Yn(e,t,i,s){return Zn({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>s?e.getValue(t)[i]==s:e.getValue(t)[i]),setValue:e.setFieldValue||((t,a,n)=>{const o=e.getValue(a);s?n?o[i]=s:o[i]==s&&(o[i]=0):o[i]=n,e.setValue(t,a,o)}),extraCssClasses:e.extraCssClasses})}function Qn(e){return Yn({getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,i)=>t.setSpecOptions(e,i),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.actionId,e.fieldName,e.value)}function Xn(e,t,i){return Zn({getModObject:e.getModObject,actionId:t,states:0,step:1,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:t=>e.getValue(t)[i],setValue:(t,s,a)=>{const n=e.getValue(s);a<0&&(a=0),n[i]=a,e.setValue(t,s,n)}})}function eo(e,t,i,s){const a=Xn(e,t,s);return a.states=3,a.improvedId=i,a}function to(e,t,i,s,a,n){const o=Xn(e,t,s);return o.states=i,o.step=a,o.reverse=n,o}function io(e,t,i,s,a,n){return function(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,direction:e.direction,tooltip:e.tooltip,values:e.values.map((e=>{if(e.showWhen){const i=e.showWhen;e.showWhen=e=>i(t(e))}return e})),equals:e.equals,showWhen:i=>!e.showWhen||e.showWhen(t(i)),zeroValue:e.zeroValue,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),extraCssClasses:e.extraCssClasses}}({values:i,zeroValue:0,numColumns:s,direction:a||Un.Vertical,tooltip:n,equals:(e,t)=>e==t,getModObject:e.getModObject,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:i=>e.getValue(i)[t],setValue:(i,s,a)=>{const n=e.getValue(s);n[t]=a,e.setValue(i,s,n)}})}function so(e){return io({showWhen:e.showWhen,getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,i)=>t.setSpecOptions(e,i),getFieldValue:e.getValue,setFieldValue:e.setValue,changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses},e.fieldName,e.values,e.numColumns,e.direction,e.tooltip)}const ao=(e,t,i)=>"icon"==i.type?new Wn(e,t,i):new Fn(e,t,i);function no(e,t){return e.label=t,e}function oo(e){return Yn({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,i)=>t.getRaid().setBuffs(e,i),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function lo(e){return Yn({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function ro(e){return Yn({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes(),setValue:(e,t,i)=>t.setConsumes(e,i),changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function co(e){return Yn({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes().miscConsumes??qe.create(),setValue:(e,t,i)=>{const s=t.getConsumes();s.miscConsumes=i,t.setConsumes(e,s)},changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function ho(e){return Yn({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,i)=>t.getRaid().setDebuffs(e,i),changeEmitter:e=>a.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function mo(e){return eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,i)=>t.getRaid().setBuffs(e,i),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function uo(e){return eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function po(e){return eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,i)=>t.getRaid().setDebuffs(e,i),changeEmitter:e=>a.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter])},e.actionId,e.impId,e.fieldName)}function go(e){return to({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,i)=>t.getRaid().setBuffs(e,i),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function fo(e){return to({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function Io(e){return to({getModObject:e=>e.getRaid(),getValue:e=>e.getDebuffs(),setValue:(e,t,i)=>t.setDebuffs(e,i),changeEmitter:e=>e.debuffsChangeEmitter},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function wo(e){return io({getModObject:e=>e,getValue:e=>e.getConsumes(),setValue:(e,t,i)=>t.setConsumes(e,i),changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter])},e.fieldName,e.values,e.numColumns,e.direction||Un.Vertical)}class vo extends g{constructor(e,t,i,s){super(e,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker","vertical"===(i.direction??Un.Horizontal)?"dropdown":"dropend"),this.simUI=s,this.config=i,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<a\n\t\t\t\tclass="icon-picker-button"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\taria-expanded="false"\n\t\t\t\tdata-disable-wowhead-touch-tooltip="true"\n\t\t\t\tdata-whtticon="false"\n\t\t\t></a>\n\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n\t    ';const a=this.rootElem.querySelector(".multi-icon-picker-label");i.label?a.textContent=i.label:a.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.direction==Un.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()})),this.buttonElem.addEventListener("contextmenu",(e=>e.preventDefault())),this.buttonElem.addEventListener("mousedown",(e=>{S(e)&&this.clearPicker()})),this.buildBlankOption(),this.pickers=this.config.inputs.map(((e,i)=>{const s=document.createElement("li");return s.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(s),new Wn(s,t,e)})),s.sim.waitForInit().then((()=>this.updateButtonImage())),s.changeEmitter.on((()=>{this.updateButtonImage(),this.showWhen()?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}))}showWhen(){return!this.config.showWhen||this.config.showWhen(this.simUI.sim.raid.getPlayer(0))&&!!this.pickers.find((e=>e.showWhen()))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t),t.addEventListener("click",(()=>this.clearPicker()))}clearPicker(){a.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(a.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.filter((e=>e.showWhen())).map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}const bo=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:1126,maxLevel:9},{id:5232,minLevel:10,maxLevel:19},{id:6756,minLevel:20,maxLevel:29},{id:5234,minLevel:30,maxLevel:39},{id:8907,minLevel:40,maxLevel:49},{id:9884,minLevel:50,maxLevel:59},{id:9885,minLevel:60}]),impId:E.fromSpellId(17055),fieldName:"giftOfTheWild"}),"Mark of the Wild"),xo=On([lo({actionId:()=>E.fromSpellId(20217),fieldName:"blessingOfKings",showWhen:e=>e.getFaction()===_e.Alliance}),oo({actionId:()=>E.fromSpellId(409580),fieldName:"aspectOfTheLion"})],"Stats %"),So=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:465,maxLevel:9},{id:10290,minLevel:10,maxLevel:19},{id:643,minLevel:20,maxLevel:29},{id:10291,minLevel:30,maxLevel:39},{id:1032,minLevel:40,maxLevel:49},{id:10292,minLevel:50,maxLevel:59},{id:10293,minLevel:60}]),impId:E.fromSpellId(20142),showWhen:e=>e.getFaction()===_e.Alliance,fieldName:"devotionAura"}),"Armor"),Eo=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:8071,minLevel:4,maxLevel:13},{id:8154,minLevel:14,maxLevel:23},{id:8155,minLevel:24,maxLevel:33},{id:10406,minLevel:34,maxLevel:43},{id:10407,minLevel:44,maxLevel:53},{id:10408,minLevel:54}]),impId:E.fromSpellId(16293),showWhen:e=>e.getFaction()===_e.Horde,fieldName:"stoneskinTotem"}),"Stoneskin"),yo=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:20911,minLevel:30,maxLevel:39},{id:20912,minLevel:40,maxLevel:49},{id:20913,minLevel:50,maxLevel:59},{id:20914,minLevel:60}]),showWhen:e=>e.getFaction()===_e.Alliance,fieldName:"blessingOfSanctuary"}),"Blessing of Sanctuary"),Po=On([oo({actionId:e=>e.getMatchingSpellActionId([{id:976,minLevel:30,maxLevel:41},{id:10957,minLevel:42,maxLevel:55},{id:10958,minLevel:56}]),fieldName:"shadowProtection"}),oo({actionId:e=>e.getMatchingSpellActionId([{id:19876,minLevel:28,maxLevel:39},{id:19895,minLevel:40,maxLevel:51},{id:19896,minLevel:52}]),fieldName:"shadowResistanceAura"}),oo({actionId:e=>e.getMatchingSpellActionId([{id:10595,minLevel:30,maxLevel:43},{id:10600,minLevel:44,maxLevel:59},{id:10601,minLevel:60}]),fieldName:"natureResistanceTotem",showWhen:e=>e.getFaction()===_e.Horde}),oo({actionId:e=>e.getMatchingSpellActionId([{id:20043,minLevel:46,maxLevel:55},{id:20190,minLevel:56}]),fieldName:"aspectOfTheWild"}),oo({actionId:e=>e.getMatchingSpellActionId([{id:19891,minLevel:36,maxLevel:47},{id:19899,minLevel:48,maxLevel:59},{id:19900,minLevel:60}]),fieldName:"fireResistanceAura",showWhen:e=>e.getFaction()===_e.Alliance}),oo({actionId:e=>e.getMatchingSpellActionId([{id:8184,minLevel:28,maxLevel:41},{id:10537,minLevel:42,maxLevel:57},{id:10538,minLevel:58}]),fieldName:"fireResistanceTotem",showWhen:e=>e.getFaction()===_e.Horde}),oo({actionId:e=>e.getMatchingSpellActionId([{id:19888,minLevel:32,maxLevel:43},{id:19897,minLevel:44,maxLevel:55},{id:19898,minLevel:56}]),fieldName:"frostResistanceAura",showWhen:e=>e.getFaction()===_e.Alliance}),oo({actionId:e=>e.getMatchingSpellActionId([{id:8181,minLevel:24,maxLevel:37},{id:10478,minLevel:38,maxLevel:53},{id:10479,minLevel:54}]),fieldName:"frostResistanceTotem",showWhen:e=>e.getFaction()===_e.Horde})],"Resistances"),ko=On([mo({actionId:e=>e.getMatchingSpellActionId([{id:1243,maxLevel:11},{id:1244,minLevel:12,maxLevel:23},{id:1245,minLevel:24,maxLevel:35},{id:2791,minLevel:36,maxLevel:47},{id:10937,minLevel:48,maxLevel:60},{id:10938,minLevel:60}]),impId:E.fromSpellId(14767),fieldName:"powerWordFortitude"}),oo({actionId:e=>e.getMatchingItemActionId([{id:1180,minLevel:5,maxLevel:19},{id:1711,minLevel:20,maxLevel:34},{id:4422,minLevel:35,maxLevel:49},{id:10307,minLevel:50}]),fieldName:"scrollOfStamina"})],"Stamina"),Co=On([mo({actionId:e=>e.getMatchingSpellActionId([{id:6307,minLevel:4,maxLevel:13},{id:7804,minLevel:14,maxLevel:25},{id:7805,minLevel:26,maxLevel:37},{id:11766,minLevel:38,maxLevel:49},{id:11767,minLevel:50}]),impId:E.fromSpellId(18696),fieldName:"bloodPact"}),oo({actionId:()=>E.fromSpellId(403215),fieldName:"commandingShout"})],"Blood Pact"),Lo=no(uo({actionId:e=>e.getMatchingSpellActionId([{id:19740,minLevel:4,maxLevel:11},{id:19834,minLevel:12,maxLevel:21},{id:19835,minLevel:22,maxLevel:31},{id:19836,minLevel:32,maxLevel:41},{id:19837,minLevel:42,maxLevel:51},{id:19838,minLevel:52}]),impId:E.fromSpellId(20048),fieldName:"blessingOfMight",showWhen:e=>e.getFaction()===_e.Alliance}),"Blessing of Might"),To=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:8075,minLevel:10,maxLevel:23},{id:8160,minLevel:24,maxLevel:37},{id:8161,minLevel:38,maxLevel:51},{id:10442,minLevel:52}]),impId:E.fromSpellId(16295),fieldName:"strengthOfEarthTotem",showWhen:e=>e.getFaction()===_e.Horde}),"Strength"),No=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:8835,minLevel:42,maxLevel:55},{id:10627,minLevel:56}]),impId:E.fromSpellId(16295),fieldName:"graceOfAirTotem",showWhen:e=>e.getFaction()===_e.Horde}),"Agility"),_o=On([oo({actionId:e=>e.getMatchingSpellActionId([{id:1459,maxLevel:13},{id:1460,minLevel:14,maxLevel:27},{id:1461,minLevel:28,maxLevel:41},{id:10156,minLevel:42,maxLevel:55},{id:10157,minLevel:56}]),fieldName:"arcaneBrilliance"}),oo({actionId:e=>e.getMatchingItemActionId([{id:955,minLevel:5,maxLevel:19},{id:2290,minLevel:20,maxLevel:34},{id:4419,minLevel:35,maxLevel:49},{id:10308,minLevel:50}]),fieldName:"scrollOfIntellect"})],"Intellect"),Ao=On([oo({actionId:e=>e.getMatchingSpellActionId([{id:14752,minLevel:30,maxLevel:39},{id:14818,minLevel:40,maxLevel:49},{id:14819,minLevel:50,maxLevel:59},{id:27841,minLevel:60}]),fieldName:"divineSpirit"}),oo({actionId:e=>e.getMatchingItemActionId([{id:1181,maxLevel:14},{id:1712,minLevel:15,maxLevel:29},{id:4424,minLevel:30,maxLevel:44},{id:10306,minLevel:45}]),fieldName:"scrollOfSpirit"})],"Spirit"),Ro=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:6673,maxLevel:11},{id:5242,minLevel:12,maxLevel:21},{id:6192,minLevel:22,maxLevel:31},{id:11549,minLevel:32,maxLevel:41},{id:11550,minLevel:42,maxLevel:51},{id:11551,minLevel:52}]),impId:E.fromSpellId(12861),fieldName:"battleShout"}),"Battle Shout"),Do=no(oo({actionId:e=>e.getMatchingSpellActionId([{id:19506,minLevel:40,maxLevel:49},{id:20905,minLevel:50,maxLevel:59},{id:20906,minLevel:60}]),fieldName:"trueshotAura"}),"Trueshot Aura"),Mo=no(uo({actionId:e=>e.getMatchingSpellActionId([{id:19742,minLevel:14,maxLevel:23},{id:19850,minLevel:24,maxLevel:33},{id:19852,minLevel:34,maxLevel:43},{id:19853,minLevel:44,maxLevel:53},{id:19854,minLevel:54}]),impId:E.fromSpellId(20245),fieldName:"blessingOfWisdom",showWhen:e=>e.getFaction()===_e.Alliance}),"Blessing of Wisdom"),Vo=no(mo({actionId:e=>e.getMatchingSpellActionId([{id:5675,minLevel:26,maxLevel:35},{id:10495,minLevel:36,maxLevel:45},{id:10496,minLevel:46,maxLevel:55},{id:10497,minLevel:56}]),impId:E.fromSpellId(16208),fieldName:"manaSpringTotem",showWhen:e=>e.getFaction()===_e.Horde}),"Mana Spring Totem"),Uo=no(go({actionId:()=>E.fromSpellId(402668),numStates:21,fieldName:"vampiricTouch",multiplier:20}),"Vampiric Touch MP5"),Wo=no(oo({actionId:e=>e.getMatchingSpellActionId([{id:24932,minLevel:40}]),fieldName:"leaderOfThePack"}),"Leader of the Pack"),Fo=no(oo({actionId:e=>e.getMatchingSpellActionId([{id:24907,minLevel:40}]),fieldName:"moonkinAura"}),"Moonkin Aura"),Oo=no(go({actionId:()=>E.fromSpellId(425464),numStates:21,fieldName:"demonicPact",multiplier:10}),"Demonic Pact"),Ho=oo({actionId:e=>e.getMatchingSpellActionId([{id:457544,minLevel:60}]),fieldName:"improvedStoneskinWindwall"}),qo=mo({actionId:e=>e.getMatchingSpellActionId([{id:7294,minLevel:16,maxLevel:25},{id:10298,minLevel:26,maxLevel:35},{id:10299,minLevel:36,maxLevel:45},{id:10300,minLevel:46,maxLevel:55},{id:10301,minLevel:56}]),impId:E.fromSpellId(20092),fieldName:"retributionAura",showWhen:e=>e.getFaction()===_e.Alliance}),Bo=oo({actionId:e=>e.getMatchingSpellActionId([{id:20218,minLevel:30}]),fieldName:"sanctityAura",showWhen:e=>e.getFaction()===_e.Alliance}),zo=mo({actionId:e=>e.getMatchingSpellActionId([{id:467,minLevel:6,maxLevel:13},{id:782,minLevel:14,maxLevel:23},{id:1075,minLevel:24,maxLevel:33},{id:8914,minLevel:34,maxLevel:43},{id:9756,minLevel:44,maxLevel:53},{id:9910,minLevel:54}]),impId:E.fromSpellId(16840),fieldName:"thorns"}),jo=fo({actionId:e=>e.getMatchingSpellActionId([{id:29166,minLevel:40}]),numStates:11,fieldName:"innervates"}),$o=fo({actionId:e=>e.getMatchingSpellActionId([{id:10060,minLevel:40}]),numStates:11,fieldName:"powerInfusions"}),Go=go({actionId:e=>e.getMatchingSpellActionId([{id:23060,minLevel:40}]),numStates:6,fieldName:"battleSquawk"}),Ko=On([lo({actionId:()=>E.fromSpellId(22888),fieldName:"rallyingCryOfTheDragonslayer"}),lo({actionId:()=>E.fromSpellId(461475),fieldName:"valorOfAzeroth"})],"Dragonslayer Buff");no(lo({actionId:()=>E.fromSpellId(24425),fieldName:"spiritOfZandalar"}),"Spirit of Zandalar");const Jo=no(lo({actionId:()=>E.fromSpellId(15366),fieldName:"songflowerSerenade"}),"Songflower Serenade"),Zo=no(lo({actionId:()=>E.fromSpellId(16609),fieldName:"warchiefsBlessing",showWhen:e=>e.getFaction()===_e.Horde}),"Warchief's Blessing"),Yo=no(lo({actionId:()=>E.fromSpellId(460940),fieldName:"mightOfStormwind",showWhen:e=>e.getFaction()===_e.Alliance}),"Might Of Stormwind"),Qo=e=>{return io({getModObject:e=>e,showWhen:e=>!t.faction||t.faction==e.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},(t={direction:Un.Horizontal,values:[{iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_02.jpg",value:Be.SaygesUnknown,text:"Sayge's Dark Fortune"},...e.map((e=>e.config))],fieldName:"saygesFortune"}).fieldName,t.values,t.numColumns,t.direction||Un.Vertical);var t},Xo={actionId:()=>E.fromSpellId(23768),value:Be.SaygesDamage,text:"Sayge's Damage"},el={actionId:()=>E.fromSpellId(23736),value:Be.SaygesAgility,text:"Sayge's Agility"},tl={actionId:()=>E.fromSpellId(23766),value:Be.SaygesIntellect,text:"Sayge's Intellect"},il={actionId:()=>E.fromSpellId(23738),value:Be.SaygesSpirit,text:"Sayge's Spirit"},sl={actionId:()=>E.fromSpellId(23737),value:Be.SaygesStamina,text:"Sayge's Stamina"},al=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:22817,minLevel:51}]),fieldName:"fengusFerocity"}),"Fengus' Ferocity"),nl=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:22818,minLevel:51}]),fieldName:"moldarsMoxie"}),"Moldar's Moxie"),ol=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:22820,minLevel:51}]),fieldName:"slipkiksSavvy"}),"Slip'kik's Savvy"),ll=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:430947,maxLevel:39}]),fieldName:"boonOfBlackfathom"}),"Boon of Blackfathom"),rl=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:430352,maxLevel:39}]),fieldName:"ashenvalePvpBuff"}),"Ashenvale PvP Buff"),dl=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:438536,maxLevel:49}]),fieldName:"sparkOfInspiration"}),"Spark of Inspiration"),cl=no(lo({actionId:e=>e.getMatchingSpellActionId([{id:446695,maxLevel:59}]),fieldName:"fervorOfTheTempleExplorer"}),"Fervor Of The Temple Explorer"),hl=On([ho({actionId:e=>e.getMatchingSpellActionId([{id:7386,minLevel:10,maxLevel:21},{id:7405,minLevel:22,maxLevel:33},{id:8380,minLevel:34,maxLevel:45},{id:11596,minLevel:46,maxLevel:57},{id:11597,minLevel:58}]),fieldName:"sunderArmor"}),po({actionId:e=>e.getMatchingSpellActionId([{id:8647,minLevel:14,maxLevel:25},{id:8649,minLevel:26,maxLevel:35},{id:8650,minLevel:36,maxLevel:45},{id:11197,minLevel:46,maxLevel:55},{id:11198,minLevel:56}]),impId:E.fromSpellId(14169),fieldName:"exposeArmor"}),po({actionId:e=>e.getMatchingSpellActionId([{id:439500,minLevel:60}]),impId:E.fromSpellId(14169),fieldName:"sebaciousPoison"}),Io({actionId:()=>E.fromSpellId(402818),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"})],"Major Armor Penetration"),ml=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:704,minLevel:14,maxLevel:27},{id:7658,minLevel:28,maxLevel:41},{id:7659,minLevel:42,maxLevel:55},{id:11717,minLevel:56}]),fieldName:"curseOfRecklessness"}),"Curse of Recklessness"),ul=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:770,minLevel:18,maxLevel:29},{id:778,minLevel:30,maxLevel:41},{id:9749,minLevel:42,maxLevel:53},{id:9907,minLevel:54}]),fieldName:"faerieFire"}),"Faerie Fire"),pl=no(po({actionId:e=>e.getMatchingSpellActionId([{id:702,minLevel:4,maxLevel:11},{id:1108,minLevel:12,maxLevel:21},{id:6205,minLevel:22,maxLevel:31},{id:7646,minLevel:32,maxLevel:41},{id:11707,minLevel:42,maxLevel:51},{id:11708,minLevel:52}]),impId:E.fromSpellId(18181),fieldName:"curseOfWeakness"}),"Curse of Weakness"),gl=On([po({actionId:e=>e.getMatchingSpellActionId([{id:1160,minLevel:14,maxLevel:23},{id:6190,minLevel:24,maxLevel:33},{id:11554,minLevel:34,maxLevel:43},{id:11555,minLevel:44,maxLevel:53},{id:11556,minLevel:54}]),impId:E.fromSpellId(12879),fieldName:"demoralizingShout"}),po({actionId:e=>e.getMatchingSpellActionId([{id:99,minLevel:10,maxLevel:19},{id:1735,minLevel:20,maxLevel:31},{id:9490,minLevel:32,maxLevel:41},{id:9747,minLevel:42,maxLevel:51},{id:9898,minLevel:52}]),impId:E.fromSpellId(16862),fieldName:"demoralizingRoar"}),Io({actionId:()=>E.fromSpellId(402811),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"})],"Attack Power"),fl=no(ho({actionId:()=>E.fromSpellId(409828),fieldName:"mangle"}),"Bleed"),Il=On([po({actionId:()=>E.fromSpellId(6343),impId:E.fromSpellId(12666),fieldName:"thunderClap"}),Io({actionId:()=>E.fromSpellId(402808),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"}),ho({actionId:()=>E.fromSpellId(408699),fieldName:"waylay"})],"Attack Speed"),wl=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:5570,minLevel:20,maxLevel:29},{id:24974,minLevel:30,maxLevel:39},{id:24975,minLevel:40,maxLevel:49},{id:24976,minLevel:50,maxLevel:59},{id:24977,minLevel:60}]),fieldName:"insectSwarm"}),"Insect Swarm"),vl=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:17803,minLevel:10}]),fieldName:"improvedShadowBolt"}),"Improved Shadow Bolt"),bl=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:12873,minLevel:40}]),fieldName:"improvedScorch"}),"Fire Damage"),xl=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:28595,minLevel:40}]),fieldName:"wintersChill"}),"Frost Damage"),Sl=On([ho({actionId:e=>e.getMatchingSpellActionId([{id:17364,minLevel:40}]),fieldName:"stormstrike"}),ho({actionId:()=>E.fromSpellId(408258),fieldName:"dreamstate"})],"Nature Damage"),El=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:15334,minLevel:40}]),fieldName:"shadowWeaving"}),"Shadow Weaving"),yl=On([ho({actionId:e=>e.getMatchingSpellActionId([{id:461615}]),fieldName:"markOfChaos"}),ho({actionId:e=>e.getMatchingSpellActionId([{id:1490,minLevel:32,maxLevel:45},{id:11721,minLevel:46,maxLevel:59},{id:11722,minLevel:60}]),fieldName:"curseOfElements"}),ho({actionId:e=>e.getMatchingSpellActionId([{id:17862,minLevel:44,maxLevel:59},{id:17937,minLevel:60}]),fieldName:"curseOfShadow"})],"Warlock Curses"),Pl=no(ho({actionId:e=>e.getMatchingItemActionId([{id:226374,minLevel:54}]),fieldName:"occultPoison"}),"Occult Poison"),kl=no(po({actionId:e=>e.getMatchingSpellActionId([{id:1130,minLevel:6,maxLevel:21},{id:14323,minLevel:22,maxLevel:39},{id:14324,minLevel:40,maxLevel:57},{id:14325,minLevel:58}]),impId:E.fromSpellId(19425),fieldName:"huntersMark"}),"Hunter's Mark"),Cl=no(ho({actionId:e=>e.getMatchingSpellActionId([{id:20186,minLevel:38,maxLevel:57},{id:20355,minLevel:58}]),fieldName:"judgementOfWisdom",showWhen:e=>e.getFaction()===_e.Alliance}),"Judgement of Wisdom"),Ll=no(po({actionId:e=>e.getMatchingSpellActionId([{id:20300,minLevel:22,maxLevel:31},{id:20301,minLevel:32,maxLevel:41},{id:20302,minLevel:42,maxLevel:51},{id:20303,minLevel:52}]),impId:E.fromSpellId(20337),fieldName:"judgementOfTheCrusader",showWhen:e=>e.getFaction()===_e.Alliance}),"Judgement of the Crusader"),Tl=ho({actionId:e=>e.getMatchingSpellActionId([{id:455864,minLevel:60}]),fieldName:"improvedFaerieFire"}),Nl=ho({actionId:e=>e.getMatchingItemActionId([{id:213409,minLevel:40,maxLevel:45}]),fieldName:"mekkatorqueFistDebuff"}),_l=ho({actionId:e=>e.getMatchingItemActionId([{id:220589,minLevel:50,maxLevel:55}]),fieldName:"serpentsStrikerFistDebuff"}),Al=ho({actionId:e=>e.getMatchingSpellActionId([{id:20185,minLevel:30,maxLevel:39},{id:20344,minLevel:40,maxLevel:49},{id:20345,minLevel:50,maxLevel:59},{id:20346,minLevel:60}]),fieldName:"judgementOfLight",showWhen:e=>e.getFaction()===_e.Alliance}),Rl=ho({actionId:e=>e.getMatchingSpellActionId([{id:427143,minLevel:25}]),fieldName:"curseOfVulnerability"}),Dl=ho({actionId:e=>e.getMatchingSpellActionId([{id:11374,minLevel:41}]),fieldName:"giftOfArthas"}),Ml=ho({actionId:e=>e.getMatchingSpellActionId([{id:15235,minLevel:47}]),fieldName:"crystalYield"}),Vl=Io({actionId:()=>E.fromItemId(209562),numStates:11,multiplier:10,reverse:!0,fieldName:"ancientCorrosivePoison"}),Ul=[{config:bo,picker:Wn,stats:[]},{config:xo,picker:vo,stats:[]},{config:ko,picker:vo,stats:[c.StatStamina]},{config:Co,picker:vo,stats:[c.StatStamina]},{config:_o,picker:vo,stats:[c.StatIntellect]},{config:Ao,picker:vo,stats:[c.StatSpirit]},{config:So,picker:Wn,stats:[c.StatArmor]},{config:Eo,picker:Wn,stats:[c.StatArmor]},{config:yo,picker:Wn,stats:[c.StatArmor]},{config:Po,picker:vo,stats:[c.StatNatureResistance,c.StatShadowResistance,c.StatFireResistance,c.StatFrostResistance]},{config:Lo,picker:Wn,stats:[c.StatStrength,c.StatAgility,c.StatAttackPower]},{config:To,picker:Wn,stats:[c.StatStrength]},{config:Ro,picker:Wn,stats:[c.StatAttackPower]},{config:No,picker:Wn,stats:[c.StatAgility]},{config:Do,picker:Wn,stats:[c.StatRangedAttackPower]},{config:Wo,picker:Wn,stats:[c.StatMeleeCrit]},{config:Oo,picker:Wn,stats:[c.StatSpellPower]},{config:Fo,picker:Wn,stats:[c.StatSpellCrit]},{config:Mo,picker:Wn,stats:[c.StatMP5]},{config:Vo,picker:Wn,stats:[c.StatMP5]},{config:Uo,picker:Wn,stats:[c.StatMP5]}],Wl=[{config:Ho,picker:Wn,stats:[c.StatArmor]},{config:zo,picker:Wn,stats:[c.StatArmor]},{config:qo,picker:Wn,stats:[c.StatArmor]},{config:Bo,picker:Wn,stats:[c.StatHolyPower]},{config:jo,picker:Wn,stats:[c.StatMP5]},{config:$o,picker:Wn,stats:[c.StatMP5,c.StatSpellPower]},{config:Go,picker:Wn,stats:[c.StatMeleeHaste]}],Fl=[{config:Ko,picker:vo,stats:[]},{config:Jo,picker:Wn,stats:[]},{config:Zo,picker:Wn,stats:[c.StatHealth,c.StatMeleeHaste,c.StatMP5]},{config:Yo,picker:Wn,stats:[c.StatHealth,c.StatMeleeHaste,c.StatMP5]},{config:cl,picker:Wn,stats:[c.StatSpellPower,c.StatAttackPower]},{config:dl,picker:Wn,stats:[c.StatSpellPower,c.StatMeleeHaste,c.StatRangedAttackPower]},{config:ll,picker:Wn,stats:[c.StatMeleeCrit,c.StatSpellCrit,c.StatAttackPower]},{config:rl,picker:Wn,stats:[c.StatAttackPower,c.StatSpellPower]},{config:al,picker:Wn,stats:[c.StatAttackPower]},{config:nl,picker:Wn,stats:[c.StatStamina]},{config:ol,picker:Wn,stats:[c.StatSpellCrit]}],Ol=[{config:Xo,stats:[]},{config:el,stats:[c.StatAgility]},{config:tl,stats:[c.StatIntellect]},{config:il,stats:[c.StatSpirit,c.StatMP5]},{config:sl,stats:[c.StatStamina]}],Hl=[{config:hl,stats:[c.StatAttackPower],picker:vo},{config:ml,picker:Wn,stats:[c.StatAttackPower]},{config:ul,picker:Wn,stats:[c.StatAttackPower]},{config:fl,picker:Wn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Ll,picker:Wn,stats:[c.StatHolyPower]},{config:vl,picker:Wn,stats:[c.StatShadowPower]},{config:bl,picker:Wn,stats:[c.StatFirePower]},{config:xl,picker:Wn,stats:[c.StatFrostPower]},{config:Sl,picker:vo,stats:[c.StatNaturePower]},{config:El,picker:Wn,stats:[c.StatShadowPower]},{config:yl,picker:vo,stats:[c.StatSpellPower]},{config:Pl,picker:Wn,stats:[c.StatSpellPower]},{config:gl,picker:vo,stats:[c.StatArmor]},{config:Il,picker:vo,stats:[c.StatArmor]},{config:pl,picker:Wn,stats:[c.StatArmor]},{config:wl,picker:Wn,stats:[c.StatDodge]},{config:kl,picker:Wn,stats:[c.StatRangedAttackPower]},{config:Cl,picker:Wn,stats:[c.StatMP5,c.StatIntellect]}],ql=[{config:Tl,picker:Wn,stats:[]},{config:Nl,picker:Wn,stats:[c.StatSpellPower]},{config:_l,picker:Wn,stats:[c.StatNaturePower,c.StatHolyPower]},{config:Rl,picker:Wn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Dl,picker:Wn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Ml,picker:Wn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Vl,picker:Wn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Al,picker:Wn,stats:[c.StatStamina]}],Bl={actionId:e=>e.getMatchingItemActionId([{id:6947,minLevel:20,maxLevel:27},{id:6949,minLevel:28,maxLevel:35},{id:6950,minLevel:36,maxLevel:43},{id:8926,minLevel:44,maxLevel:51},{id:8927,minLevel:52,maxLevel:59},{id:8928,minLevel:60,maxLevel:60}]),value:ze.InstantPoison,showWhen:e=>e.getClass()==l.ClassRogue},zl={actionId:e=>e.getMatchingItemActionId([{id:2892,minLevel:30,maxLevel:37},{id:2893,minLevel:38,maxLevel:45},{id:8984,minLevel:46,maxLevel:53},{id:8985,minLevel:54,maxLevel:59},{id:20844,minLevel:60,maxLevel:60}]),value:ze.DeadlyPoison,showWhen:e=>e.getClass()==l.ClassRogue},jl={actionId:e=>e.getMatchingItemActionId([{id:10918,minLevel:32,maxLevel:39},{id:10920,minLevel:40,maxLevel:47},{id:10921,minLevel:48,maxLevel:55},{id:10922,minLevel:56,maxLevel:60}]),value:ze.WoundPoison,showWhen:e=>e.getClass()==l.ClassRogue};ze.OccultPoison,ze.SebaciousPoison;const $l=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8017,minLevel:1,maxLevel:7},{id:8018,minLevel:8,maxLevel:15},{id:8019,minLevel:16,maxLevel:23},{id:10399,minLevel:24,maxLevel:33},{id:16314,minLevel:34,maxLevel:43},{id:16315,minLevel:44,maxLevel:53},{id:16316,minLevel:54}]),value:ze.RockbiterWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Gl=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8024,minLevel:10,maxLevel:17},{id:8027,minLevel:18,maxLevel:25},{id:8030,minLevel:26,maxLevel:35},{id:16339,minLevel:36,maxLevel:45},{id:16341,minLevel:46,maxLevel:55},{id:16342,minLevel:56}]),value:ze.FlametongueWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Kl=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8033,minLevel:20,maxLevel:27},{id:8038,minLevel:28,maxLevel:37},{id:10456,minLevel:38,maxLevel:47},{id:16355,minLevel:48,maxLevel:57},{id:16356,minLevel:58}]),value:ze.FrostbrandWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Jl=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8232,minLevel:30,maxLevel:39},{id:8235,minLevel:40,maxLevel:49},{id:10486,minLevel:50,maxLevel:59},{id:16362,minLevel:60}]),value:ze.WindfuryWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)});function Zl(e){return(t,i)=>({type:"iconEnum",tooltip:i,numColumns:t.length>11?4:t.length>8?3:t.length>5?2:1,values:[{value:0}].concat(t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>!e.config.showWhen||e.config.showWhen(t)})))),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,i,s)=>{const n=i.getConsumes();n[e.consumesFieldName]!==s&&(n[e.consumesFieldName]=s,a.freezeAllAndDo((()=>{i.setConsumes(t,n),e.onSet&&e.onSet(t,i,s)})))}})}const Yl={actionId:()=>E.fromItemId(4381),value:$e.ConjuredMinorRecombobulator,showWhen:e=>e.getGear().hasTrinket(4381)},Ql={actionId:e=>e.getMatchingItemActionId([{id:12662,minLevel:40}]),value:$e.ConjuredDemonicRune},Xl={actionId:e=>e.getMatchingItemActionId([{id:7676,minLevel:25}]),value:$e.ConjuredRogueThistleTea,showWhen:e=>e.getClass()==l.ClassRogue},er=[{config:Yl,stats:[c.StatIntellect]},{config:Ql,stats:[c.StatIntellect]},{config:Xl,stats:[]}],tr=Zl({consumesFieldName:"defaultConjured"}),ir={actionId:e=>e.getMatchingItemActionId([{id:217308,minLevel:40}]),value:Ge.InnovationSigil},sr=[{config:{actionId:e=>e.getMatchingItemActionId([{id:221028,minLevel:50}]),value:Ge.LivingDreamsSigil},stats:[]},{config:ir,stats:[]}],ar=Zl({consumesFieldName:"enchantedSigil",showWhen:e=>e.hasProfession(F.Enchanting)}),nr={actionId:e=>e.getMatchingItemActionId([{id:10507,minLevel:40}]),showWhen:e=>e.hasProfession(F.Engineering),value:Ke.ExplosiveSolidDynamite},or={actionId:e=>e.getMatchingItemActionId([{id:4395,minLevel:40}]),showWhen:e=>e.hasProfession(F.Engineering),value:Ke.ExplosiveGoblinLandMine},lr={actionId:e=>e.getMatchingItemActionId([{id:18641,minLevel:50}]),showWhen:e=>e.hasProfession(F.Engineering),value:Ke.ExplosiveDenseDynamite},rr={actionId:e=>e.getMatchingItemActionId([{id:15993,minLevel:50}]),showWhen:e=>e.hasProfession(F.Engineering),value:Ke.ExplosiveThoriumGrenade},dr=[{config:{actionId:e=>e.getMatchingItemActionId([{id:215168,minLevel:40}]),value:Ke.ExplosiveEzThroRadiationBomb},stats:[]},{config:{actionId:e=>e.getMatchingItemActionId([{id:215127,minLevel:40}]),showWhen:e=>e.hasProfession(F.Engineering),value:Ke.ExplosiveHighYieldRadiationBomb},stats:[]},{config:nr,stats:[]},{config:lr,stats:[]},{config:rr,stats:[]},{config:or,stats:[]}],cr=Zl({consumesFieldName:"fillerExplosive"}),hr=ro({actionId:e=>e.getMatchingItemActionId([{id:10646,minLevel:50}]),fieldName:"sapper",showWhen:e=>e.hasProfession(F.Engineering)}),mr={actionId:e=>e.getMatchingItemActionId([{id:13510,minLevel:51}]),value:Je.FlaskOfTheTitans},ur={actionId:e=>e.getMatchingItemActionId([{id:13511,minLevel:51}]),value:Je.FlaskOfDistilledWisdom},pr={actionId:e=>e.getMatchingItemActionId([{id:13512,minLevel:51}]),value:Je.FlaskOfSupremePower},gr={actionId:e=>e.getMatchingItemActionId([{id:13513,minLevel:51}]),value:Je.FlaskOfChromaticResistance},fr={actionId:e=>e.getMatchingItemActionId([{id:222952,minLevel:50,maxLevel:59}]),value:Je.FlaskOfRestlessDreams,showWhen:e=>e.hasProfession(F.Alchemy)},Ir={actionId:e=>e.getMatchingItemActionId([{id:221024,minLevel:50,maxLevel:59}]),value:Je.FlaskOfEverlastingNightmares,showWhen:e=>e.hasProfession(F.Alchemy)},wr=[{config:mr,stats:[c.StatStamina]},{config:ur,stats:[c.StatIntellect]},{config:pr,stats:[c.StatMP5,c.StatSpellPower]},{config:gr,stats:[c.StatStamina]},{config:fr,stats:[c.StatSpellPower]},{config:Ir,stats:[c.StatAttackPower]}],vr=Zl({consumesFieldName:"flask"}),br={actionId:e=>e.getMatchingItemActionId([{id:21023,minLevel:55}]),value:Ze.FoodDirgesKickChimaerokChops},xr={actionId:e=>e.getMatchingItemActionId([{id:13928,minLevel:50}]),value:Ze.FoodGrilledSquid},Sr={actionId:e=>e.getMatchingItemActionId([{id:20452,minLevel:51}]),value:Ze.FoodSmokedDesertDumpling},Er={actionId:e=>e.getMatchingItemActionId([{id:18254,minLevel:51}]),value:Ze.FoodRunnTumTuberSurprise},yr={actionId:e=>e.getMatchingItemActionId([{id:13810,minLevel:45}]),value:Ze.FoodBlessSunfruit},Pr={actionId:e=>e.getMatchingItemActionId([{id:13813,minLevel:45}]),value:Ze.FoodBlessedSunfruitJuice},kr={actionId:e=>e.getMatchingItemActionId([{id:13931,minLevel:35}]),value:Ze.FoodNightfinSoup},Cr={actionId:e=>e.getMatchingItemActionId([{id:18045,minLevel:40}]),value:Ze.FoodTenderWolfSteak},Lr={actionId:e=>e.getMatchingItemActionId([{id:21217,minLevel:30}]),value:Ze.FoodSagefishDelight},Tr={actionId:e=>e.getMatchingItemActionId([{id:13851,minLevel:25}]),value:Ze.FoodHotWolfRibs},Nr={actionId:e=>e.getMatchingItemActionId([{id:21072,minLevel:10}]),value:Ze.FoodSmokedSagefish},_r=[{config:br,stats:[c.StatStamina]},{config:xr,stats:[c.StatAgility]},{config:Sr,stats:[c.StatStrength]},{config:Er,stats:[c.StatIntellect]},{config:yr,stats:[c.StatStrength]},{config:Pr,stats:[c.StatSpirit]},{config:kr,stats:[c.StatMP5]},{config:Cr,stats:[c.StatStamina,c.StatSpirit]},{config:Lr,stats:[c.StatMP5]},{config:Tr,stats:[c.StatSpirit]},{config:Nr,stats:[c.StatMP5]}],Ar=Zl({consumesFieldName:"food"}),Rr=ro({actionId:e=>e.getMatchingItemActionId([{id:12217,minLevel:35}]),fieldName:"dragonBreathChili"}),Dr={actionId:e=>e.getMatchingItemActionId([{id:21151,minLevel:1}]),value:Ye.AlcoholRumseyRumLight},Mr={actionId:e=>e.getMatchingItemActionId([{id:18269,minLevel:56}]),value:Ye.AlcoholGordokGreenGrog},Vr={actionId:e=>e.getMatchingItemActionId([{id:21114,minLevel:1}]),value:Ye.AlcoholRumseyRumDark},Ur={actionId:e=>e.getMatchingItemActionId([{id:20709,minLevel:1}]),value:Ye.AlcoholRumseyRumLight},Wr={actionId:e=>e.getMatchingItemActionId([{id:18284,minLevel:56}]),value:Ye.AlcoholKreegsStoutBeatdown},Fr=[{config:Dr,stats:[c.StatStamina]},{config:Mr,stats:[c.StatStamina]},{config:Vr,stats:[c.StatStamina]},{config:Ur,stats:[c.StatStamina]},{config:Wr,stats:[c.StatSpirit]}],Or=Zl({consumesFieldName:"alcohol"}),Hr={actionId:e=>e.getMatchingItemActionId([{id:13445,minLevel:43}]),value:Qe.ElixirOfSuperiorDefense},qr={actionId:e=>e.getMatchingItemActionId([{id:8951,minLevel:29}]),value:Qe.ElixirOfGreaterDefense},Br={actionId:e=>e.getMatchingItemActionId([{id:3389,minLevel:16}]),value:Qe.ElixirOfDefense},zr={actionId:e=>e.getMatchingItemActionId([{id:5997,minLevel:1}]),value:Qe.ElixirOfMinorDefense},jr={actionId:e=>e.getMatchingItemActionId([{id:3013,minLevel:1,maxLevel:14},{id:1478,minLevel:15,maxLevel:29},{id:4421,minLevel:30,maxLevel:44},{id:10305,minLevel:45}]),value:Qe.ScrollOfProtection},$r=[{config:Hr,stats:[c.StatArmor]},{config:qr,stats:[c.StatArmor]},{config:Br,stats:[c.StatArmor]},{config:zr,stats:[c.StatArmor]},{config:jr,stats:[c.StatArmor]}],Gr=Zl({consumesFieldName:"armorElixir"}),Kr={actionId:e=>e.getMatchingItemActionId([{id:3825,minLevel:25}]),value:Xe.ElixirOfFortitude},Jr={actionId:e=>e.getMatchingItemActionId([{id:2458,minLevel:2}]),value:Xe.ElixirOfMinorFortitude},Zr=[{config:Kr,stats:[c.StatStamina]},{config:Jr,stats:[c.StatStamina]}],Yr=Zl({consumesFieldName:"healthElixir"}),Qr={actionId:e=>e.getMatchingItemActionId([{id:12460,minLevel:55}]),value:et.JujuMight},Xr={actionId:e=>e.getMatchingItemActionId([{id:12820,minLevel:45}]),value:et.WinterfallFirewater},ed=[{config:Qr,stats:[c.StatAttackPower]},{config:Xr,stats:[c.StatAttackPower]}],td=Zl({consumesFieldName:"attackPowerBuff"}),id={actionId:e=>e.getMatchingItemActionId([{id:13452,minLevel:46}]),value:tt.ElixirOfTheMongoose},sd={actionId:e=>e.getMatchingItemActionId([{id:9187,minLevel:38}]),value:tt.ElixirOfGreaterAgility},ad={actionId:e=>e.getMatchingItemActionId([{id:8949,minLevel:27}]),value:tt.ElixirOfAgility},nd={actionId:e=>e.getMatchingItemActionId([{id:3390,minLevel:18}]),value:tt.ElixirOfLesserAgility},od={actionId:e=>e.getMatchingItemActionId([{id:3012,minLevel:10,maxLevel:24},{id:1477,minLevel:25,maxLevel:39},{id:4425,minLevel:40,maxLevel:54},{id:10309,minLevel:55}]),value:tt.ScrollOfAgility},ld=[{config:id,stats:[c.StatAgility,c.StatMeleeCrit]},{config:sd,stats:[c.StatAgility]},{config:ad,stats:[c.StatAgility]},{config:nd,stats:[c.StatAgility]},{config:od,stats:[c.StatAgility]}],rd=Zl({consumesFieldName:"agilityElixir"}),dd={actionId:e=>e.getMatchingItemActionId([{id:12451,minLevel:55}]),value:it.JujuPower},cd={actionId:e=>e.getMatchingItemActionId([{id:9206,minLevel:46}]),value:it.ElixirOfGiants},hd={actionId:e=>e.getMatchingItemActionId([{id:3391,minLevel:20}]),value:it.ElixirOfOgresStrength},md={actionId:e=>e.getMatchingItemActionId([{id:954,minLevel:10,maxLevel:24},{id:2289,minLevel:25,maxLevel:39},{id:4426,minLevel:40,maxLevel:54},{id:10310,minLevel:55}]),value:it.ScrollOfStrength},ud=[{config:dd,stats:[c.StatStrength]},{config:cd,stats:[c.StatStrength]},{config:hd,stats:[c.StatStrength]},{config:md,stats:[c.StatStrength]}],pd=Zl({consumesFieldName:"strengthBuff"}),gd={actionId:e=>e.getMatchingItemActionId([{id:8410,minLevel:45}]),value:st.ROIDS},fd={actionId:e=>e.getMatchingItemActionId([{id:8412,minLevel:45}]),value:st.GroundScorpokAssay},Id={actionId:e=>e.getMatchingItemActionId([{id:8411,minLevel:45}]),value:st.LungJuiceCocktail},wd={actionId:e=>e.getMatchingItemActionId([{id:8423,minLevel:45}]),value:st.CerebralCortexCompound},vd={actionId:e=>e.getMatchingItemActionId([{id:8424,minLevel:45}]),value:st.GizzardGum};st.SpiritOfZanza;const bd={actionId:()=>E.fromItemId(221196),value:st.AtalaiMojoOfWar,showWhen:e=>50==e.getLevel()},xd={actionId:()=>E.fromItemId(221030),value:st.AtalaiMojoOfForbiddenMagic,showWhen:e=>50==e.getLevel()},Sd={actionId:()=>E.fromItemId(221311),value:st.AtalaiMojoOfLife,showWhen:e=>50==e.getLevel()},Ed=[{config:gd,stats:[c.StatStrength]},{config:fd,stats:[c.StatAgility]},{config:Id,stats:[c.StatStamina]},{config:wd,stats:[c.StatIntellect]},{config:vd,stats:[c.StatSpirit]},{config:bd,stats:[c.StatAttackPower]},{config:xd,stats:[c.StatSpellPower]},{config:Sd,stats:[c.StatHealingPower]}],yd=Zl({consumesFieldName:"zanzaBuff"}),Pd=[{config:On([co({actionId:e=>e.getMatchingItemActionId([{id:213407,minLevel:20}]),fieldName:"catnip",showWhen:e=>e.getClass()===l.ClassDruid}),co({actionId:()=>E.fromItemId(210708),fieldName:"elixirOfCoalescedRegret"}),co({actionId:()=>E.fromItemId(5206),fieldName:"boglingRoot"})],"",Un.Vertical),picker:vo,stats:[]}],kd=wo({direction:Un.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>E.fromItemId(3012),value:1,showWhen:e=>e.getLevel()>=10},{actionId:()=>E.fromItemId(1477),value:2,showWhen:e=>e.getLevel()>=25},{actionId:()=>E.fromItemId(4425),value:3,showWhen:e=>e.getLevel()>=40},{actionId:()=>E.fromItemId(10309),value:4,showWhen:e=>e.getLevel()>=55}],fieldName:"petScrollOfAgility"}),Cd=wo({direction:Un.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>E.fromItemId(954),value:1,showWhen:e=>e.getLevel()>=10},{actionId:()=>E.fromItemId(2289),value:2,showWhen:e=>e.getLevel()>=25},{actionId:()=>E.fromItemId(4426),value:3,showWhen:e=>e.getLevel()>=40},{actionId:()=>E.fromItemId(10310),value:4,showWhen:e=>e.getLevel()>=55}],fieldName:"petScrollOfStrength"}),Ld={actionId:()=>E.fromItemId(3385),value:at.LesserManaPotion},Td={actionId:e=>e.getMatchingItemActionId([{id:3827,minLevel:22}]),value:at.ManaPotion},Nd={actionId:e=>e.getMatchingItemActionId([{id:6149,minLevel:31}]),value:at.GreaterManaPotion},_d={actionId:e=>e.getMatchingItemActionId([{id:13443,minLevel:41}]),value:at.SuperiorManaPotion},Ad={actionId:e=>e.getMatchingItemActionId([{id:13444,minLevel:49}]),value:at.MajorManaPotion},Rd={actionId:e=>e.getMatchingItemActionId([{id:13442,minLevel:46}]),value:at.MightyRagePotion,showWhen:e=>e.getClass()==l.ClassWarrior},Dd={actionId:e=>e.getMatchingItemActionId([{id:5633,minLevel:25}]),value:at.GreatRagePotion,showWhen:e=>e.getClass()==l.ClassWarrior},Md={actionId:e=>e.getMatchingItemActionId([{id:5631,minLevel:4}]),value:at.RagePotion,showWhen:e=>e.getClass()==l.ClassWarrior},Vd={actionId:e=>e.getMatchingItemActionId([{id:13455,minLevel:46}]),value:at.GreaterStoneshieldPotion},Ud={actionId:e=>e.getMatchingItemActionId([{id:4623,minLevel:33}]),value:at.LesserStoneshieldPotion},Wd=[{config:Ad,stats:[c.StatIntellect]},{config:_d,stats:[c.StatIntellect]},{config:Nd,stats:[c.StatIntellect]},{config:Td,stats:[c.StatIntellect]},{config:Ld,stats:[c.StatIntellect]},{config:Rd,stats:[]},{config:Dd,stats:[]},{config:Md,stats:[]},{config:Vd,stats:[c.StatArmor]},{config:Ud,stats:[c.StatArmor]}],Fd=Zl({consumesFieldName:"defaultPotion"}),Od=ro({actionId:e=>e.getMatchingItemActionId([{id:215162,minLevel:35}]),fieldName:"mildlyIrradiatedRejuvPot",showWhen:e=>e.hasProfession(F.Alchemy)}),Hd={actionId:e=>e.getMatchingItemActionId([{id:13454,minLevel:46}]),value:nt.GreaterArcaneElixir},qd={actionId:e=>e.getMatchingItemActionId([{id:9155,minLevel:37}]),value:nt.ArcaneElixir},Bd={actionId:e=>e.getMatchingItemActionId([{id:217398,minLevel:28}]),value:nt.LesserArcaneElixir},zd=[{config:Hd,stats:[c.StatSpellPower]},{config:qd,stats:[c.StatSpellPower]},{config:Bd,stats:[c.StatSpellPower]}],jd=Zl({consumesFieldName:"spellPowerBuff"}),$d={actionId:e=>e.getMatchingItemActionId([{id:21546,minLevel:51}]),value:ot.ElixirOfGreaterFirepower},Gd={actionId:e=>e.getMatchingItemActionId([{id:6373,minLevel:18}]),value:ot.ElixirOfFirepower},Kd=[{config:$d,stats:[c.StatFirePower]},{config:Gd,stats:[c.StatFirePower]}],Jd=Zl({consumesFieldName:"firePowerBuff"}),Zd=[{config:{actionId:e=>e.getMatchingItemActionId([{id:17708,minLevel:40}]),value:lt.ElixirOfFrostPower},stats:[c.StatFrostPower]}],Yd=Zl({consumesFieldName:"frostPowerBuff"}),Qd=[{config:{actionId:e=>e.getMatchingItemActionId([{id:9264,minLevel:40}]),value:rt.ElixirOfShadowPower},stats:[c.StatShadowPower]}],Xd=Zl({consumesFieldName:"shadowPowerBuff"}),ec=[{config:{actionId:e=>e.getMatchingItemActionId([{id:20007,minLevel:51}]),value:dt.MagebloodPotion},stats:[c.StatMP5]}],tc=Zl({consumesFieldName:"manaRegenElixir"}),ic={actionId:e=>e.getMatchingSpellActionId([{id:8512,minLevel:32,maxLevel:41},{id:10613,minLevel:42,maxLevel:51},{id:10614,minLevel:52}]),value:ze.Windfury},sc={actionId:()=>E.fromSpellId(407975),value:ze.WildStrikes},ac=e=>({actionId:e=>e.getMatchingItemActionId([{id:20750,minLevel:40}]),value:ze.WizardOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),nc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20746,minLevel:30}]),value:ze.LesserWizardOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),oc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20744,minLevel:5}]),value:ze.MinorWizardOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),lc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20747,minLevel:40}]),value:ze.LesserManaOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),rc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20745,minLevel:20}]),value:ze.MinorManaOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),dc=e=>({actionId:e=>e.getMatchingItemActionId([{id:211848,minLevel:25}]),value:ze.BlackfathomManaOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),cc=e=>({actionId:e=>e.getMatchingItemActionId([{id:18262,minLevel:50}]),value:ze.ElementalSharpeningStone,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),hc=e=>({actionId:e=>e.getMatchingItemActionId([{id:12404,minLevel:35}]),value:ze.DenseSharpeningStone,showWhen:t=>ct(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),mc=e=>({actionId:e=>e.getMatchingItemActionId([{id:7964,minLevel:35}]),value:ze.SolidSharpeningStone,showWhen:t=>ct(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),uc=e=>({actionId:()=>E.fromItemId(211845),value:ze.BlackfathomSharpeningStone,showWhen:t=>ct(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),pc=e=>({actionId:e=>e.getMatchingItemActionId([{id:12643,minLevel:35}]),value:ze.DenseWeightstone,showWhen:t=>ht(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),gc=e=>({actionId:e=>e.getMatchingItemActionId([{id:7965,minLevel:35}]),value:ze.SolidWeightstone,showWhen:t=>ht(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),fc=e=>({actionId:e=>e.getMatchingItemActionId([{id:3824,minLevel:25}]),value:ze.ShadowOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Ic=e=>({actionId:e=>e.getMatchingItemActionId([{id:3829,minLevel:40}]),value:ze.FrostOil,showWhen:t=>je(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),wc=e=>({actionId:e=>e.getMatchingItemActionId([{id:228980,minLevel:40}]),value:ze.ConductiveShieldCoating,showWhen:t=>e===D.ItemSlotOffHand&&t.getEquippedItem(D.ItemSlotOffHand)?._item?.weaponType===Fe.WeaponTypeShield}),vc=e=>[{config:$l(e),stats:[]},{config:Gl(e),stats:[]},{config:Kl(e),stats:[]},{config:Jl(e),stats:[]}],bc=[{config:Bl,stats:[]},{config:zl,stats:[]},{config:jl,stats:[]}],xc=e=>[{config:wc(e),stats:[c.StatSpellPower]},{config:ac(e),stats:[c.StatSpellPower]},{config:nc(e),stats:[c.StatSpellPower]},{config:oc(e),stats:[c.StatSpellPower]},{config:lc(e),stats:[c.StatHealingPower,c.StatSpellPower]},{config:rc(e),stats:[c.StatHealingPower,c.StatSpellPower]},{config:dc(e),stats:[c.StatSpellPower,c.StatMP5]},{config:cc(e),stats:[c.StatAttackPower]},{config:hc(e),stats:[c.StatAttackPower]},{config:mc(e),stats:[c.StatAttackPower]},{config:uc(e),stats:[c.StatMeleeHit]},{config:pc(e),stats:[c.StatAttackPower]},{config:gc(e),stats:[c.StatAttackPower]},{config:fc(e),stats:[c.StatAttackPower]},{config:Ic(e),stats:[c.StatAttackPower]}],Sc=[...bc,...vc(D.ItemSlotOffHand),...xc(D.ItemSlotOffHand)],Ec=[...bc,...vc(D.ItemSlotMainHand),{config:ic,stats:[c.StatMeleeHit]},{config:sc,stats:[c.StatMeleeHit]},...xc(D.ItemSlotMainHand)],yc=Zl({consumesFieldName:"mainHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(D.ItemSlotMainHand)}),Pc=Zl({consumesFieldName:"offHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(D.ItemSlotOffHand)});class kc extends w{constructor(e,t,i){super(e,"enum-picker-root",t,i),this.selectElem=document.createElement("select"),this.selectElem.id=i.id,this.selectElem.classList.add("enum-picker-selector","form-select"),i.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return parseInt(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const Cc={id:"reaction-time",type:"number",label:"Reaction Time",labelTooltip:"Reaction time of the player, in milliseconds. Used with certain APL values (such as 'Aura Is Active With Reaction Time').",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,i)=>{t.setReactionTime(e,i)}},Lc={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,i)=>{t.setChannelClipDelay(e,i)}},Tc={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,i)=>{t.setInFrontOfTarget(e,i)}},Nc={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,i)=>{t.setDistanceFromTarget(e,i)}},_c={tooltip:"Improved Shadow Bolt debuff configuration",inputs:[{id:"isb-using-shadowflame",type:"boolean",label:"Has Shadowflame Rune",labelTooltip:"Whether or not the Warlock is using the Shadowflame rune (4 stacks of ISB vs. 10)",float:!0,defaultValue:!0,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbUsingShadowflame(),setValue:(e,t,i)=>{t.setIsbUsingShadowflame(e,i)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-frequency",type:"number",label:"SB Frequency",labelTooltip:"How often a Shadow Bolt is cast by the external warlock.",float:!0,defaultValue:3,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSbFrequency(),setValue:(e,t,i)=>{t.setIsbSbFrequency(e,i)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-crit",type:"number",label:"SB Crit",labelTooltip:"How often a Shadow Bolt from external warlock is a crit.",float:!0,defaultValue:25,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbCrit(),setValue:(e,t,i)=>{t.setIsbCrit(e,i)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-warlock",type:"number",label:"SB Warlocks",labelTooltip:"Number of ISB warlocks.",defaultValue:1,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbWarlocks(),setValue:(e,t,i)=>{t.setIsbWarlocks(e,i)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-priests",type:"number",label:"Shadow Priests",labelTooltip:"Number of other shadow priests.",inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSpriests(),setValue:(e,t,i)=>{t.setIsbSpriests(e,i)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt||e?.getTalents().improvedShadowBolt>0}]},Ac={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>fe.equals(t,e.makeUnitReference()))),setValue:(e,t,i)=>{const s=[];if(-1!=i){for(let e=0;e<i;e++)s.push(ie());s.push(t.makeUnitReference())}t.getRaid().setTanks(e,s)}},Rc={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,i)=>{const s=t.getHealingModel();s.hps=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},Dc={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,i)=>{const s=t.getHealingModel();s.cadenceSeconds=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},Mc={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,i)=>{const s=t.getHealingModel();s.cadenceVariation=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},Vc={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,i)=>{const s=t.getHealingModel();s.burstWindow=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},Uc={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:"\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,i)=>{const s=t.getSimpleCooldowns();s.hpPercentForDefensives=i/100,t.setSimpleCooldowns(e,s)}},Wc={id:"inspiration-uptime",type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:"\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p>If set to 0, the buff isn't applied.</p>\n\t",changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().inspirationUptime,setValue:(e,t,i)=>{const s=t.getHealingModel();s.inspirationUptime=i/100,t.setHealingModel(e,s)}};class Fc extends w{constructor(e,t,i){super(e,"number-picker-root",t,i),this.float=i.float??!1,this.positive=i.positive??!1,this.showZeroes=i.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=i.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",(()=>{this.float?this.inputElem.value=Math.abs(parseFloat(this.inputElem.value)).toFixed(2):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),{signal:this.signal}),this.inputElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?parseFloat(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){(0!=e||this.showZeroes)&&(this.float?this.inputElem.value=e.toFixed(2):this.inputElem.value=String(e))}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}class Oc extends g{constructor(e,t,i,s){super(e,"character-stats-root"),this.stats=ut.filter((e=>i.includes(e))),this.player=t,this.modifyDisplayStats=s;const n=I();this.player.levelChangeEmitter.on((()=>n.value.textContent=`Level ${t.getLevel()}`)),this.rootElem.appendChild(f("label",{className:"character-stats-label"},f("span",null,"Stats"),f("span",{ref:n,className:"ms-auto"},"Level ",t.getLevel())));const o=f("table",{className:"character-stats-table"});if(this.rootElem.appendChild(o),this.valueElems=[],this.stats.forEach((e=>{const i=m(e,t.getClass()),s=f("tr",{className:"character-stats-table-row"},f("td",{className:"character-stats-table-label"},i),f("td",{className:"character-stats-table-value"},this.bonusStatsLink(e)));o.appendChild(s);const a=s.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(a)})),this.shouldShowMeleeCritCap(t)){const e=f("tr",{className:"character-stats-table-row"},f("td",{className:"character-stats-table-label"},"Melee Crit Cap"),f("td",{className:"character-stats-table-value"}));o.appendChild(e),this.meleeCritCapValueElem=e.getElementsByClassName("character-stats-table-value")[0]}this.updateStats(t),a.onAny([t.currentStatsEmitter,t.sim.changeEmitter,t.talentsChangeEmitter]).on((()=>{this.updateStats(t)}))}updateStats(e){const i=e.getCurrentStats(),s=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{};s.talents||(s.talents=new tn),s.buffs||(s.buffs=new tn);const a=tn.fromProto(i.baseStats),n=tn.fromProto(i.gearStats),o=tn.fromProto(i.talentsStats),l=tn.fromProto(i.buffsStats),r=tn.fromProto(i.consumesStats),d=this.getDebuffStats(),m=e.getBonusStats(),u=a,p=n.subtract(a).subtract(m),g=o.subtract(n).add(s.talents),w=l.subtract(o).add(s.buffs),v=r.subtract(l),b=tn.fromProto(i.finalStats).add(s.talents).add(s.buffs).add(d);if(this.stats.forEach(((i,s)=>{const x=m.getStat(i);let S;S=0==x?"text-white":x>0?"text-success":"text-danger";const E=I(),y=f("div",{className:"stat-value-link-container"},f("a",{href:"javascript:void(0)",className:`stat-value-link ${S}`,attributes:{role:"button"},ref:E},`${this.statDisplayString(b,b,i)} `)),P=E.value;this.valueElems[s].querySelector(".stat-value-link-container")?.remove(),this.valueElems[s].prepend(y);const k=f("div",{className:"d-flex"},f("div",null,f("div",{className:"character-stats-tooltip-row"},f("span",null,"Base:"),f("span",null,this.statDisplayString(a,u,i))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Gear:"),f("span",null,this.statDisplayString(n,p,i))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Talents:"),f("span",null,this.statDisplayString(o,g,i))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Buffs:"),f("span",null,this.statDisplayString(l,w,i))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Consumes:"),f("span",null,this.statDisplayString(r,v,i))),0!=d.getStat(i)&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Debuffs:"),f("span",null,this.statDisplayString(d,d,i))),0!=x&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Bonus:"),f("span",null,this.statDisplayString(m,m,i))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Total:"),f("span",null,this.statDisplayString(b,b,i)))));i===c.StatMeleeHit?k.appendChild(f("div",{className:"ps-2"},f("div",{className:"character-stats-tooltip-row"},f("span",null,"Axes"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatAxesSkill)," /"," ",this.weaponSkillDisplayString(n,h.PseudoStatTwoHandedAxesSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Daggers"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatDaggersSkill))),e.spec===t.SpecFeralDruid&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Feral Combat"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatFeralCombatSkill)," / ")),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Maces"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatMacesSkill)," /"," ",this.weaponSkillDisplayString(n,h.PseudoStatTwoHandedMacesSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Polearms"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatPolearmsSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Staves"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatStavesSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Swords"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatSwordsSkill)," /"," ",this.weaponSkillDisplayString(n,h.PseudoStatTwoHandedSwordsSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Unarmed"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatUnarmedSkill))))):i===c.StatSpellHit&&k.appendChild(f("div",{className:"ps-2"},f("div",{className:"character-stats-tooltip-row"},f("span",null,"Arcane"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitArcane))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Fire"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitFire))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Frost"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitFrost))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Holy"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitHoly))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Nature"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitNature))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Shadow"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitShadow))))),qa(P,{content:k})})),this.meleeCritCapValueElem){const t=e.getMeleeCritCapInfo(),i=f("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.meleeCritCapDisplayString(e,b)} `),s=t.playerCritCapDelta;0==s?i.classList.add("text-white"):s>0?i.classList.add("text-danger"):s<0&&i.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(i);const a=f("div",null,f("div",{className:"character-stats-tooltip-row"},f("span",null,"Glancing:"),f("span",null,`${t.glancing.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Suppression:"),f("span",null,`${t.suppression.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"To Hit Cap:"),f("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"To Exp Cap:"),f("span",null,`${t.remainingExpertiseCap.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Debuffs:"),f("span",null,`${t.debuffCrit.toFixed(2)}%`)),0!=t.specSpecificOffset&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Spec Offsets:"),f("span",null,`${t.specSpecificOffset.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Final Crit Cap:"),f("span",null,`${t.baseCritCap.toFixed(2)}%`)),f("hr",null),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Can Raise By:"),f("span",null,`${(t.remainingExpertiseCap+t.remainingMeleeHitCap).toFixed(2)}%`)));qa(i,{content:a})}}statDisplayString(e,t,i){let s=t.getStat(i);i==c.StatBlockValue&&(s*=e.getPseudoStat(h.PseudoStatBlockValueMultiplier)||1);let a=String(Math.round(s));if(i==c.StatMeleeHit)a=`${(s/q).toFixed(2)}%`;else if(i==c.StatSpellHit)a=`${(s/pt).toFixed(2)}%`;else if(i==c.StatSpellDamage){const e=Math.round(s);a=Math.round(t.getStat(c.StatSpellPower))+e+` (+${e})`}else if(i==c.StatArcanePower||i==c.StatFirePower||i==c.StatFrostPower||i==c.StatHolyPower||i==c.StatNaturePower||i==c.StatShadowPower){const e=Math.round(s);a=Math.round(t.getStat(c.StatSpellPower)+t.getStat(c.StatSpellDamage))+e+` (+${e})`}else i==c.StatMeleeCrit||i==c.StatSpellCrit?a=`${(s/gt).toFixed(2)}%`:i==c.StatMeleeHaste?[l.ClassDruid,l.ClassShaman,l.ClassPaladin].includes(this.player.getClass())?a+=` (${(s/ft).toFixed(2)}%)`:a+=` (${(s/It).toFixed(2)}%)`:i==c.StatSpellHaste?a=`${(s/It).toFixed(2)}%`:i==c.StatArmorPenetration?a+=` (${(s/wt).toFixed(2)}%)`:i==c.StatExpertise?a+=` (${(s/B/4).toFixed(2)}%)`:i==c.StatDefense?a+=` (${(5*vt+Math.floor(s/bt)).toFixed(0)})`:i==c.StatBlock?a+=` (${(s/xt+St*Math.floor(e.getStat(c.StatDefense)/bt)+5).toFixed(2)}%)`:i==c.StatDodge?a=`${e.getStat(c.StatDodge).toFixed(2)}%`:i==c.StatParry?a=`${e.getStat(c.StatParry).toFixed(2)}%`:i==c.StatResilience&&(a+=` (${(s/Et).toFixed(2)}%)`);return a}weaponSkillDisplayString(e,t){return`${300+e.getPseudoStat(t)}`}spellSchoolHitDisplayString(e,t){return`${(e.getPseudoStat(t)+e.getStat(c.StatSpellHit)).toFixed(2)}%`}getDebuffStats(){return new tn}bonusStatsLink(e){const t=m(e,this.player.getClass()),i=I(),s=I(),a=f("a",{ref:i,href:"javascript:void(0)",className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"},attributes:{role:"button"}},f("i",{ref:s,className:"fas fa-plus-minus"}));return qa(s.value,{content:`Bonus ${t}`}),qa(i.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:i=>{const s=new Fc(null,this.player,{id:`character-bonus-stat-${e}`,label:`Bonus ${t}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:t=>t.getBonusStats().getStat(e),setValue:(t,s,a)=>{const n=s.getBonusStats().withStat(e,a);s.setBonusStats(t,n),i?.hide()}});i.setContent(s.rootElem)}}),a}shouldShowMeleeCritCap(e){return[t.SpecEnhancementShaman,t.SpecRetributionPaladin,t.SpecRogue,t.SpecWarrior,t.SpecHunter].includes(e.spec)}meleeCritCapDisplayString(e,t){const i=e.getMeleeCritCap();if(0===i)return"Exact";return`${i>0?"Over by ":"Under by "} ${Math.abs(i).toFixed(2)}%`}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Hc(e){let t=e.length;for(;--t>=0;)e[t]=0}const qc=256,Bc=286,zc=30,jc=15,$c=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Gc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Kc=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Jc=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zc=new Array(576);Hc(Zc);const Yc=new Array(60);Hc(Yc);const Qc=new Array(512);Hc(Qc);const Xc=new Array(256);Hc(Xc);const eh=new Array(29);Hc(eh);const th=new Array(zc);function ih(e,t,i,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}let sh,ah,nh;function oh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Hc(th);const lh=e=>e<256?Qc[e]:Qc[256+(e>>>7)],rh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},dh=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,rh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},ch=(e,t,i)=>{dh(e,i[2*t],i[2*t+1])},hh=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},mh=(e,t,i)=>{const s=new Array(16);let a,n,o=0;for(a=1;a<=jc;a++)o=o+i[a-1]<<1,s[a]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=hh(s[t]++,t))}},uh=e=>{let t;for(t=0;t<Bc;t++)e.dyn_ltree[2*t]=0;for(t=0;t<zc;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ph=e=>{e.bi_valid>8?rh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},gh=(e,t,i,s)=>{const a=2*t,n=2*i;return e[a]<e[n]||e[a]===e[n]&&s[t]<=s[i]},fh=(e,t,i)=>{const s=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&gh(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!gh(t,s,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=s},Ih=(e,t,i)=>{let s,a,n,o,l=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+l++],s+=(255&e.pending_buf[e.sym_buf+l++])<<8,a=e.pending_buf[e.sym_buf+l++],0===s?ch(e,a,t):(n=Xc[a],ch(e,n+qc+1,t),o=$c[n],0!==o&&(a-=eh[n],dh(e,a,o)),s--,n=lh(s),ch(e,n,i),o=Gc[n],0!==o&&(s-=th[n],dh(e,s,o)))}while(l<e.sym_next);ch(e,256,t)},wh=(e,t)=>{const i=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,l,r,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==i[2*o]?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=d<2?++d:0,i[2*r]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=s[2*r+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)fh(e,i,o);r=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],fh(e,i,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,i[2*r]=i[2*o]+i[2*l],e.depth[r]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,i[2*o+1]=i[2*l+1]=r,e.heap[1]=r++,fh(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,s=t.max_code,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let d,c,h,m,u,p,g=0;for(m=0;m<=jc;m++)e.bl_count[m]=0;for(i[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)c=e.heap[d],m=i[2*i[2*c+1]+1]+1,m>r&&(m=r,g++),i[2*c+1]=m,c>s||(e.bl_count[m]++,u=0,c>=l&&(u=o[c-l]),p=i[2*c],e.opt_len+=p*(m+u),n&&(e.static_len+=p*(a[2*c+1]+u)));if(0!==g){do{for(m=r-1;0===e.bl_count[m];)m--;e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(m=r;0!==m;m--)for(c=e.bl_count[m];0!==c;)h=e.heap[--d],h>s||(i[2*h+1]!==m&&(e.opt_len+=(m-i[2*h+1])*i[2*h],i[2*h+1]=m),c--)}})(e,t),mh(i,d,e.bl_count)},vh=(e,t,i)=>{let s,a,n=-1,o=t[1],l=0,r=7,d=4;for(0===o&&(r=138,d=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)a=o,o=t[2*(s+1)+1],++l<r&&a===o||(l<d?e.bl_tree[2*a]+=l:0!==a?(a!==n&&e.bl_tree[2*a]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=a,0===o?(r=138,d=3):a===o?(r=6,d=3):(r=7,d=4))},bh=(e,t,i)=>{let s,a,n=-1,o=t[1],l=0,r=7,d=4;for(0===o&&(r=138,d=3),s=0;s<=i;s++)if(a=o,o=t[2*(s+1)+1],!(++l<r&&a===o)){if(l<d)do{ch(e,a,e.bl_tree)}while(0!=--l);else 0!==a?(a!==n&&(ch(e,a,e.bl_tree),l--),ch(e,16,e.bl_tree),dh(e,l-3,2)):l<=10?(ch(e,17,e.bl_tree),dh(e,l-3,3)):(ch(e,18,e.bl_tree),dh(e,l-11,7));l=0,n=a,0===o?(r=138,d=3):a===o?(r=6,d=3):(r=7,d=4)}};let xh=!1;const Sh=(e,t,i,s)=>{dh(e,0+(s?1:0),3),ph(e),rh(e,i),rh(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var Eh={_tr_init:e=>{xh||((()=>{let e,t,i,s,a;const n=new Array(16);for(i=0,s=0;s<28;s++)for(eh[s]=i,e=0;e<1<<$c[s];e++)Xc[i++]=s;for(Xc[i-1]=s,a=0,s=0;s<16;s++)for(th[s]=a,e=0;e<1<<Gc[s];e++)Qc[a++]=s;for(a>>=7;s<zc;s++)for(th[s]=a<<7,e=0;e<1<<Gc[s]-7;e++)Qc[256+a++]=s;for(t=0;t<=jc;t++)n[t]=0;for(e=0;e<=143;)Zc[2*e+1]=8,e++,n[8]++;for(;e<=255;)Zc[2*e+1]=9,e++,n[9]++;for(;e<=279;)Zc[2*e+1]=7,e++,n[7]++;for(;e<=287;)Zc[2*e+1]=8,e++,n[8]++;for(mh(Zc,287,n),e=0;e<zc;e++)Yc[2*e+1]=5,Yc[2*e]=hh(e,5);sh=new ih(Zc,$c,257,Bc,jc),ah=new ih(Yc,Gc,0,zc,jc),nh=new ih(new Array(0),Kc,0,19,7)})(),xh=!0),e.l_desc=new oh(e.dyn_ltree,sh),e.d_desc=new oh(e.dyn_dtree,ah),e.bl_desc=new oh(e.bl_tree,nh),e.bi_buf=0,e.bi_valid=0,uh(e)},_tr_stored_block:Sh,_tr_flush_block:(e,t,i,s)=>{let a,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<qc;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),wh(e,e.l_desc),wh(e,e.d_desc),o=(e=>{let t;for(vh(e,e.dyn_ltree,e.l_desc.max_code),vh(e,e.dyn_dtree,e.d_desc.max_code),wh(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Jc[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=a&&(a=n)):a=n=i+5,i+4<=a&&-1!==t?Sh(e,t,i,s):4===e.strategy||n===a?(dh(e,2+(s?1:0),3),Ih(e,Zc,Yc)):(dh(e,4+(s?1:0),3),((e,t,i,s)=>{let a;for(dh(e,t-257,5),dh(e,i-1,5),dh(e,s-4,4),a=0;a<s;a++)dh(e,e.bl_tree[2*Jc[a]+1],3);bh(e,e.dyn_ltree,t-1),bh(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Ih(e,e.dyn_ltree,e.dyn_dtree)),uh(e),s&&ph(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Xc[i]+qc+1)]++,e.dyn_dtree[2*lh(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{dh(e,2,3),ch(e,256,Zc),(e=>{16===e.bi_valid?(rh(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var yh=(e,t,i,s)=>{let a=65535&e,n=e>>>16&65535,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{a=a+t[s++]|0,n=n+a|0}while(--o);a%=65521,n%=65521}return a|n<<16};const Ph=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var kh=(e,t,i,s)=>{const a=Ph,n=s+i;e^=-1;for(let o=s;o<n;o++)e=e>>>8^a[255&(e^t[o])];return~e},Ch={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Lh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Th,_tr_stored_block:Nh,_tr_flush_block:_h,_tr_tally:Ah,_tr_align:Rh}=Eh,{Z_NO_FLUSH:Dh,Z_PARTIAL_FLUSH:Mh,Z_FULL_FLUSH:Vh,Z_FINISH:Uh,Z_BLOCK:Wh,Z_OK:Fh,Z_STREAM_END:Oh,Z_STREAM_ERROR:Hh,Z_DATA_ERROR:qh,Z_BUF_ERROR:Bh,Z_DEFAULT_COMPRESSION:zh,Z_FILTERED:jh,Z_HUFFMAN_ONLY:$h,Z_RLE:Gh,Z_FIXED:Kh,Z_DEFAULT_STRATEGY:Jh,Z_UNKNOWN:Zh,Z_DEFLATED:Yh}=Lh,Qh=258,Xh=262,em=42,tm=113,im=666,sm=(e,t)=>(e.msg=Ch[t],t),am=e=>2*e-(e>4?9:0),nm=e=>{let t=e.length;for(;--t>=0;)e[t]=0},om=e=>{let t,i,s,a=e.w_size;t=e.hash_size,s=t;do{i=e.head[--s],e.head[s]=i>=a?i-a:0}while(--t);t=a,s=t;do{i=e.prev[--s],e.prev[s]=i>=a?i-a:0}while(--t)};let lm=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const rm=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},dm=(e,t)=>{_h(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,rm(e.strm)},cm=(e,t)=>{e.pending_buf[e.pending++]=t},hm=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},mm=(e,t,i,s)=>{let a=e.avail_in;return a>s&&(a=s),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),1===e.state.wrap?e.adler=yh(e.adler,t,a,i):2===e.state.wrap&&(e.adler=kh(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},um=(e,t)=>{let i,s,a=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-Xh?e.strstart-(e.w_size-Xh):0,d=e.window,c=e.w_mask,h=e.prev,m=e.strstart+Qh;let u=d[n+o-1],p=d[n+o];e.prev_length>=e.good_match&&(a>>=2),l>e.lookahead&&(l=e.lookahead);do{if(i=t,d[i+o]===p&&d[i+o-1]===u&&d[i]===d[n]&&d[++i]===d[n+1]){n+=2,i++;do{}while(d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&n<m);if(s=Qh-(m-n),n=m-Qh,s>o){if(e.match_start=t,o=s,s>=l)break;u=d[n+o-1],p=d[n+o]}}}while((t=h[t&c])>r&&0!=--a);return o<=e.lookahead?o:e.lookahead},pm=e=>{const t=e.w_size;let i,s,a;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Xh)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),om(e),s+=t),0===e.strm.avail_in)break;if(i=mm(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=i,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=lm(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=lm(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Xh&&0!==e.strm.avail_in)},gm=(e,t)=>{let i,s,a,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,l=e.strm.avail_in;do{if(i=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,s=e.strstart-e.block_start,i>s+e.strm.avail_in&&(i=s+e.strm.avail_in),i>a&&(i=a),i<n&&(0===i&&t!==Uh||t===Dh||i!==s+e.strm.avail_in))break;o=t===Uh&&i===s+e.strm.avail_in?1:0,Nh(e,0,0,o),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,rm(e.strm),s&&(s>i&&(s=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,i-=s),i&&(mm(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(0===o);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Dh&&t!==Uh&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(mm(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,n=a>e.w_size?e.w_size:a,s=e.strstart-e.block_start,(s>=n||(s||t===Uh)&&t!==Dh&&0===e.strm.avail_in&&s<=a)&&(i=s>a?a:s,o=t===Uh&&0===e.strm.avail_in&&i===s?1:0,Nh(e,e.block_start,i,o),e.block_start+=i,rm(e.strm)),o?3:1)},fm=(e,t)=>{let i,s;for(;;){if(e.lookahead<Xh){if(pm(e),e.lookahead<Xh&&t===Dh)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-Xh&&(e.match_length=um(e,i)),e.match_length>=3)if(s=Ah(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=lm(e,e.ins_h,e.window[e.strstart+1]);else s=Ah(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(dm(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Uh?(dm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(dm(e,!1),0===e.strm.avail_out)?1:2},Im=(e,t)=>{let i,s,a;for(;;){if(e.lookahead<Xh){if(pm(e),e.lookahead<Xh&&t===Dh)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Xh&&(e.match_length=um(e,i),e.match_length<=5&&(e.strategy===jh||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,s=Ah(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(dm(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=Ah(e,0,e.window[e.strstart-1]),s&&dm(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Ah(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Uh?(dm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(dm(e,!1),0===e.strm.avail_out)?1:2};function wm(e,t,i,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=a}const vm=[new wm(0,0,0,0,gm),new wm(4,4,8,4,fm),new wm(4,5,16,8,fm),new wm(4,6,32,32,fm),new wm(4,4,16,16,Im),new wm(8,16,32,32,Im),new wm(8,16,128,128,Im),new wm(8,32,128,256,Im),new wm(32,128,258,1024,Im),new wm(32,258,258,4096,Im)];function bm(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Yh,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),nm(this.dyn_ltree),nm(this.dyn_dtree),nm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),nm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),nm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const xm=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==em&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==tm&&t.status!==im?1:0},Sm=e=>{if(xm(e))return sm(e,Hh);e.total_in=e.total_out=0,e.data_type=Zh;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?em:tm,e.adler=2===t.wrap?0:1,t.last_flush=-2,Th(t),Fh},Em=e=>{const t=Sm(e);var i;return t===Fh&&((i=e.state).window_size=2*i.w_size,nm(i.head),i.max_lazy_match=vm[i.level].max_lazy,i.good_match=vm[i.level].good_length,i.nice_match=vm[i.level].nice_length,i.max_chain_length=vm[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},ym=(e,t,i,s,a,n)=>{if(!e)return Hh;let o=1;if(t===zh&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),a<1||a>9||i!==Yh||s<8||s>15||t<0||t>9||n<0||n>Kh||8===s&&1!==o)return sm(e,Hh);8===s&&(s=9);const l=new bm;return e.state=l,l.strm=e,l.status=em,l.wrap=o,l.gzhead=null,l.w_bits=s,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=n,l.method=i,Em(e)};var Pm={deflateInit:(e,t)=>ym(e,t,Yh,15,8,Jh),deflateInit2:ym,deflateReset:Em,deflateResetKeep:Sm,deflateSetHeader:(e,t)=>xm(e)||2!==e.state.wrap?Hh:(e.state.gzhead=t,Fh),deflate:(e,t)=>{if(xm(e)||t>Wh||t<0)return e?sm(e,Hh):Hh;const i=e.state;if(!e.output||0!==e.avail_in&&!e.input||i.status===im&&t!==Uh)return sm(e,0===e.avail_out?Bh:Hh);const s=i.last_flush;if(i.last_flush=t,0!==i.pending){if(rm(e),0===e.avail_out)return i.last_flush=-1,Fh}else if(0===e.avail_in&&am(t)<=am(s)&&t!==Uh)return sm(e,Bh);if(i.status===im&&0!==e.avail_in)return sm(e,Bh);if(i.status===em&&0===i.wrap&&(i.status=tm),i.status===em){let t=Yh+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=$h||i.level<2?0:i.level<6?1:6===i.level?2:3,t|=s<<6,0!==i.strstart&&(t|=32),t+=31-t%31,hm(i,t),0!==i.strstart&&(hm(i,e.adler>>>16),hm(i,65535&e.adler)),e.adler=1,i.status=tm,rm(e),0!==i.pending)return i.last_flush=-1,Fh}if(57===i.status)if(e.adler=0,cm(i,31),cm(i,139),cm(i,8),i.gzhead)cm(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),cm(i,255&i.gzhead.time),cm(i,i.gzhead.time>>8&255),cm(i,i.gzhead.time>>16&255),cm(i,i.gzhead.time>>24&255),cm(i,9===i.level?2:i.strategy>=$h||i.level<2?4:0),cm(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(cm(i,255&i.gzhead.extra.length),cm(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=kh(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(cm(i,0),cm(i,0),cm(i,0),cm(i,0),cm(i,0),cm(i,9===i.level?2:i.strategy>=$h||i.level<2?4:0),cm(i,3),i.status=tm,rm(e),0!==i.pending)return i.last_flush=-1,Fh;if(69===i.status){if(i.gzhead.extra){let t=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let a=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+a),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>t&&(e.adler=kh(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex+=a,rm(e),0!==i.pending)return i.last_flush=-1,Fh;t=0,s-=a}let a=new Uint8Array(i.gzhead.extra);i.pending_buf.set(a.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>t&&(e.adler=kh(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let t,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=kh(e.adler,i.pending_buf,i.pending-s,s)),rm(e),0!==i.pending)return i.last_flush=-1,Fh;s=0}t=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,cm(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>s&&(e.adler=kh(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let t,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=kh(e.adler,i.pending_buf,i.pending-s,s)),rm(e),0!==i.pending)return i.last_flush=-1,Fh;s=0}t=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,cm(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>s&&(e.adler=kh(e.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(rm(e),0!==i.pending))return i.last_flush=-1,Fh;cm(i,255&e.adler),cm(i,e.adler>>8&255),e.adler=0}if(i.status=tm,rm(e),0!==i.pending)return i.last_flush=-1,Fh}if(0!==e.avail_in||0!==i.lookahead||t!==Dh&&i.status!==im){let s=0===i.level?gm(i,t):i.strategy===$h?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(pm(e),0===e.lookahead)){if(t===Dh)return 1;break}if(e.match_length=0,i=Ah(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(dm(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Uh?(dm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(dm(e,!1),0===e.strm.avail_out)?1:2})(i,t):i.strategy===Gh?((e,t)=>{let i,s,a,n;const o=e.window;for(;;){if(e.lookahead<=Qh){if(pm(e),e.lookahead<=Qh&&t===Dh)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,s=o[a],s===o[++a]&&s===o[++a]&&s===o[++a])){n=e.strstart+Qh;do{}while(s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&a<n);e.match_length=Qh-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=Ah(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Ah(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(dm(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Uh?(dm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(dm(e,!1),0===e.strm.avail_out)?1:2})(i,t):vm[i.level].func(i,t);if(3!==s&&4!==s||(i.status=im),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),Fh;if(2===s&&(t===Mh?Rh(i):t!==Wh&&(Nh(i,0,0,!1),t===Vh&&(nm(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),rm(e),0===e.avail_out))return i.last_flush=-1,Fh}return t!==Uh?Fh:i.wrap<=0?Oh:(2===i.wrap?(cm(i,255&e.adler),cm(i,e.adler>>8&255),cm(i,e.adler>>16&255),cm(i,e.adler>>24&255),cm(i,255&e.total_in),cm(i,e.total_in>>8&255),cm(i,e.total_in>>16&255),cm(i,e.total_in>>24&255)):(hm(i,e.adler>>>16),hm(i,65535&e.adler)),rm(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Fh:Oh)},deflateEnd:e=>{if(xm(e))return Hh;const t=e.state.status;return e.state=null,t===tm?sm(e,qh):Fh},deflateSetDictionary:(e,t)=>{let i=t.length;if(xm(e))return Hh;const s=e.state,a=s.wrap;if(2===a||1===a&&s.status!==em||s.lookahead)return Hh;if(1===a&&(e.adler=yh(e.adler,t,i,0)),s.wrap=0,i>=s.w_size){0===a&&(nm(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(i-s.w_size,i),0),t=e,i=s.w_size}const n=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,pm(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=lm(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,pm(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=o,e.input=l,e.avail_in=n,s.wrap=a,Fh},deflateInfo:"pako deflate (from Nodeca project)"};const km=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Cm={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)km(i,t)&&(e[t]=i[t])}}return e},flattenChunks:e=>{let t=0;for(let s=0,a=e.length;s<a;s++)t+=e[s].length;const i=new Uint8Array(t);for(let s=0,a=0,n=e.length;s<n;s++){let t=e[s];i.set(t,a),a+=t.length}return i}};let Lm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(cf){Lm=!1}const Tm=new Uint8Array(256);for(let hf=0;hf<256;hf++)Tm[hf]=hf>=252?6:hf>=248?5:hf>=240?4:hf>=224?3:hf>=192?2:1;Tm[254]=Tm[254]=1;var Nm={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,s,a,n,o=e.length,l=0;for(a=0;a<o;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),a++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(l),n=0,a=0;n<l;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),a++)),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},buf2string:(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,a;const n=new Array(2*i);for(a=0,s=0;s<i;){let t=e[s++];if(t<128){n[a++]=t;continue}let o=Tm[t];if(o>4)n[a++]=65533,s+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&s<i;)t=t<<6|63&e[s++],o--;o>1?n[a++]=65533:t<65536?n[a++]=t:(t-=65536,n[a++]=55296|t>>10&1023,n[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Lm)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i})(n,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Tm[e[i]]>t?i:t}};var _m=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Am=Object.prototype.toString,{Z_NO_FLUSH:Rm,Z_SYNC_FLUSH:Dm,Z_FULL_FLUSH:Mm,Z_FINISH:Vm,Z_OK:Um,Z_STREAM_END:Wm,Z_DEFAULT_COMPRESSION:Fm,Z_DEFAULT_STRATEGY:Om,Z_DEFLATED:Hm}=Lh;function qm(e){this.options=Cm.assign({level:Fm,method:Hm,chunkSize:16384,windowBits:15,memLevel:8,strategy:Om},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _m,this.strm.avail_out=0;let i=Pm.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Um)throw new Error(Ch[i]);if(t.header&&Pm.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Nm.string2buf(t.dictionary):"[object ArrayBuffer]"===Am.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=Pm.deflateSetDictionary(this.strm,e),i!==Um)throw new Error(Ch[i]);this._dict_set=!0}}function Bm(e,t){const i=new qm(t);if(i.push(e,!0),i.err)throw i.msg||Ch[i.err];return i.result}qm.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize;let a,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Vm:Rm,"string"==typeof e?i.input=Nm.string2buf(e):"[object ArrayBuffer]"===Am.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(n===Dm||n===Mm)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=Pm.deflate(i,n),a===Wm)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=Pm.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Um;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},qm.prototype.onData=function(e){this.chunks.push(e)},qm.prototype.onEnd=function(e){e===Um&&(this.result=Cm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var zm={Deflate:qm,deflate:Bm,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Bm(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Bm(e,t)},constants:Lh};const jm=16209;var $m=function(e,t){let i,s,a,n,o,l,r,d,c,h,m,u,p,g,f,I,w,v,b,x,S,E,y,P;const k=e.state;i=e.next_in,y=e.input,s=i+(e.avail_in-5),a=e.next_out,P=e.output,n=a-(t-e.avail_out),o=a+(e.avail_out-257),l=k.dmax,r=k.wsize,d=k.whave,c=k.wnext,h=k.window,m=k.hold,u=k.bits,p=k.lencode,g=k.distcode,f=(1<<k.lenbits)-1,I=(1<<k.distbits)-1;e:do{u<15&&(m+=y[i++]<<u,u+=8,m+=y[i++]<<u,u+=8),w=p[m&f];t:for(;;){if(v=w>>>24,m>>>=v,u-=v,v=w>>>16&255,0===v)P[a++]=65535&w;else{if(!(16&v)){if(64&v){if(32&v){k.mode=16191;break e}e.msg="invalid literal/length code",k.mode=jm;break e}w=p[(65535&w)+(m&(1<<v)-1)];continue t}for(b=65535&w,v&=15,v&&(u<v&&(m+=y[i++]<<u,u+=8),b+=m&(1<<v)-1,m>>>=v,u-=v),u<15&&(m+=y[i++]<<u,u+=8,m+=y[i++]<<u,u+=8),w=g[m&I];;){if(v=w>>>24,m>>>=v,u-=v,v=w>>>16&255,16&v){if(x=65535&w,v&=15,u<v&&(m+=y[i++]<<u,u+=8,u<v&&(m+=y[i++]<<u,u+=8)),x+=m&(1<<v)-1,x>l){e.msg="invalid distance too far back",k.mode=jm;break e}if(m>>>=v,u-=v,v=a-n,x>v){if(v=x-v,v>d&&k.sane){e.msg="invalid distance too far back",k.mode=jm;break e}if(S=0,E=h,0===c){if(S+=r-v,v<b){b-=v;do{P[a++]=h[S++]}while(--v);S=a-x,E=P}}else if(c<v){if(S+=r+c-v,v-=c,v<b){b-=v;do{P[a++]=h[S++]}while(--v);if(S=0,c<b){v=c,b-=v;do{P[a++]=h[S++]}while(--v);S=a-x,E=P}}}else if(S+=c-v,v<b){b-=v;do{P[a++]=h[S++]}while(--v);S=a-x,E=P}for(;b>2;)P[a++]=E[S++],P[a++]=E[S++],P[a++]=E[S++],b-=3;b&&(P[a++]=E[S++],b>1&&(P[a++]=E[S++]))}else{S=a-x;do{P[a++]=P[S++],P[a++]=P[S++],P[a++]=P[S++],b-=3}while(b>2);b&&(P[a++]=P[S++],b>1&&(P[a++]=P[S++]))}break}if(64&v){e.msg="invalid distance code",k.mode=jm;break e}w=g[(65535&w)+(m&(1<<v)-1)]}}break}}while(i<s&&a<o);b=u>>3,i-=b,u-=b<<3,m&=(1<<u)-1,e.next_in=i,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<o?o-a+257:257-(a-o),k.hold=m,k.bits=u};const Gm=15,Km=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Jm=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Zm=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ym=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Qm=(e,t,i,s,a,n,o,l)=>{const r=l.bits;let d,c,h,m,u,p,g=0,f=0,I=0,w=0,v=0,b=0,x=0,S=0,E=0,y=0,P=null;const k=new Uint16Array(16),C=new Uint16Array(16);let L,T,N,_=null;for(g=0;g<=Gm;g++)k[g]=0;for(f=0;f<s;f++)k[t[i+f]]++;for(v=r,w=Gm;w>=1&&0===k[w];w--);if(v>w&&(v=w),0===w)return a[n++]=20971520,a[n++]=20971520,l.bits=1,0;for(I=1;I<w&&0===k[I];I++);for(v<I&&(v=I),S=1,g=1;g<=Gm;g++)if(S<<=1,S-=k[g],S<0)return-1;if(S>0&&(0===e||1!==w))return-1;for(C[1]=0,g=1;g<Gm;g++)C[g+1]=C[g]+k[g];for(f=0;f<s;f++)0!==t[i+f]&&(o[C[t[i+f]]++]=f);if(0===e?(P=_=o,p=20):1===e?(P=Km,_=Jm,p=257):(P=Zm,_=Ym,p=0),y=0,f=0,g=I,u=n,b=v,x=0,h=-1,E=1<<v,m=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){L=g-x,o[f]+1<p?(T=0,N=o[f]):o[f]>=p?(T=_[o[f]-p],N=P[o[f]-p]):(T=96,N=0),d=1<<g-x,c=1<<b,I=c;do{c-=d,a[u+(y>>x)+c]=L<<24|T<<16|N}while(0!==c);for(d=1<<g-1;y&d;)d>>=1;if(0!==d?(y&=d-1,y+=d):y=0,f++,0==--k[g]){if(g===w)break;g=t[i+o[f]]}if(g>v&&(y&m)!==h){for(0===x&&(x=v),u+=I,b=g-x,S=1<<b;b+x<w&&(S-=k[b+x],!(S<=0));)b++,S<<=1;if(E+=1<<b,1===e&&E>852||2===e&&E>592)return 1;h=y&m,a[h]=v<<24|b<<16|u-n}}return 0!==y&&(a[u+y]=g-x<<24|64<<16),l.bits=v,0};const{Z_FINISH:Xm,Z_BLOCK:eu,Z_TREES:tu,Z_OK:iu,Z_STREAM_END:su,Z_NEED_DICT:au,Z_STREAM_ERROR:nu,Z_DATA_ERROR:ou,Z_MEM_ERROR:lu,Z_BUF_ERROR:ru,Z_DEFLATED:du}=Lh,cu=16180,hu=16190,mu=16191,uu=16192,pu=16194,gu=16199,fu=16200,Iu=16206,wu=16209,vu=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function bu(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const xu=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<cu||t.mode>16211?1:0},Su=e=>{if(xu(e))return nu;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=cu,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,iu},Eu=e=>{if(xu(e))return nu;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Su(e)},yu=(e,t)=>{let i;if(xu(e))return nu;const s=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?nu:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,Eu(e))},Pu=(e,t)=>{if(!e)return nu;const i=new bu;e.state=i,i.strm=e,i.window=null,i.mode=cu;const s=yu(e,t);return s!==iu&&(e.state=null),s};let ku,Cu,Lu=!0;const Tu=e=>{if(Lu){ku=new Int32Array(512),Cu=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Qm(1,e.lens,0,288,ku,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Qm(2,e.lens,0,32,Cu,0,e.work,{bits:5}),Lu=!1}e.lencode=ku,e.lenbits=9,e.distcode=Cu,e.distbits=5},Nu=(e,t,i,s)=>{let a;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),s>=n.wsize?(n.window.set(t.subarray(i-n.wsize,i),0),n.wnext=0,n.whave=n.wsize):(a=n.wsize-n.wnext,a>s&&(a=s),n.window.set(t.subarray(i-s,i-s+a),n.wnext),(s-=a)?(n.window.set(t.subarray(i-s,i),0),n.wnext=s,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0};var _u={inflateReset:Eu,inflateReset2:yu,inflateResetKeep:Su,inflateInit:e=>Pu(e,15),inflateInit2:Pu,inflate:(e,t)=>{let i,s,a,n,o,l,r,d,c,h,m,u,p,g,f,I,w,v,b,x,S,E,y=0;const P=new Uint8Array(4);let k,C;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(xu(e)||!e.output||!e.input&&0!==e.avail_in)return nu;i=e.state,i.mode===mu&&(i.mode=uu),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,s=e.input,l=e.avail_in,d=i.hold,c=i.bits,h=l,m=r,E=iu;e:for(;;)switch(i.mode){case cu:if(0===i.wrap){i.mode=uu;break}for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(2&i.wrap&&35615===d){0===i.wbits&&(i.wbits=15),i.check=0,P[0]=255&d,P[1]=d>>>8&255,i.check=kh(i.check,P,2,0),d=0,c=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",i.mode=wu;break}if((15&d)!==du){e.msg="unknown compression method",i.mode=wu;break}if(d>>>=4,c-=4,S=8+(15&d),0===i.wbits&&(i.wbits=S),S>15||S>i.wbits){e.msg="invalid window size",i.mode=wu;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&d?16189:mu,d=0,c=0;break;case 16181:for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(i.flags=d,(255&i.flags)!==du){e.msg="unknown compression method",i.mode=wu;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=wu;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&4&i.wrap&&(P[0]=255&d,P[1]=d>>>8&255,i.check=kh(i.check,P,2,0)),d=0,c=0,i.mode=16182;case 16182:for(;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.head&&(i.head.time=d),512&i.flags&&4&i.wrap&&(P[0]=255&d,P[1]=d>>>8&255,P[2]=d>>>16&255,P[3]=d>>>24&255,i.check=kh(i.check,P,4,0)),d=0,c=0,i.mode=16183;case 16183:for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&4&i.wrap&&(P[0]=255&d,P[1]=d>>>8&255,i.check=kh(i.check,P,2,0)),d=0,c=0,i.mode=16184;case 16184:if(1024&i.flags){for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&4&i.wrap&&(P[0]=255&d,P[1]=d>>>8&255,i.check=kh(i.check,P,2,0)),d=0,c=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(u=i.length,u>l&&(u=l),u&&(i.head&&(S=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(n,n+u),S)),512&i.flags&&4&i.wrap&&(i.check=kh(i.check,s,u,n)),l-=u,n+=u,i.length-=u),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===l)break e;u=0;do{S=s[n+u++],i.head&&S&&i.length<65536&&(i.head.name+=String.fromCharCode(S))}while(S&&u<l);if(512&i.flags&&4&i.wrap&&(i.check=kh(i.check,s,u,n)),l-=u,n+=u,S)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===l)break e;u=0;do{S=s[n+u++],i.head&&S&&i.length<65536&&(i.head.comment+=String.fromCharCode(S))}while(S&&u<l);if(512&i.flags&&4&i.wrap&&(i.check=kh(i.check,s,u,n)),l-=u,n+=u,S)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(4&i.wrap&&d!==(65535&i.check)){e.msg="header crc mismatch",i.mode=wu;break}d=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=mu;break;case 16189:for(;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}e.adler=i.check=vu(d),d=0,c=0,i.mode=hu;case hu:if(0===i.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,i.hold=d,i.bits=c,au;e.adler=i.check=1,i.mode=mu;case mu:if(t===eu||t===tu)break e;case uu:if(i.last){d>>>=7&c,c-=7&c,i.mode=Iu;break}for(;c<3;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}switch(i.last=1&d,d>>>=1,c-=1,3&d){case 0:i.mode=16193;break;case 1:if(Tu(i),i.mode=gu,t===tu){d>>>=2,c-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=wu}d>>>=2,c-=2;break;case 16193:for(d>>>=7&c,c-=7&c;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",i.mode=wu;break}if(i.length=65535&d,d=0,c=0,i.mode=pu,t===tu)break e;case pu:i.mode=16195;case 16195:if(u=i.length,u){if(u>l&&(u=l),u>r&&(u=r),0===u)break e;a.set(s.subarray(n,n+u),o),l-=u,n+=u,r-=u,o+=u,i.length-=u;break}i.mode=mu;break;case 16196:for(;c<14;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(i.nlen=257+(31&d),d>>>=5,c-=5,i.ndist=1+(31&d),d>>>=5,c-=5,i.ncode=4+(15&d),d>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=wu;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;c<3;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.lens[L[i.have++]]=7&d,d>>>=3,c-=3}for(;i.have<19;)i.lens[L[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,k={bits:i.lenbits},E=Qm(0,i.lens,0,19,i.lencode,0,i.work,k),i.lenbits=k.bits,E){e.msg="invalid code lengths set",i.mode=wu;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;y=i.lencode[d&(1<<i.lenbits)-1],f=y>>>24,I=y>>>16&255,w=65535&y,!(f<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(w<16)d>>>=f,c-=f,i.lens[i.have++]=w;else{if(16===w){for(C=f+2;c<C;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(d>>>=f,c-=f,0===i.have){e.msg="invalid bit length repeat",i.mode=wu;break}S=i.lens[i.have-1],u=3+(3&d),d>>>=2,c-=2}else if(17===w){for(C=f+3;c<C;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}d>>>=f,c-=f,S=0,u=3+(7&d),d>>>=3,c-=3}else{for(C=f+7;c<C;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}d>>>=f,c-=f,S=0,u=11+(127&d),d>>>=7,c-=7}if(i.have+u>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=wu;break}for(;u--;)i.lens[i.have++]=S}}if(i.mode===wu)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=wu;break}if(i.lenbits=9,k={bits:i.lenbits},E=Qm(1,i.lens,0,i.nlen,i.lencode,0,i.work,k),i.lenbits=k.bits,E){e.msg="invalid literal/lengths set",i.mode=wu;break}if(i.distbits=6,i.distcode=i.distdyn,k={bits:i.distbits},E=Qm(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,k),i.distbits=k.bits,E){e.msg="invalid distances set",i.mode=wu;break}if(i.mode=gu,t===tu)break e;case gu:i.mode=fu;case fu:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,i.hold=d,i.bits=c,$m(e,m),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,s=e.input,l=e.avail_in,d=i.hold,c=i.bits,i.mode===mu&&(i.back=-1);break}for(i.back=0;y=i.lencode[d&(1<<i.lenbits)-1],f=y>>>24,I=y>>>16&255,w=65535&y,!(f<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(I&&!(240&I)){for(v=f,b=I,x=w;y=i.lencode[x+((d&(1<<v+b)-1)>>v)],f=y>>>24,I=y>>>16&255,w=65535&y,!(v+f<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}d>>>=v,c-=v,i.back+=v}if(d>>>=f,c-=f,i.back+=f,i.length=w,0===I){i.mode=16205;break}if(32&I){i.back=-1,i.mode=mu;break}if(64&I){e.msg="invalid literal/length code",i.mode=wu;break}i.extra=15&I,i.mode=16201;case 16201:if(i.extra){for(C=i.extra;c<C;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;y=i.distcode[d&(1<<i.distbits)-1],f=y>>>24,I=y>>>16&255,w=65535&y,!(f<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(!(240&I)){for(v=f,b=I,x=w;y=i.distcode[x+((d&(1<<v+b)-1)>>v)],f=y>>>24,I=y>>>16&255,w=65535&y,!(v+f<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}d>>>=v,c-=v,i.back+=v}if(d>>>=f,c-=f,i.back+=f,64&I){e.msg="invalid distance code",i.mode=wu;break}i.offset=w,i.extra=15&I,i.mode=16203;case 16203:if(i.extra){for(C=i.extra;c<C;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=wu;break}i.mode=16204;case 16204:if(0===r)break e;if(u=m-r,i.offset>u){if(u=i.offset-u,u>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=wu;break}u>i.wnext?(u-=i.wnext,p=i.wsize-u):p=i.wnext-u,u>i.length&&(u=i.length),g=i.window}else g=a,p=o-i.offset,u=i.length;u>r&&(u=r),r-=u,i.length-=u;do{a[o++]=g[p++]}while(--u);0===i.length&&(i.mode=fu);break;case 16205:if(0===r)break e;a[o++]=i.length,r--,i.mode=fu;break;case Iu:if(i.wrap){for(;c<32;){if(0===l)break e;l--,d|=s[n++]<<c,c+=8}if(m-=r,e.total_out+=m,i.total+=m,4&i.wrap&&m&&(e.adler=i.check=i.flags?kh(i.check,a,m,o-m):yh(i.check,a,m,o-m)),m=r,4&i.wrap&&(i.flags?d:vu(d))!==i.check){e.msg="incorrect data check",i.mode=wu;break}d=0,c=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(4&i.wrap&&d!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=wu;break}d=0,c=0}i.mode=16208;case 16208:E=su;break e;case wu:E=ou;break e;case 16210:return lu;default:return nu}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,i.hold=d,i.bits=c,(i.wsize||m!==e.avail_out&&i.mode<wu&&(i.mode<Iu||t!==Xm))&&Nu(e,e.output,e.next_out,m-e.avail_out),h-=e.avail_in,m-=e.avail_out,e.total_in+=h,e.total_out+=m,i.total+=m,4&i.wrap&&m&&(e.adler=i.check=i.flags?kh(i.check,a,m,e.next_out-m):yh(i.check,a,m,e.next_out-m)),e.data_type=i.bits+(i.last?64:0)+(i.mode===mu?128:0)+(i.mode===gu||i.mode===pu?256:0),(0===h&&0===m||t===Xm)&&E===iu&&(E=ru),E},inflateEnd:e=>{if(xu(e))return nu;let t=e.state;return t.window&&(t.window=null),e.state=null,iu},inflateGetHeader:(e,t)=>{if(xu(e))return nu;const i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,iu):nu},inflateSetDictionary:(e,t)=>{const i=t.length;let s,a,n;return xu(e)?nu:(s=e.state,0!==s.wrap&&s.mode!==hu?nu:s.mode===hu&&(a=1,a=yh(a,t,i,0),a!==s.check)?ou:(n=Nu(e,t,i,i),n?(s.mode=16210,lu):(s.havedict=1,iu)))},inflateInfo:"pako inflate (from Nodeca project)"};var Au=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ru=Object.prototype.toString,{Z_NO_FLUSH:Du,Z_FINISH:Mu,Z_OK:Vu,Z_STREAM_END:Uu,Z_NEED_DICT:Wu,Z_STREAM_ERROR:Fu,Z_DATA_ERROR:Ou,Z_MEM_ERROR:Hu}=Lh;function qu(e){this.options=Cm.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _m,this.strm.avail_out=0;let i=_u.inflateInit2(this.strm,t.windowBits);if(i!==Vu)throw new Error(Ch[i]);if(this.header=new Au,_u.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Nm.string2buf(t.dictionary):"[object ArrayBuffer]"===Ru.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=_u.inflateSetDictionary(this.strm,t.dictionary),i!==Vu)))throw new Error(Ch[i])}function Bu(e,t){const i=new qu(t);if(i.push(e),i.err)throw i.msg||Ch[i.err];return i.result}qu.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize,a=this.options.dictionary;let n,o,l;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Mu:Du,"[object ArrayBuffer]"===Ru.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),n=_u.inflate(i,o),n===Wu&&a&&(n=_u.inflateSetDictionary(i,a),n===Vu?n=_u.inflate(i,o):n===Ou&&(n=Wu));i.avail_in>0&&n===Uu&&i.state.wrap>0&&0!==e[i.next_in];)_u.inflateReset(i),n=_u.inflate(i,o);switch(n){case Fu:case Ou:case Wu:case Hu:return this.onEnd(n),this.ended=!0,!1}if(l=i.avail_out,i.next_out&&(0===i.avail_out||n===Uu))if("string"===this.options.to){let e=Nm.utf8border(i.output,i.next_out),t=i.next_out-e,a=Nm.buf2string(i.output,e);i.next_out=t,i.avail_out=s-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(a)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(n!==Vu||0!==l){if(n===Uu)return n=_u.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},qu.prototype.onData=function(e){this.chunks.push(e)},qu.prototype.onEnd=function(e){e===Vu&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Cm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var zu={Inflate:qu,inflate:Bu,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Bu(e,t)},ungzip:Bu,constants:Lh};const{Deflate:ju,deflate:$u,deflateRaw:Gu,gzip:Ku}=zm,{Inflate:Ju,inflate:Zu,inflateRaw:Yu,ungzip:Qu}=zu;var Xu={Deflate:ju,deflate:$u,deflateRaw:Gu,gzip:Ku,Inflate:Ju,inflate:Zu,inflateRaw:Yu,ungzip:Qu,constants:Lh};const ep={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class tp extends g{constructor(e,t,i={disposeOnClose:!0}){super(e,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...ep,...i};const s=I(),a=I(),n=I(),o=I(),l=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(f("div",{className:`modal-dialog ${t} ${l} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:s},f("div",{className:"modal-content"},f("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:a},this.modalConfig.title&&f("h5",{className:"modal-title"},this.modalConfig.title),f("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},f("i",{className:"fas fa-times fa-2xl"}))),f("div",{className:"modal-body",ref:n}),this.modalConfig.footer&&f("div",{className:"modal-footer",ref:o})))),this.dialog=s.value,this.header=a.value,this.body=n.value,this.footer=o.value,this.modal=new Ba(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",(()=>{this.rootElem.remove(),this.dispose()}),{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),i=this.hideBSFn.bind(this),s=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",i),this.rootElem.addEventListener("hidden.bs.modal",s),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("show.bs.modal",t))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hide.bs.modal",i))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hidden.bs.modal",s))),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach((e=>e()))}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}class ip{constructor(e){const{title:t,variant:i,autoShow:s=!0,canClose:a=!0,body:n,additionalClasses:o,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=o,this.title=t||"WoWSims",this.variant=i||"info",this.body=n,this.canClose=a,this.element=this.template(),this.container.appendChild(this.element),this.instance=za.getOrCreateInstance(this.element,{delay:3e3,...r}),s&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",(()=>{this.destroy()}))}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return f("div",{className:yt("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},f("div",{className:"toast-header"},f("i",{className:`d-block fas fa-2xl me-2 ${this.getVariantIcon()}`}),f("strong",{className:"me-auto"},this.title),this.canClose&&f("a",{href:"javascript:void(0);",className:"btn-close",attributes:{role:"button","aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},f("i",{className:`fas fa-times fa-1xl ${this.getVariantIcon()}`}))),f("div",{className:"toast-body"},this.body))}}class sp extends tp{constructor(e,t,i,s){super(e,"importer",{title:i,footer:!0,disposeOnClose:!1}),this.includeFile=s;const a="upload-input-"+i.toLowerCase().replaceAll(" ","-"),n=I(),o=I(),l=I(),r=I();this.body.replaceChildren(f(x,null,f("div",{ref:n,className:"import-description"}),f("textarea",{ref:o,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(f(x,null,this.includeFile&&f(x,null,f("label",{htmlFor:a,className:"importer-button btn btn-primary upload-button me-2"},f("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),f("input",{ref:r,type:"file",id:a,className:"importer-upload-input d-none",hidden:!0})),f("button",{ref:l,className:"importer-button btn btn-primary import-button"},f("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=n.value,this.textElem=o.value,this.includeFile&&r.value&&r.value.addEventListener("change",(async e=>{this.textElem.textContent=await e.target.files[0].text()})),this.importButton=l.value,this.importButton.addEventListener("click",(async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new ip({variant:"error",body:`Import error: ${t?.message||t}`})}}))}async finishIndividualImport(e,t,i,s,n,o){const l=e.player.getClass();if(t!=l)throw new Error(`Wrong Class! Expected ${At.get(l)} but found ${At.get(t)}!`);await ae.loadLeftoversIfNecessary(s);const r=e.sim.db.lookupEquipmentSpec(s),d=s.items.map((e=>e.enchant)),c=r.asSpec().items.map((e=>e.enchant)),h=d.filter((e=>0!=e&&!c.includes(e))),m=s.items.map((e=>e.id)),u=r.asSpec().items.map((e=>e.id)),p=m.filter((e=>!u.includes(e))),g=a.nextEventID();a.freezeAllAndDo((()=>{e.player.setRace(g,i),e.player.setGear(g,r),n&&"--"!=n&&e.player.setTalentsString(g,n),o.length>0&&e.player.setProfessions(g,o)})),this.close(),0==p.length&&0==h.length?alert("Import successful!"):alert("Import successful, but the following IDs were not found in the sim database:"+(0==p.length?"":"\n\nItems: "+p.join(", "))+(0==h.length?"":"\n\nEnchants: "+h.join(", ")))}}const ap=class e{static tryParseUrlLocation(t){let i=t.hash;if(i.length<=1)return null;i=i.substring(1);const s=atob(i),a=new Uint8Array(s.length);for(let e=0;e<a.length;e++)a[e]=s.charCodeAt(e);const n=Xu.inflate(a),o=Pt.fromBinary(n);let l=e.DEFAULT_CATEGORIES;const r=new URLSearchParams(window.location.search);if(r.has(e.CATEGORY_PARAM)){l=r.get(e.CATEGORY_PARAM).split("").map((t=>[...e.CATEGORY_KEYS.entries()].find((e=>e[1]==t)))).filter((e=>e)).map((e=>e[0]))}return{settings:o,categories:l}}};ap.DEFAULT_CATEGORIES=d(Rn).filter((e=>e!=Rn.UISettings)),ap.CATEGORY_PARAM="i",ap.CATEGORY_KEYS=(()=>{const e=new Map;return e.set(Rn.Gear,"g"),e.set(Rn.Talents,"t"),e.set(Rn.Rotation,"r"),e.set(Rn.Consumes,"c"),e.set(Rn.Miscellaneous,"m"),e.set(Rn.External,"x"),e.set(Rn.Encounter,"e"),e.set(Rn.UISettings,"u"),e})();let np=ap;class op extends sp{constructor(e,t){super(e,t,"JSON Import",!0),this.simUI=t,this.descriptionElem.innerHTML="\n\t\t\t<p>Import settings from a JSON file, which can be created using the JSON Export feature.</p>\n\t\t\t<p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n\t\t"}async onImport(e){const t=Pt.fromJsonString(e,{ignoreUnknownFields:!0});t.player?.equipment&&await ae.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(a.nextEventID(),t.player):this.simUI.fromProto(a.nextEventID(),t),this.close()}}class lp extends sp{constructor(e,t){super(e,t,"Sixty Upgrades SoD Import",!0),this.simUI=t,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from <a href="https://sixtyupgrades.com/sod/" target="_blank">Sixty Upgrades Season of Discovery</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the site\'s export option below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}onImport(e){const t=JSON.parse(e),i=kt(t?.character?.gameClass||"");if(i==l.ClassUnknown)throw new Error("Could not parse Class!");const s=Ct(t?.character?.race||"");if(s==Lt.RaceUnknown)throw new Error("Could not parse Race!");let a="";if(t?.talents?.length>0){a=function(e,t){return wn[e].map((e=>e.talents.map((e=>{const i=e.spellIds.findIndex((e=>t.includes(e)));return-1==i?"0":String(i+1)})).join("").replace(/0+$/g,""))).join("-").replace(/-+$/g,"")}(i,t.talents.map((e=>e.spellId)))}const n=Nt.create();t.items.forEach((e=>{const t=_t.create();t.id=e.id,e.enchant?.id&&(t.enchant=e.enchant.id),n.items.push(t)})),this.simUI.sim.db.lookupEquipmentSpec(n),this.finishIndividualImport(this.simUI,i,s,n,a,[])}}const rp=class e extends sp{constructor(e,t){super(e,t,"Wowhead Import",!0),this.simUI=t,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from <a href="https://www.wowhead.com/classic/gear-planner" target="_blank">Wowhead Gear Planner</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the gear planner link below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}onImport(t){const i=t.match(/www\.wowhead\.com\/classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/);if(!i)throw new Error(`Invalid WCL URL ${t}, must look like "https://www.wowhead.com/classic/gear-planner/CLASS/RACE/XXXX"`);const s=kt(i[1].replaceAll("-",""));if(s==l.ClassUnknown)throw new Error("Could not parse Class: "+i[1]);const a=Ct(i[2].replaceAll("-",""));if(a==Lt.RaceUnknown)throw new Error("Could not parse Race: "+i[2]);const n=i[3].replaceAll("_","/").replaceAll("-","+"),o=Uint8Array.from(atob(n),(e=>e.charCodeAt(0))),r=o[3],d=o.subarray(4,4+r),c=Tt(d).split("f").slice(0,3).join("-"),h=o.subarray(r),m=Nt.create();let u=0;for(;u<h.length;){const t=_t.create(),i=63&h[u],s=Boolean(128&h[u]);u++;const a=31&h[u];if(u++,t.id=(a<<16)+(h[u]<<8)+h[u+1],u+=2,s){const e=(h[u]<<16)+(h[u+1]<<8)+h[u+2];t.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(e),u+=3}null!=Object.entries(e.slotIDs).find((e=>e[1]==i))&&m.items.push(t)}this.simUI.sim.db.lookupEquipmentSpec(m),this.finishIndividualImport(this.simUI,s,a,m,c,[])}};rp.slotIDs={[D.ItemSlotHead]:1,[D.ItemSlotNeck]:2,[D.ItemSlotShoulder]:3,[D.ItemSlotBack]:15,[D.ItemSlotChest]:5,[D.ItemSlotWrist]:9,[D.ItemSlotHands]:10,[D.ItemSlotWaist]:6,[D.ItemSlotLegs]:7,[D.ItemSlotFeet]:8,[D.ItemSlotFinger1]:11,[D.ItemSlotFinger2]:12,[D.ItemSlotTrinket1]:13,[D.ItemSlotTrinket2]:14,[D.ItemSlotMainHand]:16,[D.ItemSlotOffHand]:17,[D.ItemSlotRanged]:18};class dp extends sp{constructor(e,t){super(e,t,"Addon Import",!0),this.simUI=t,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from the <a href="https://www.curseforge.com/wow/addons/wowsimsexporter" target="_blank">WoWSims Importer In-Game Addon</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, talents, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the addon below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}async onImport(e){const t=JSON.parse(e),i=kt(t.class||"");if(i==l.ClassUnknown)throw new Error("Could not parse Class!");const s=Ct(t.race||"");if(s==Lt.RaceUnknown)throw new Error("Could not parse Race!");const a=t.professions.map((e=>Rt(e.name)));a.forEach(((e,i)=>{if(e==F.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[i]}'`)}));const n=t.talents||"",o=t.gear;o.items=o.items.filter((e=>null!=e));const r=Nt.fromJson(o);this.finishIndividualImport(this.simUI,i,s,r,n,a)}}class cp extends tp{constructor(e,t,i){if(super(e,"exporter",{title:i.title,header:!0,footer:!0}),this.changedEvent=new a,this.body.innerHTML='\n\t\t\t<textarea spellCheck="false" class="exporter-textarea form-control"></textarea>\n\t\t',this.textElem=this.rootElem.getElementsByClassName("exporter-textarea")[0],new sn(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),i.allowDownload){const e=I();this.footer.appendChild(f("button",{className:"exporter-button btn btn-primary download-button",ref:e},f("i",{className:"fa fa-download me-1"}),"Download"));e.value.addEventListener("click",(e=>{const t=this.textElem.textContent;Vt(t,"wowsims.json")}))}}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const hp=class e extends cp{constructor(t,i){super(t,i,{title:"Sharable Link"}),this.simUI=i;const s={};d(Rn).forEach((e=>s[e]=np.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=s;const a=document.createElement("div");a.classList.add("link-exporter-pickers"),this.body.prepend(a),e.exportPickerConfigs.forEach((e=>{const t=e.category;new mt(a,this,{id:`link-exporter-${t}`,label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,i,s)=>{this.exportCategories[t]=s,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})}))}open(){super.open(),this.init()}getData(){return e.createLink(this.simUI,d(Rn).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=np.DEFAULT_CATEGORIES);const i=e.toProto(t),s=Pt.toBinary(i),a=Xu.deflate(s,{to:"string"}),n=btoa(String.fromCharCode(...a)),o=new URL(window.location.href);if(o.hash=n,Dt(t,np.DEFAULT_CATEGORIES))o.searchParams.delete(np.CATEGORY_PARAM);else{const e=t.map((e=>np.CATEGORY_KEYS.get(e))).join("");o.searchParams.set(np.CATEGORY_PARAM,e)}return o.toString()}};hp.exportPickerConfigs=[{category:Rn.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:Rn.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:Rn.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:Rn.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:Rn.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:Rn.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:Rn.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let mp=hp;class up extends cp{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0}),this.simUI=t}open(){super.open(),this.init()}getData(){return Ut(Pt.toJson(this.simUI.toProto()),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,i)=>t[i]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}const pp=class e extends cp{constructor(e,t){super(e,t,{title:"80Upgrades EP Export",allowDownload:!0}),this.simUI=t}open(){super.open(),this.init()}getData(){const t=this.simUI.player,i=t.getEpWeights(),s=en.getAll(),a={};return s.forEach((t=>{const s=e.getName(t),n=i.getUnitStat(t);0!=n&&""!=s&&(a[s]?a[s]+=n:a[s]=n)})),`https://eightyupgrades.com/ep/import?name=${encodeURIComponent(`${Mt[t.spec]} WoWSims Weights`)}`+Object.keys(a).map((e=>`&${e}=${a[e].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};pp.statNames={[c.StatStrength]:"strength",[c.StatAgility]:"agility",[c.StatStamina]:"stamina",[c.StatIntellect]:"intellect",[c.StatSpirit]:"spirit",[c.StatSpellPower]:"spellPower",[c.StatSpellDamage]:"spellDamage",[c.StatArcanePower]:"arcaneDamage",[c.StatHolyPower]:"holyDamage",[c.StatFirePower]:"fireDamage",[c.StatFrostPower]:"frostDamage",[c.StatNaturePower]:"natureDamage",[c.StatShadowPower]:"shadowDamage",[c.StatMP5]:"mp5",[c.StatSpellHit]:"hitRating",[c.StatSpellCrit]:"critRating",[c.StatSpellHaste]:"hasteRating",[c.StatSpellPenetration]:"spellPen",[c.StatAttackPower]:"attackPower",[c.StatMeleeHit]:"hitRating",[c.StatMeleeCrit]:"critRating",[c.StatMeleeHaste]:"hasteRating",[c.StatArmorPenetration]:"armorPenRating",[c.StatExpertise]:"expertiseRating",[c.StatMana]:"mana",[c.StatEnergy]:"energy",[c.StatRage]:"rage",[c.StatArmor]:"armor",[c.StatRangedAttackPower]:"attackPower",[c.StatDefense]:"defenseRating",[c.StatBlock]:"blockRating",[c.StatBlockValue]:"blockValue",[c.StatDodge]:"dodgeRating",[c.StatParry]:"parryRating",[c.StatResilience]:"resilienceRating",[c.StatHealth]:"health",[c.StatArcaneResistance]:"arcaneResistance",[c.StatFireResistance]:"fireResistance",[c.StatFrostResistance]:"frostResistance",[c.StatNatureResistance]:"natureResistance",[c.StatShadowResistance]:"shadowResistance",[c.StatBonusArmor]:"armorBonus",[c.StatHealingPower]:"Healing",[c.StatFeralAttackPower]:"feralAttackPower"},pp.pseudoStatNames={[h.PseudoStatMainHandDps]:"dps",[h.PseudoStatRangedDps]:"rangedDps"};let gp=pp;const fp=class e extends cp{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0}),this.simUI=t}open(){super.open(),this.init()}getData(){const t=this.simUI.player,i=t.getEpWeights(),s=en.getAll(),a={};return s.forEach((t=>{const s=e.getName(t),n=i.getUnitStat(t);0!=n&&""!=s&&(a[s]?a[s]+=n:a[s]=n)})),`( Pawn: v1: "${Mt[t.spec]} WoWSims Weights": Class=${At.get(t.getClass())},`+Object.keys(a).map((e=>`${e}=${a[e].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};fp.statNames={[c.StatStrength]:"Strength",[c.StatAgility]:"Agility",[c.StatStamina]:"Stamina",[c.StatIntellect]:"Intellect",[c.StatSpirit]:"Spirit",[c.StatSpellPower]:"SpellDamage",[c.StatSpellDamage]:"SpellDamage",[c.StatArcanePower]:"ArcaneSpellDamage",[c.StatFirePower]:"FireSpellDamage",[c.StatFrostPower]:"FrostSpellDamage",[c.StatHolyPower]:"HolySpellDamage",[c.StatNaturePower]:"NatureSpellDamage",[c.StatShadowPower]:"ShadowSpellDamage",[c.StatMP5]:"Mp5",[c.StatSpellHit]:"SpellHitRating",[c.StatSpellCrit]:"SpellCritRating",[c.StatSpellHaste]:"SpellHasteRating",[c.StatSpellPenetration]:"SpellPen",[c.StatAttackPower]:"Ap",[c.StatMeleeHit]:"HitRating",[c.StatMeleeCrit]:"CritRating",[c.StatMeleeHaste]:"HasteRating",[c.StatArmorPenetration]:"ArmorPenetration",[c.StatExpertise]:"ExpertiseRating",[c.StatMana]:"Mana",[c.StatEnergy]:"Energy",[c.StatRage]:"Rage",[c.StatArmor]:"Armor",[c.StatRangedAttackPower]:"Ap",[c.StatDefense]:"DefenseRating",[c.StatBlock]:"BlockRating",[c.StatBlockValue]:"BlockValue",[c.StatDodge]:"DodgeRating",[c.StatParry]:"ParryRating",[c.StatResilience]:"ResilienceRating",[c.StatHealth]:"Health",[c.StatArcaneResistance]:"ArcaneResistance",[c.StatFireResistance]:"FireResistance",[c.StatFrostResistance]:"FrostResistance",[c.StatNatureResistance]:"NatureResistance",[c.StatShadowResistance]:"ShadowResistance",[c.StatBonusArmor]:"Armor2",[c.StatHealingPower]:"Healing",[c.StatFeralAttackPower]:"FeralAttackPower"},fp.pseudoStatNames={[h.PseudoStatMainHandDps]:"MeleeDps",[h.PseudoStatRangedDps]:"RangedDps"};let Ip=fp;const wp={[Wt.ItemQualityJunk]:"item-quality-junk",[Wt.ItemQualityCommon]:"item-quality-common",[Wt.ItemQualityUncommon]:"item-quality-uncommon",[Wt.ItemQualityRare]:"item-quality-rare",[Wt.ItemQualityEpic]:"item-quality-epic",[Wt.ItemQualityLegendary]:"item-quality-legendary",[Wt.ItemQualityArtifact]:"item-quality-artifact",[Wt.ItemQualityHeirloom]:"item-quality-heirloom"};function vp(e,t){Object.values(wp).forEach((t=>e.classList.remove(t))),t&&e.classList.add(wp[t])}class bp extends g{constructor(e,t,i){super(e,"content-block",i.rootElem),this.config=i,this.rootElem.classList.add(t),i.extraCssClasses&&this.rootElem.classList.add(...i.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),i.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const e=this.config.header.titleTag||"h6",t=I(),i=f("div",{className:"content-block-header"},f(e,{ref:t,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&i.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&qa(t.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(i),i}return null}buildBody(){const e=f("div",{className:"content-block-body"});return this.rootElem.appendChild(e),e}}const xp="Specify Paladin Blessings for each role, in order of priority. Blessings in the 1st column will be used if there is at least 1 Paladin in the raid, 2nd column if at least 2, etc.",Sp="<p>Preset gear lists are intended as rough approximations of BIS, and will often not be the absolute highest-DPS setup for you. Your optimal gear setup will depend on many factors; that's why we have a sim!</p><p>Items may also be omitted from the presets if they are highly contested and clearly better utilized on other classes, to encourage equitable gearing for the raid as a whole.</p>";let Ep=null;async function yp(e){return(await(null==Ep&&(Ep=fetch("/sod/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(let i in e)t[parseInt(i)]=e[i];return t}))),Ep))[e.effectId]||e.name}function Pp(e){return e.effectId+"-"+e.type}let kp={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function Cp(e,t){return window.getComputedStyle(t)[e]}class Lp{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:kp.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:kp.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:kp.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:kp.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:kp.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:kp.keep_parity,tag:void 0!==t.tag?t.tag:kp.tag,callbacks:void 0!==t.callbacks?t.callbacks:kp.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let i=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=i,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let i=this.generate(),s=i.rows;this.displayedRows=i.rows;let a=this.checkChanges("data",s,t),n=this.checkChanges("top",i.top_offset,t),o=this.checkChanges("bottom",i.bottom_offset,t),l=this.options.callbacks,r=[];if(a||n){if(i.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",i.top_offset))}r.push(...s),i.bottom_offset&&r.push(this.renderExtraTag("bottom-space",i.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",i.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(i.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=i.bottom_offset+"px")}exploreEnvironment(e,t){let i=this.options;i.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),i.tag||(i.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,i=t.item_height;t.cluster_height=0;let s=this.content_elem.children;if(e.length&&s.length){let e=s[Math.floor(s.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=Cp("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(Cp("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let i=parseInt(Cp("marginTop",e),10)||0,s=parseInt(Cp("marginBottom",e),10)||0;t.item_height+=Math.max(i,s)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,i!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let i=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),s=i+e.rows_in_cluster,a=Math.max(i*e.item_height,0),n=Math.max((t-s)*e.item_height,0),o=[],l=i;return a<1&&l++,o=this.ds.generateRows(i,s),{top_offset:a,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,i=document.createElement(e.tag),s=document.createTextNode(e.no_data_text);return i.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(s)),i.appendChild(t||s),[i]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let i=Math.max(t.cluster_height-t.block_height,1),s=Math.floor(t.scroll_top/i),a=Math.floor(e*t.item_height/i);return Math.min(s,a)}renderExtraTag(e,t){let i=document.createElement(this.options.tag),s="clusterize-";return i.className=[s+"extra-row",s+e].join(" "),i.style.marginTop="0",i.style.marginBottom="0",t&&(i.style.height=t+"px"),i}checkChanges(e,t,i){var s=t!=i[e];return i[e]=t,s}}const Tp={[Z.UNSPECIFIED]:"None",[Z.ALLIANCE_ONLY]:"Alliance only",[Z.HORDE_ONLY]:"Horde only"};class Np extends tp{constructor(e,t,i){super(e,"filters-menu",{size:"md",title:"Filters"});const s=this.newSection("General"),a=f("div",{className:"ilvl-filters"});s.appendChild(a),new Fc(a,t.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,i)=>{const s=t.getFilters();s.minIlvl=i,t.setFilters(e,s)}}),a.appendChild(f("span",{className:"ilvl-filters-separator"},"-")),new Fc(a,t.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,i)=>{const s=t.getFilters();s.maxIlvl=i,t.setFilters(e,s)}}),new kc(s,t.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[Z.UNSPECIFIED,Z.ALLIANCE_ONLY,Z.HORDE_ONLY].map((e=>({name:Tp[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,i)=>{const s=t.getFilters();s.factionRestriction=i,t.setFilters(e,s)}});const n=this.newSection("Source");n.classList.add("filters-menu-section-bool-list");if(Mn.ALL_SOURCES.filter((e=>e!=Y.SourceUnknown)).forEach((e=>{new mt(n,t.sim,{id:`filters-source-${e}`,label:Ft.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,i,s)=>{const a=i.getFilters();s?a.sources.push(e):a.sources=a.sources.filter((t=>t!=e)),i.setFilters(t,a)}})})),Pn.ARMOR_SLOTS.includes(i)){const e=Ot[t.getClass()];if(e>=We.ArmorTypeLeather){const i=this.newSection("Armor Type");i.classList.add("filters-menu-section-bool-list");d(We).filter((e=>e!=We.ArmorTypeUnknown)).filter((t=>t<=e)).forEach((e=>{new mt(i,t.sim,{id:`filters-armor-type-${e}`,label:Ht.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,i,s)=>{const a=i.getFilters();s?a.armorTypes.push(e):a.armorTypes=a.armorTypes.filter((t=>t!=e)),i.setFilters(t,a)}})}))}}else if(Pn.WEAPON_SLOTS.includes(i)){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");qt[t.getClass()].map((e=>e.weaponType)).forEach((i=>{new mt(e,t.sim,{id:`filters-weapon-type-${i}`,label:Bt.get(i),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(i),setValue:(e,t,s)=>{const a=t.getFilters();s?a.weaponTypes.push(i):a.weaponTypes=a.weaponTypes.filter((e=>e!=i)),t.setFilters(e,a)}})}));const i=this.newSection("Weapon Speed");i.classList.add("filters-menu-section-number-list"),new Fc(i,t.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.minMhWeaponSpeed=i,t.setFilters(e,s)}}),new Fc(i,t.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.maxMhWeaponSpeed=i,t.setFilters(e,s)}}),zt(t)&&(new Fc(i,t.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.minOhWeaponSpeed=i,t.setFilters(e,s)}}),new Fc(i,t.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.maxOhWeaponSpeed=i,t.setFilters(e,s)}}))}else if(i==D.ItemSlotRanged){const e=jt[t.getClass()];if(e.length<=1)return;const i=this.newSection("Ranged Weapon Type");i.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new mt(i,t.sim,{id:`filter-ranged-weapon-type-${e}`,label:$t.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,i,s)=>{const a=i.getFilters();s?a.rangedWeaponTypes.push(e):a.rangedWeaponTypes=a.rangedWeaponTypes.filter((t=>t!=e)),i.setFilters(t,a)}})}));const s=this.newSection("Ranged Weapon Speed");s.classList.add("filters-menu-section-number-list"),new Fc(s,t.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.minRangedWeaponSpeed=i,t.setFilters(e,s)}}),new Fc(s,t.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.maxRangedWeaponSpeed=i,t.setFilters(e,s)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section"),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class _p{constructor(e,t,i,s,n,o,r,d,c,h,m,u,p){this.sortBy=1,this.sortDirection=Gt.DESC,this.id=e,this.label=r,this.simUI=i,this.player=o,this.itemData=c,this.computeEP=h,this.equippedToItemFn=m,this.onItemClick=p,this.slot=s,this.gearData=d,this.currentFilters=this.player.sim.getFilters();const g=r===n,w=I(),v=I(),b=I(),S=I(),E=I(),y=I(),P=I(),k=I(),C=I(),L=I();if(this.tabContent=f("div",{id:this.id,className:yt("selector-modal-tab-pane tab-pane fade",g&&"active show")},f("div",{className:"selector-modal-filters"},f("input",{ref:w,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),r===Dp.Items&&f("button",{ref:b,className:"selector-modal-filters-button btn btn-primary"},"Filters"),f("div",{ref:E,className:"selector-modal-phase-selector hide"}),f("div",{ref:y,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),f("div",{ref:P,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),f("div",{ref:S,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),f("button",{ref:C,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),f("div",{className:"selector-modal-list-labels"},f("span",{className:"item-label"},f("small",null,"Item")),r===Dp.Items&&f(x,null,f("span",{className:"source-label"},f("small",null,"Source")),f("span",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},f("small",null,"ILvl"))),f("span",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},f("small",null,"EP"),f("i",{className:"fa-solid fa-plus-minus fa-2xs"}),f("button",{ref:v,className:"btn btn-link p-0 ms-1"},f("i",{className:"far fa-question-circle fa-lg"}))),f("span",{className:"favorite-label"}),f("span",{ref:L,className:"compare-label hide"})),f("ul",{ref:k,className:"selector-modal-list"})),t.appendChild(this.tabContent),this.label===Dp.Items&&this.bindToggleCompare(L.value),qa(v.value,{content:"\n\tEP (Equivalence Points) is way of comparing items by multiplying the raw stats of an item with your current stat weights.\n\tMore EP does not necessarily mean more DPS, as EP doesn't take into account stat caps and non-linear stat calculations.\n"}),r===Dp.Items&&(s===D.ItemSlotMainHand||s===D.ItemSlotOffHand&&o.getClass()===l.ClassWarrior)&&(function(e,t){e.classList.remove("hide"),new mt(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,i)=>{console.log("test");const s=t.getFilters();s.oneHandedWeapons=i,t.setFilters(e,s)}})}(y.value,o.sim),function(e,t){e.classList.remove("hide"),new mt(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,i)=>{const s=t.getFilters();s.twoHandedWeapons=i,t.setFilters(e,s)}})}(P.value,o.sim)),this.label!==Dp.Runes&&function(e,t){new mt(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,i)=>{t.setShowEPValues(e,i)}})}(S.value,o.sim),r===Dp.Items){const e=new Np(t,o,s);b.value?.addEventListener("click",(()=>e.open()))}this.listElem=this.tabContent.getElementsByClassName("selector-modal-list")[0],this.itemsToDisplay=[],this.scroller=new Lp({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const i=[];for(let s=e;s<t&&!(s>=this.itemsToDisplay.length);++s)i.push(this.createItemElem({idx:this.itemsToDisplay[s],data:this.itemData[this.itemsToDisplay[s]]}));return i}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const T=C.value;if(T)switch(T.addEventListener("click",(e=>{u(a.nextEventID())})),r){case Dp.Enchants:T.textContent="Remove Enchant";break;case Dp.Runes:T.textContent="Remove Rune"}this.updateSelected(),this.searchInput=this.tabContent.getElementsByClassName("selector-modal-search")[0],this.searchInput.addEventListener("input",(()=>this.applyFilters()))}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){if(!e)return null;switch(this.label){case Dp.Enchants:return e.effectId;case Dp.Items:case Dp.RandomSuffixes:case Dp.Runes:return e.id;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),i=this.getItemIdByItemType(t),s=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{const t=e.dataset.idx,a=this.itemData[parseFloat(t)];a.id===i?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".selector-modal-list-item-ep-delta");if(n&&(n.textContent="",a.item)){const e=this.computeEP(a.item);s!==e&&Kt(n,s,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let i=0;i<this.itemData.length;++i)e[i]=i;const t=this.player.getEquippedItem(this.slot);this.label===Dp.Items?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):this.label===Dp.Enchants&&(e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t)),e=e.filter((e=>{const t=this.itemData[e];if(this.searchInput.value.length){const e=e=>e.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,""),i=e(this.searchInput.value).split(" "),s=e(t.name.toString());let a=!0;if(i.some((e=>{s.includes(e)||(a=!1)})),!a)return!1}return!0})),[D.ItemSlotTrinket1,D.ItemSlotTrinket2].includes(this.slot)||this.slot===D.ItemSlotRanged&&[l.ClassShaman,l.ClassPaladin,l.ClassDruid].includes(this.player.getClass())?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=Gt.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const i=this.sortDirection===Gt.DESC?t:e,s=this.sortDirection===Gt.DESC?e:t,a=this.computeEP(i)-this.computeEP(s);return Math.abs(a)<.01?i.ilvl-s.ilvl:a};if(1===this.sortBy)t=(e,t)=>{const i=this.sortDirection===Gt.DESC?t:e,s=this.sortDirection===Gt.DESC?e:t;return i.ilvl-s.ilvl};return e.sort(((e,i)=>{const s=this.itemData[e],a=this.itemData[i];return this.isItemFavorited(s)&&!this.isItemFavorited(a)?-1:this.isItemFavorited(a)&&!this.isItemFavorited(s)?1:t(s.item,a.item)}))}hideOrShowEPValues(){const e=this.tabContent.getElementsByClassName("ep-label"),t=this.tabContent.getElementsByClassName("selector-modal-list"),i=this.label!=Dp.Runes&&this.player.sim.getShowEPValues(),s=i?"":"none";for(const a of e)a.style.display=s;for(const a of t)i?a.classList.remove("hide-ep"):a.classList.add("hide-ep")}createItemElem(e){const t=e.data,i=this.computeEP(t.item),s=this.equippedToItemFn(this.gearData.getEquippedItem()),n=this.getItemIdByItemType(s),o=s?this.computeEP(s):0,l=I(),r=I(),d=I(),c=I(),h=I(),m=I(),u=I(),p=f("li",{className:yt("selector-modal-list-item",n===t.id&&"active"),dataset:{idx:e.idx.toString()}},f("div",{className:"selector-modal-list-label-cell"},f("a",{className:"selector-modal-list-item-link",ref:r,dataset:{whtticon:"false"}},f("img",{className:"selector-modal-list-item-icon",ref:d}),f("label",{className:"selector-modal-list-item-name",ref:l},t.name))),this.label===Dp.Items&&f(x,null,f("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(t.item,this.player.sim)),f("div",{className:"selector-modal-list-item-ilvl-container"},t.item.ilvl)),![D.ItemSlotTrinket1,D.ItemSlotTrinket2].includes(this.slot)&&f("div",{className:"selector-modal-list-item-ep"},f("span",{className:"selector-modal-list-item-ep-value"},i<9.95?i.toFixed(1).toString():Math.round(i).toString()),f("span",{className:"selector-modal-list-item-ep-delta",ref:e=>t.item&&o!==i&&Kt(e,o,i,0)})),f("div",{className:"selector-modal-list-item-favorite-container"},f("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:c},f("i",{ref:h,className:"far fa-star fa-xl"}))),f("div",{ref:m,className:"selector-modal-list-item-compare-container hide"},f("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:u},f("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),g=e=>{const i=this.player.sim.getFilters();let s,n;switch(this.label){case Dp.Items:s="favoriteItems",n=t.id;break;case Dp.Enchants:s="favoriteEnchants",n=Pp(t.item);break;case Dp.Runes:s="favoriteRunes",n=t.id;break;case Dp.RandomSuffixes:s="favoriteRandomSuffixes",n=t.id;break;default:return}if(e)i[s].push(n);else{const e=i[s].indexOf(n);-1!==e&&i[s].splice(e,1)}c.value.classList.toggle("text-brand"),h.value.classList.toggle("fas"),h.value.classList.toggle("far"),p.dataset.fav=e.toString(),this.player.sim.setFilters(a.nextEventID(),i)};c.value.addEventListener("click",(()=>g("false"===p.dataset.fav)));this.isItemFavorited(t)?(c.value.classList.add("text-brand"),h.value?.classList.add("fas"),p.dataset.fav="true"):(h.value?.classList.add("far"),p.dataset.fav="false");const w=qa(c.value);var v;if(v="true"===p.dataset.fav,w.setContent(v?"Remove from favorites":"Add to favorites"),this.label===Dp.Items){const e=qa(u.value);this.bindToggleCompare(m.value);const i=this.simUI instanceof sf?this.simUI:null;if(i){const s=()=>i.bt.hasItem(_t.create({id:t.id})),a=()=>{const t=s();e.setContent(t?"Remove from Batch sim":"Add to Batch sim"),u.value.classList[t?"add":"remove"]("text-brand")};a(),i.bt.itemsChangedEmitter.on((()=>{a()})),u.value.addEventListener("click",(()=>{const e=s();i.bt[e?"removeItem":"addItem"](_t.create({id:t.id})),new ip({delay:1e3,variant:"success",body:f(x,null,f("strong",null,t.name)," was ",f(x,null,e?"removed from the batch":"added to the batch"),".")})}))}}return r.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===c.value)return!1;this.onItemClick(t)})),t.actionId.fill().then((e=>{e.setWowheadHref(r.value),d.value.src=e.iconUrl})),vp(l.value,t.quality),p}isItemFavorited(e){return this.label===Dp.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===Dp.Enchants?this.currentFilters.favoriteEnchants.includes(Pp(e.item)):this.label===Dp.Runes?this.currentFilters.favoriteRunes.includes(e.id):this.label===Dp.RandomSuffixes&&this.currentFilters.favoriteRandomSuffixes.includes(e.id)}getSourceInfo(e,t){const i=(e,t)=>f("a",{href:e,target:"_blank",dataset:{whtticon:"false"}},f("small",null,t));if(!e.sources||0==e.sources.length)return e.randomSuffixOptions.length?i(`${E.makeItemUrl(e.id)}#dropped-by`,f("div",{className:"d-flex align-items-center"},this.getDropSourceIcon(),f("span",null,"World Drop"))):f(x,null);let s=e.sources[0];if("crafted"==s.source.oneofKind){const t=s.source.crafted;return i(t.spellId?E.makeSpellUrl(t.spellId):E.makeItemUrl(e.id),f("div",{className:"d-flex"},this.getProfessionSourceIcon(),Jt.get(t.profession)??"Unknown"))}if("drop"==s.source.oneofKind){const a=s.source.drop,n=t.db.getZone(a.zoneId),o=t.db.getNpc(a.npcId);return o?i(E.makeNpcUrl(o.id),f("div",{className:"d-flex"},this.getDropSourceIcon(),f("span",null,n&&n.name,n&&f("br",null),o.name,a.category&&` - ${a.category}`))):n?i(E.makeItemUrl(e.id),f("div",{className:"d-flex"},this.getDropSourceIcon(),f("span",null,n.name,f("br",null),a.otherName?a.otherName:"Multiple Sources"))):i(`${E.makeItemUrl(e.id)}#dropped-by`,f("div",{className:"d-flex"},this.getDropSourceIcon(),f("span",null,"Multiple Sources")))}if("quest"==s.source.oneofKind&&s.source.quest.name){const t=s.source.quest;return i(E.makeQuestUrl(t.id),f("div",{className:"d-flex"},f("span",{className:"d-flex me-1"},this.getQuestSourceIcon(),e.factionRestriction==Z.ALLIANCE_ONLY&&this.getAllianceSourceIcon(),e.factionRestriction==Z.HORDE_ONLY&&this.getHordeSourceIcon()),f("span",null,t.name)))}if("rep"==(s=e.sources.find((e=>"rep"==e.source.oneofKind))??s).source.oneofKind){const a=e.sources.filter((e=>"rep"==e.source.oneofKind)).map((e=>t.db.getFaction(e.source.rep.repFactionId))).filter((e=>!!e)),n=s.source.rep;return i(E.makeItemUrl(e.id),f("div",{className:"d-flex"},f("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",width:"16",height:"16"}),f("div",{className:"d-flex flex-column"},a.map((t=>f("div",{className:"d-flex"},(e.factionRestriction==Z.ALLIANCE_ONLY||Zt(t.id))&&f("span",{className:"d-flex me-1"},this.getAllianceSourceIcon()),(e.factionRestriction==Z.HORDE_ONLY||Yt(t.id))&&f("span",{className:"d-flex me-1"},this.getHordeSourceIcon()),t.name," - ",Qt[n.repLevel]))))))}if("soldBy"==s.source.oneofKind){const e=s.source.soldBy;return i(E.makeNpcUrl(e.npcId),f("div",{className:"d-flex"},this.getVendorSourceIcon(),f("span",null,e.npcName)))}return f(x,null)}bindToggleCompare(e){const t=()=>e.classList[this.player.sim.getShowExperimental()?"remove":"add"]("hide");t(),this.player.sim.showExperimentalChangeEmitter.on((()=>{t()}))}getDropSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/icons/boss.gif",className:"item-source-icon-drop me-1"})}getVendorSourceIcon(){return f("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",className:"item-source-icon-vendor me-1"})}getProfessionSourceIcon(){return f("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/6/63/Pointer_repair_off_32x32.png",className:"item-source-icon-profession me-1"})}getQuestSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/wow/icons/tiny/quest-start.gif",className:"item-source-icon-quest"})}getAllianceSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/icons/alliance.png",className:"item-source-icon-alliance"})}getHordeSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/icons/horde.png",className:"item-source-icon-horde"})}}const Ap={[D.ItemSlotHead]:"/sod/assets/item_slots/head.jpg",[D.ItemSlotNeck]:"/sod/assets/item_slots/neck.jpg",[D.ItemSlotShoulder]:"/sod/assets/item_slots/shoulders.jpg",[D.ItemSlotBack]:"/sod/assets/item_slots/shirt.jpg",[D.ItemSlotChest]:"/sod/assets/item_slots/chest.jpg",[D.ItemSlotWrist]:"/sod/assets/item_slots/wrists.jpg",[D.ItemSlotHands]:"/sod/assets/item_slots/hands.jpg",[D.ItemSlotWaist]:"/sod/assets/item_slots/waist.jpg",[D.ItemSlotLegs]:"/sod/assets/item_slots/legs.jpg",[D.ItemSlotFeet]:"/sod/assets/item_slots/feet.jpg",[D.ItemSlotFinger1]:"/sod/assets/item_slots/finger.jpg",[D.ItemSlotFinger2]:"/sod/assets/item_slots/finger.jpg",[D.ItemSlotTrinket1]:"/sod/assets/item_slots/trinket.jpg",[D.ItemSlotTrinket2]:"/sod/assets/item_slots/trinket.jpg",[D.ItemSlotMainHand]:"/sod/assets/item_slots/mainhand.jpg",[D.ItemSlotOffHand]:"/sod/assets/item_slots/offhand.jpg",[D.ItemSlotRanged]:"/sod/assets/item_slots/ranged.jpg"};function Rp(e){return Ap[e]}var Dp=(e=>(e.Enchants="Enchant",e.Items="Item",e.RandomSuffixes="Random Suffix",e.Runes="Rune",e))(Dp||{});class Mp extends tp{constructor(e,t,i,s,a){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=D.ItemSlotHead,this.currentTab="Item",this.disabledTabs=[],this.simUI=t,this.player=i,this.gearPicker=s,this.options={id:He(),...a},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",f("div",null,f("h6",{className:"selector-modal-title"}),f("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(f("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(f("div",{className:"d-flex align-items-center form-text mt-auto pt-3"},f("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),f("span",null,"If gear is missing, check the selected phase and your gear filters.",f("br",null),"If the problem persists, save any un-saved data, click the",f("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,i){this.titleElem.textContent=Xt.get(e)??"",this.setData(e,t,i),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>document.removeEventListener("keydown",t)))}}setData(e,t,i){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const s=i.getEquippedItem(),a=this.player.getItems(e),n=this.player.getEnchants(e),o=this.player.getRunes(e);("Enchant"===t&&!n.length||"Rune"===t&&!o.length)&&(t="Item"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Item")&&this.addTab({id:ei(`${this.options.id}-Item`),label:"Item",gearData:i,itemData:a.map((t=>({item:t,id:t.id,actionId:E.fromItem(t),name:t.name,quality:t.quality,phase:t.phase,baseEP:this.player.computeItemEP(t,e),ignoreEPFilter:!1,onEquip:(e,t)=>{const s=i.getEquippedItem();s?i.equipItem(e,s.withItem(t)):i.equipItem(e,new ti({item:t}))}}))),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{i.equipItem(e,null),this.removeTabs("Random Suffix")}});!this.disabledTabs?.includes("Enchant")&&this.addTab({id:ei(`${this.options.id}-Enchant`),label:"Enchant",gearData:i,itemData:n.map((e=>({item:e,id:e.effectId,actionId:e.itemId?E.fromItemId(e.itemId):E.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,baseEP:this.player.computeStatsEP(new tn(e.stats)),ignoreEPFilter:!0,onEquip:(e,t)=>{const s=i.getEquippedItem();s&&i.equipItem(e,s.withEnchant(t))}}))),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=i.getEquippedItem();t&&i.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Rune")&&this.addTab({id:ei(`${this.options.id}-Rune`),label:"Rune",gearData:i,itemData:o.map((e=>({item:e,id:e.id,actionId:E.fromSpellId(e.id),name:e.name,quality:Wt.ItemQualityCommon,phase:1,baseEP:1,ignoreEPFilter:!0,onEquip:(e,t)=>{const s=i.getEquippedItem();s&&i.equipItem(e,s.withRune(t))}}))),computeEP:()=>1,equippedToItemFn:e=>e?.rune,onRemove:e=>{const t=i.getEquippedItem();t&&i.equipItem(e,t.withRune(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(s,i),this.ilists.find((e=>t===e.label))?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(f("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map((e=>{const t=I(),i=f("div",{className:"item-picker-icon-wrapper",dataset:{slot:e.slot}},f("a",{ref:t,className:"item-picker-icon",href:"javascript:void(0)",onclick:t=>{t.preventDefault(),e.slot!=this.currentSlot&&e.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),s=()=>{e.item?(this.player.setWowheadData(e.item,t.value),e.item.asActionId().fill().then((e=>{e.setBackgroundAndHref(t.value)}))):t.value.style.backgroundImage=`url('${Rp(e.slot)}')`};return s(),e.onUpdate((()=>s())),qa(t.value,{content:`Edit ${Xt.get(e.slot)}`,placement:"left"}),this.itemSlotTabElems.push(i),i}))))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach((t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")}))}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=ii(this.currentSlot-1,Object.keys(D).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=ii(this.currentSlot+1,Object.keys(D).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const i=e.item;this.addTab({id:ei(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(i).map((e=>({item:e,id:e.id,actionId:E.fromRandomSuffix(i,e),name:e.name,quality:i.quality,phase:i.phase,baseEP:this.player.computeRandomSuffixEP(e),ignoreEPFilter:!0,onEquip:(e,i)=>{const s=t.getEquippedItem();s&&t.equipItem(e,s.withItem(s.item).withRandomSuffix(i))}}))),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withItem(i.item).withRandomSuffix(null))}})}addTab({id:e,label:t,gearData:i,itemData:s,computeEP:n,equippedToItemFn:o,onRemove:l,setTabContent:r}){if(!s.length)return;const d=t===this.currentTab,c=I();this.tabsElem.appendChild(f("li",{className:"nav-item"},f("button",{ref:c,className:yt("nav-link selector-modal-item-tab",d&&"active"),dataset:{label:t,bsToggle:"tab",bsTarget:`#${e}`},attributes:{role:"tab","aria-selected":d}}))),r?r(c.value):c.value.textContent=t;const h=new _p(e,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,t,i,s,n,o,l,(e=>{const t=e;e.onEquip(a.nextEventID(),t.item);const s=si.is(t.item),n=!!t.actionId.randomSuffixId;(s||n)&&(n||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(i.getEquippedItem(),i)))})),m=()=>{h.updateSelected()},u=()=>{h.applyFilters()},p=()=>{h.hideOrShowEPValues()};i.changeEvent.on(m),this.player.sim.phaseChangeEmitter.on(u),this.player.sim.filtersChangeEmitter.on(u),this.player.sim.showEPValuesChangeEmitter.on(p),this.addOnDisposeCallback((()=>{i.changeEvent.off(m),this.player.sim.phaseChangeEmitter.off(u),this.player.sim.filtersChangeEmitter.off(u),this.player.sim.showEPValuesChangeEmitter.off(p),h.dispose()})),c.value.addEventListener("click",(e=>{this.currentTab=t})),c.value.addEventListener("shown.bs.tab",(e=>{h.sizeRefresh()})),this.ilists.push(h)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter((t=>t.dataset?.label?.includes(e))),i=t.map((e=>document.querySelector(e.dataset.bsTarget))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement?.remove())),i.forEach((e=>e.remove()))}}class Vp extends sp{constructor(e,t,i){super(e,t,"Bag Item Import",!0),this.simUI=t,this.bulkUI=i,this.descriptionElem.appendChild(f(x,null,f("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),f("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=Nt.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await ae.loadLeftoversIfNecessary(t),i=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));i.length>0&&this.bulkUI.addItems(i)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}const Up=f("ul",{className:"text-start ps-3 mb-0"});class Wp extends g{constructor(e){super(e,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const t=I(),i=I(),s=I();this.rootElem.appendChild(f(x,null,f("div",{ref:t,className:"results-pending"},f("div",{className:"loader"})),f("div",{ref:i,className:"results-content"}),f("div",{ref:s,className:"warning-zone",style:"text-align: center"}))),this.pendingElem=t.value,this.contentElem=i.value,this.warningElem=s.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink(e){const t=f("div",{className:"sim-toolbar-item"},f("a",{href:e.href?e.href:"javascript:void(0)",target:e.href?"_blank":"_self",className:e.classes},e.icon&&f("i",{className:e.icon}),e.text?e.text:""));return e.parent.appendChild(t),e.tooltip&&(this.warningsTooltip=qa(t,{appendTo:"parent",content:e.tooltip,placement:"bottom",inlinePositioning:!0,plugins:[ja]})),t}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:Up,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const e=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!==e)),t=this.warningsTooltip?.props.content?.cloneNode(!0)||f(x,null);t&&(t.innerHTML=""),t.appendChild(f(x,null,e?.map((e=>f("li",null,e))))),this.warningsLink.parentElement?.classList?.[e.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(t)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:(this.contentElem.innerHTML="",this.contentElem.appendChild(e)),this.contentElem.style.display="block",this.pendingElem.style.display="none"}}class Fp extends g{constructor(e,t,i){super(e,"sim-tab"),this.rootElem.classList.add(i.identifier),this.simUI=t,this.config=i,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<a\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\ttype="button"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){let i=document.createElement("div");return i.classList.add("tab-panel-col",`${t}-${e}`),i}}const Op="https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg";class Hp extends g{constructor(e,t,i){super(e,"gear-picker-root");const s=document.createElement("div");s.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(s);const a=document.createElement("div");a.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(a);const n=[D.ItemSlotHead,D.ItemSlotNeck,D.ItemSlotShoulder,D.ItemSlotBack,D.ItemSlotChest,D.ItemSlotWrist,D.ItemSlotMainHand,D.ItemSlotOffHand,D.ItemSlotRanged].map((e=>new Bp(s,this,t,i,e))),o=[D.ItemSlotHands,D.ItemSlotWaist,D.ItemSlotLegs,D.ItemSlotFeet,D.ItemSlotFinger1,D.ItemSlotFinger2,D.ItemSlotTrinket1,D.ItemSlotTrinket2].map((e=>new Bp(a,this,t,i,e)));this.itemPickers=n.concat(o).sort(((e,t)=>e.slot-t.slot)),this.selectorModal=new Mp(t.rootElem,t,i,this)}}class qp extends g{constructor(e,t,i){super(e,"item-picker-root",t),this.player=i;const s=I(),a=I(),n=I(),o=I(),l=I(),r=I();this.rootElem.appendChild(f(x,null,f("div",{className:"item-picker-icon-wrapper"},f("span",{className:"item-picker-ilvl",ref:o}),f("a",{ref:s,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),f("div",{className:"item-picker-rune-container"},f("img",{ref:a,className:"item-picker-rune-icon hide"}))),f("div",{className:"item-picker-labels-container"},f("a",{ref:n,className:"item-picker-name",href:"javascript:void(0)",attributes:{role:"button"}}),f("a",{ref:l,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}}),f("a",{ref:r,className:"item-picker-rune hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=s.value,this.runeIconElem=a.value,this.nameElem=n.value,this.ilvlElem=o.value,this.enchantElem=l.value,this.runeElem=r.value}clear(){this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.runeElem.removeAttribute("data-wowhead"),this.runeElem.removeAttribute("href"),this.runeElem.classList.add("hide"),this.iconElem.style.backgroundImage="",this.runeIconElem.src=Op,this.nameElem.innerText="",this.ilvlElem.innerText="",this.enchantElem.innerText="",this.runeElem.innerText=""}update(e){this.nameElem.textContent=e.item.name,this.ilvlElem.textContent=e.item.ilvl.toString(),e.randomSuffix&&(this.nameElem.textContent+=" "+e.randomSuffix.name),vp(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill().then((e=>{e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem)})),e.enchant?(yp(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=E.makeSpellUrl(e.enchant.spellId),E.makeSpellTooltipData(e.enchant.spellId).then((e=>{this.enchantElem.dataset.wowhead=e}))):(this.enchantElem.href=E.makeItemUrl(e.enchant.itemId),E.makeItemTooltipData(e.enchant.itemId).then((e=>{this.enchantElem.dataset.wowhead=e}))),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide");const t=ai[e._item.type]?.some((e=>this.player.sim.db.hasRuneBySlot(e,this.player.getClass())));t&&(this.runeIconElem.classList.remove("hide"),e.rune?(E.fromSpellId(e.rune.id).fill().then((e=>this.runeIconElem.src=e.iconUrl)),this.runeElem.classList.remove("hide"),this.runeElem.textContent=e.rune.name,this.runeElem.href=E.makeSpellUrl(e.rune.id),this.runeElem.dataset.wowhead=`domain=classic&spell=${e.rune.id}`,this.runeElem.dataset.whtticon="false"):this.runeIconElem.src=Op)}}class Bp extends g{constructor(e,t,i,s,a){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.gearPicker=t,this.simUI=i,this.player=s,this.slot=a,this.itemElem=new qp(e,this.rootElem,s),this.item=s.getEquippedItem(a),s.sim.waitForInit().then((()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(Dp.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.enchantElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(Dp.Enchants)})),this.itemElem.runeElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(Dp.Runes)}))})),s.gearChangeEmitter.on((()=>{this.item=this.player.getEquippedItem(this.slot)})),s.professionChangeEmitter.on((()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(),this.itemElem.nameElem.textContent=Xt.get(this.slot)??"",vp(this.itemElem.nameElem,null),e?this.itemElem.update(e):this.itemElem.iconElem.style.backgroundImage=`url('${Rp(this.slot)}')`,this._equippedItem=e,this.onUpdateCallbacks.forEach((e=>e()))}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}}class zp extends g{constructor(e,t,i,s,a){super(e,"bulk-item-picker"),this.simUI=t,this.bulkUI=i,this.index=a,this.item=s,this.itemElem=new qp(e,this.rootElem,t.player);const n=I();this.itemElem.rootElem.appendChild(f("button",{className:"remove-batch-item-btn",ref:n},f("i",{className:"fas fa-times"})));const o=()=>this.bulkUI.removeItemByIndex(this.index);n.value.addEventListener("click",o),this.addOnDisposeCallback((()=>n.value.removeEventListener("click",o))),this.simUI.sim.waitForInit().then((()=>{this.setItem(s);const e=ni(this.item.item)[0],t=this.simUI.sim.db.getEnchants(e),i=this.item.item.randomSuffixOptions,a=s=>{s.preventDefault(),t.length?this.bulkUI.selectorModal.openTab(e,Dp.Enchants,this.createGearData()):i.length&&this.bulkUI.selectorModal.openTab(e,Dp.RandomSuffixes,this.createGearData())};this.itemElem.iconElem.addEventListener("click",a),this.itemElem.nameElem.addEventListener("click",a),this.itemElem.enchantElem.addEventListener("click",a)}))}setItem(e){this.itemElem.clear(),e?(this.itemElem.update(e),this.item=e):(this.itemElem.rootElem.style.opacity="30%",this.itemElem.iconElem.style.backgroundImage="url('/cata/assets/item_slots/empty.jpg')",this.itemElem.nameElem.textContent="Add new item (not implemented)",this.itemElem.rootElem.style.alignItems="center")}createGearData(){const e=new a;return{equipItem:(t,i)=>{if(i){const t=this.bulkUI.getItems();t[this.index]=i.asSpec(),this.item=i,this.bulkUI.setItems(t),e.emit(a.nextEventID())}},getEquippedItem:()=>this.item,changeEvent:e}}}class jp extends g{constructor(e,t,i,s){super(e,".bulk-sim-results");const n=i.unitMetrics.dps.avg-s.unitMetrics.dps.avg,o=I(),l=I(),r=I();if(e.appendChild(f(x,null,f("div",{className:"results-sim"},f("div",{className:"bulk-result-body-dps bulk-items-text-line results-sim-dps damage-metrics"},f("span",{className:"topline-result-avg"},this.formatDps(i.unitMetrics.dps.avg)),f("span",{ref:l,className:yt(n>=0?"bulk-result-header-positive":"bulk-result-header-negative")},this.formatDpsDelta(n)),f("p",{className:"talent-loadout-text"},i.talentLoadout&&"object"==typeof i.talentLoadout?"string"==typeof i.talentLoadout.name&&f(x,null,"Talent loadout used: ",i.talentLoadout.name):f(x,null,"Current talents")))),f("div",{ref:r,className:"bulk-gear-combo"}),!!i.itemsAdded?.length&&f("button",{ref:o,className:"btn btn-primary bulk-equipit"},"Equip"))),i.itemsAdded?.length){o.value?.addEventListener("click",(()=>{i.itemsAdded.forEach((e=>{const i=t.sim.db.lookupItemSpec(e.item);t.player.equipItem(a.nextEventID(),e.slot,i),t.simHeader.activateTab("gear-tab")}))}));const e=f(x,null);for(const s of i.itemsAdded){const i=f("div",{className:"bulk-result-item"}),a=t.sim.db.lookupItemSpec(s.item),n=new qp(e,i,t.player);n.update(a),n.nameElem.appendChild(f("a",{className:"bulk-result-item-slot"},this.itemSlotName(s))),e.appendChild(i)}r.value?.appendChild(e)}else i.talentLoadout&&"object"==typeof i.talentLoadout||(l.value?.classList.add("hide"),e.appendChild(f("p",null,"No changes - this is your currently equipped gear!")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}formatDpsDelta(e){return(e>=0?"+":"")+this.formatDps(e)}itemSlotName(e){return JSON.parse(oi.toJsonString(e,{emitDefaultValues:!0})).slot.replace("ItemSlot","")}}class $p extends Fp{constructor(e,t){super(e,t,{identifier:"bulk-tab",title:"Batch"}),this.itemsChangedEmitter=new a,this.column1=this.buildColumn(1,"raid-settings-col"),this.items=new Array,this.simUI=t,this.leftPanel=f("div",{className:"bulk-tab-left tab-panel-left"},this.column1),this.rightPanel=f("div",{className:"bulk-tab-right tab-panel-right"}),this.pendingDiv=f("div",{className:"results-pending-overlay d-flex hide"}),this.pendingResults=new Wp(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new Mp(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal",disabledTabs:[Dp.Items]}),this.contentContainer.appendChild(f(x,null,this.leftPanel,this.rightPanel,this.pendingDiv)),this.doCombos=!0,this.fastMode=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings()}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=li.fromJsonString(e,{ignoreUnknownFields:!0});this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.simTalents=t.simTalents}}storeSettings(){const e=this.createBulkSettings(),t=li.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return li.create({items:this.items,combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,simTalents:this.simTalents,talentsToSim:this.savedTalents,iterationsPerCombo:this.simUI.sim.getIterations()})}createBulkItemsDatabase(){const e=ri.create();for(const t of this.items){const i=this.simUI.sim.db.lookupItemSpec(t);if(!i)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(di.fromJson(si.toJson(i.item),{ignoreUnknownFields:!0})),i.enchant&&e.enchants.push(ci.fromJson(hi.toJson(i.enchant),{ignoreUnknownFields:!0}))}return e}addItem(e){this.addItems([e])}addItems(e){this.items=[...this.items||[],...e],this.itemsChangedEmitter.emit(a.nextEventID())}setItems(e){this.items=e,this.itemsChangedEmitter.emit(a.nextEventID())}removeItem(e){const t=this.items.findIndex((t=>_t.equals(t,e)));-1!==t&&(this.items.splice(t,1),this.itemsChangedEmitter.emit(a.nextEventID()))}removeItemByIndex(e){this.items.length<e?new ip({variant:"error",body:"Failed to remove item, please report this issue."}):(this.items.splice(e,1),this.itemsChangedEmitter.emit(a.nextEventID()))}clearItems(){this.items=new Array,this.itemsChangedEmitter.emit(a.nextEventID())}hasItem(e){return this.items.some((t=>_t.equals(t,e)))}getItems(){const e=new Array;return this.items.forEach((t=>{e.push(_t.clone(t))})),e}setCombinations(e){this.doCombos=e,this.itemsChangedEmitter.emit(a.nextEventID())}setFastMode(e){this.fastMode=e,this.itemsChangedEmitter.emit(a.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e)}catch(t){this.simUI.handleCrash(t)}}buildTabContent(){const e=new bp(this.column1,"bulk-items",{header:{title:"Items"}});e.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk");const t=f("div",{className:"bulk-items-text-line"},f("i",null,"Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.")),i=f("div",{className:"tab-panel-col bulk-gear-combo"});this.itemsChangedEmitter.on((()=>{const e=f(x,null);if(this.items.length){t.textContent="The following items will be simmed together with your equipped gear.";for(let t=0;t<this.items.length;++t){const i=this.items[t],s=this.simUI.sim.db.lookupItemSpec(i);new zp(e,this.simUI,this,s,t)}}i.replaceChildren(e)})),e.bodyElement.appendChild(f(x,null,t,i)),this.clearItems();const s=new bp(this.column1,"bulk-results",{header:{title:"Results",extraCssClasses:["bulk-results-header"]}});s.rootElem.hidden=!0,s.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk","tab-panel-col"),this.simUI.sim.bulkSimStartEmitter.on((()=>{s.rootElem.hidden=!0})),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{s.rootElem.hidden=0==t.results.length,s.bodyElement.replaceChildren();for(const i of t.results){const e=new bp(s.bodyElement,"bulk-result",{header:{title:""},bodyClasses:["bulk-results-body"]});new jp(e.bodyElement,this.simUI,i,t.equippedGearResult)}}));const a=new bp(this.rightPanel,"bulk-settings",{header:{title:"Setup"}}),n=f("button",{className:"btn btn-primary w-100 bulk-settings-button"},"Simulate Batch");n.addEventListener("click",(()=>{this.pendingDiv.classList.remove("hide"),this.leftPanel.classList.add("blurred"),this.rightPanel.classList.add("blurred");const e=mi(n);n.disabled=!0,n.classList.add("disabled"),n.replaceChildren(f(x,null,f("i",{className:"fa fa-spinner fa-spin"})," Running"));let t=(new Date).getTime(),i=0,s=0,a=0,o=0;this.runBulkSim((l=>{const r=(new Date).getTime()-t,d=l.completedIterations/(r/1e3);0===o&&(o=l.totalSims),this.fastMode&&(0===s&&l.totalSims>0&&(s=Math.ceil(Math.log(l.totalSims/20)/Math.log(2))+1,a=1),l.totalSims<i&&(a+=1,t=(new Date).getTime())),this.setSimProgress(l,d,a,s,o),i=l.totalSims,l.finalBulkResult&&(this.pendingDiv.classList.add("hide"),this.leftPanel.classList.remove("blurred"),this.rightPanel.classList.remove("blurred"),this.pendingResults.hideAll(),n.disabled=!1,n.classList.remove("disabled"),n.replaceChildren(...e))}))}));const o=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},f("i",{className:"fa fa-download"})," Import From Bags");o.addEventListener("click",(()=>new Vp(this.simUI.rootElem,this.simUI,this).open()));const l=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},f("i",{className:"fa fa-download"})," Import Favorites");l.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>_t.create({id:e})));this.addItems(e)}));const r=I(),d=I(),c=f("div",{className:"search-wrapper hide"},f("input",{ref:r,type:"text",placeholder:"Search...",className:"batch-search-input form-control hide"}),f("ul",{ref:d,className:"batch-search-results hide"}));let h=Array();r.value?.addEventListener("keyup",(e=>{if("Enter"==e.key){const e=Array();d.value?.childNodes.forEach((t=>{const i=t.getAttribute("data-item-id");null!=i&&e.push(_t.create({id:Number.parseInt(i)}))})),this.addItems(e)}})),r.value?.addEventListener("input",(e=>{const t=r.value?.value||"";if(!t.length)return d.value?.replaceChildren(),void d.value?.classList.add("hide");const i=t.split(" "),s=f(x,null);h.forEach((e=>{let t=!0;const a=e.name.toLowerCase(),n=e.setName.toLowerCase();if(i.forEach((e=>{const i=e.toLowerCase();return!(!a.includes(i)&&!n.includes(i))||(t=!1,!1)})),t){const t=I(),i=I();s.appendChild(f("li",{ref:t,dataset:{itemId:e.id.toString()}},f("span",{ref:i},e.name),e.heroic&&f("span",{className:"item-quality-uncommon"},"[H]"),e.factionRestriction===Z.HORDE_ONLY&&f("span",{className:"faction-horde"},"(H)"),e.factionRestriction===Z.ALLIANCE_ONLY&&f("span",{className:"faction-alliance"},"(A)"))),vp(i.value,e.quality),t.value?.addEventListener("click",(()=>this.addItem(_t.create({id:e.id}))))}})),d.value?.replaceChildren(s),d.value?.classList.remove("hide")}));const m=f(x,null,f("i",{className:"fa fa-search"})," Add Item"),u=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},m.cloneNode(!0));u.addEventListener("click",(()=>{r.value?.classList.contains("hide")?(c?.classList.remove("hide"),u.replaceChildren(f(x,null,"Close Search Results")),h=this.simUI.sim.db.getAllItems().filter((e=>U(this.simUI.player,e,void 0))),r.value?.classList.remove("hide"),r.value?.value&&d.value?.classList.remove("hide"),r.value?.focus()):(u.replaceChildren(m.cloneNode(!0)),c?.classList.add("hide"),r.value?.classList.add("hide"),d.value?.replaceChildren(),d.value?.classList.add("hide"))}));const p=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},"Clear all");p.addEventListener("click",(()=>{this.clearItems(),s.rootElem.hidden=!0,s.bodyElement.replaceChildren()}));const g=I(),w=f("div",{className:yt("talents-picker-container",!this.simTalents&&"hide")},f("label",{className:"mb-2"},"Pick talents to sim (will increase time to sim)"),f("div",{ref:g,className:"talents-container"})),v=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let b;try{null!==v&&(b=JSON.parse(v))}catch(E){console.warn("Invalid json for local storage value: "+v)}const S=(e,t)=>{const i=e.querySelector(".saved-data-set-chip");if(this.savedTalents.some((e=>e.name===t.name))){const e=this.savedTalents.findIndex((e=>e.name===t.name));this.savedTalents.splice(e,1),i?.classList.remove("active")}else this.savedTalents.push(t),i?.classList.add("active")};for(const I in b)try{const e={talentsString:ui.fromJson(b[I]).talentsString,name:I},t=this.savedTalents.findIndex((t=>JSON.stringify(t)===JSON.stringify(e))),i=f("div",{className:yt("saved-data-set-chip badge rounded-pill",-1!==t&&"active")},f("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},I));g.value.appendChild(i),i.addEventListener("click",(()=>S(i,e)))}catch(E){console.log(E),console.warn("Failed parsing saved data: "+b[I])}a.bodyElement.appendChild(f(x,null,n,o,l,u,c,p,w)),new mt(a.bodyElement,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,i)=>{t.fastMode=i}}),new mt(a.bodyElement,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,i)=>{t.doCombos=i}}),new mt(a.bodyElement,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,i)=>{t.autoEnchant=i}}),new mt(a.bodyElement,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,i)=>{t.simTalents=i,w.classList[i?"remove":"add"]("hide")}})}setSimProgress(e,t,i,s,a){const n=((e.totalIterations-e.completedIterations)/t).toFixed();this.pendingResults.setContent(f("div",{className:"results-sim"},f("div",null,a," total combinations."),f("div",null,s>0&&f(x,null,i," / ",s," refining rounds")),f("div",null,e.completedSims," / ",e.totalSims,f("br",null),"simulations complete"),f("div",null,e.completedIterations," / ",e.totalIterations,f("br",null),"iterations complete"),f("div",null,n," seconds remaining.")))}}class Gp extends g{constructor(e,t,i){super(e,"saved-data-manager-root"),this.modObject=t,this.config=i,this.userData=[],this.presets=[],this.frozen=!1;const s=new bp(this.rootElem,"saved-data",{header:i.header}),a=I(),n=I(),o=I();s.bodyElement.replaceChildren(f("div",{ref:a,className:"saved-data-container hide"},f("div",{ref:n,className:"saved-data-presets"}),f("div",{ref:o,className:"saved-data-custom"}))),this.savedDataDiv=a.value,this.presetDataDiv=n.value,this.customDataDiv=o.value,i.presetsOnly||s.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){this.savedDataDiv.classList.remove("hide");const t=this.makeSavedData(e),i=e.isPreset?this.presets:this.userData,s=i.findIndex((t=>t.name==e.name));-1==s?(e.isPreset?this.presetDataDiv.appendChild(t.elem):this.customDataDiv.appendChild(t.elem),i.push(t)):(i[s].elem.replaceWith(t.elem),i[s]=t)}makeSavedData(e){const t=I(),i=f("div",{className:"saved-data-set-chip badge rounded-pill"},f("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},e.name),!e.isPreset&&f("a",{ref:t,href:"javascript:void(0)",className:"saved-data-set-delete",attributes:{role:"button"}},f("i",{className:"fa fa-times fa-lg"})));if(i.addEventListener("click",(()=>{this.config.setData(a.nextEventID(),this.modObject,e.data),this.saveInput&&(this.saveInput.value=e.name)})),!e.isPreset&&t.value){const i=qa(t.value,{content:`Delete saved ${this.config.label}`});t.value.addEventListener("click",(t=>{t.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${e.name}'?`))return;i.destroy();const s=this.userData.findIndex((t=>t.name==e.name));this.userData[s].elem.remove(),this.userData.splice(s,1),this.saveUserData()}))}e.tooltip&&qa(i,{content:e.tooltip,placement:"bottom"});const s=()=>{this.config.equals(e.data,this.config.getData(this.modObject))?i.classList.add("active"):i.classList.remove("active"),e.enableWhen&&!e.enableWhen(this.modObject)?i.classList.add("disabled"):i.classList.remove("disabled")};return s(),this.config.changeEmitters.forEach((e=>e.on(s))),{name:e.name,data:e.data,elem:i,enableWhen:e.enableWhen}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),0==this.userData.length&&0==this.presets.length&&this.savedDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(i){console.warn("Invalid json for local storage value: "+e)}for(const s in t)try{this.addSavedData({name:s,data:this.config.fromJson(t[s])})}catch(i){console.warn("Failed parsing saved data: "+t[s])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const e=I(),t=I(),i=f("div",{className:"saved-data-create-container"},f("label",{className:"form-label"},this.config.label," Name"),f("input",{ref:t,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),f("button",{ref:e,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=t.value,e.value?.addEventListener("click",(()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),i}}class Kp extends Fp{constructor(e,t){super(e,t,{identifier:"gear-tab",title:"Gear"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSavedGearsetPicker()}buildGearPickers(){new Hp(this.leftPanel,this.simUI,this.simUI.player)}buildSavedGearsetPicker(){const e=new Gp(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>pi.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,i)=>{a.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(i.gear||Nt.create())),t.setBonusStats(e,tn.fromProto(i.bonusStatsStats||p.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>pi.equals(e,t),toJson:e=>pi.toJson(e),fromJson:e=>pi.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:pi.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new tn).toProto()}),enableWhen:t.enableWhen})}))}))}}class Jp extends w{constructor(e,t,i){super(e,"adaptive-string-picker-root",t,i),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=i.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const Zp={actions:{create:{useIcon:!1}}};let Yp=null;class Qp extends w{constructor(e,t,i){if(i.isCompact&&(i.extraCssClasses=[...i.extraCssClasses||[],"list-picker-compact"]),super(e,"list-picker-root",t,i),this.config={...Zp,...i},this.itemPickerPairs=[],this.rootElem.appendChild(f(x,null,i.title&&f("label",{className:"list-picker-title form-label"},i.title),f("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=qa(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback((()=>e?.destroy()))}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let e=null,t=null;this.config.actions?.create?.useIcon?(e=Qp.makeActionElem("link-success","fa-plus"),t=qa(e,{allowHTML:!1,content:`New ${i.itemLabel}`}),this.addOnDisposeCallback((()=>t?.destroy()))):e=f("button",{className:"btn btn-primary"},"New ",i.itemLabel),e.classList.add("list-picker-new-button"),e.addEventListener("click",(()=>{const e=this.config.newItem(),i=this.config.getValue(this.modObject).concat([e]);this.config.setValue(a.nextEventID(),this.modObject,i),t&&t.hide()}),{signal:this.signal}),this.rootElem.appendChild(e)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addNewPicker(){const e=this.itemPickerPairs.length,t=document.createElement("div");t.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&t.classList.add("inline"),this.itemsDiv.appendChild(t);const i=document.createElement("div");i.classList.add("list-picker-item");const s=document.createElement("div");if(s.classList.add("list-picker-item-header"),this.config.inlineMenuBar)t.appendChild(i),t.appendChild(s);else if(t.appendChild(s),t.appendChild(i),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,s.appendChild(e)}const n=this.config.newItemPicker(i,this,e,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[e],setValue:(t,i,s)=>{const a=this.getSourceValue();a[e]=s,this.config.setValue(t,i,a)}}),o={elem:t,picker:n,idx:e};if(this.actionEnabled("move")){const i=Qp.makeActionElem("list-picker-item-move","fa-arrows-up-down");s.appendChild(i);const n=qa(i,{allowHTML:!1,content:"Move (Drag+Drop)"});i.addEventListener("click",(()=>{n.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>{n?.destroy()})),i.draggable=!0,i.addEventListener("dragstart",(e=>{e.target==i&&(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",t.classList.add("dragfrom"),Yp={listPicker:this,item:o})}),{signal:this.signal});let l=0;t.addEventListener("dragenter",(e=>{Yp&&Yp.listPicker==this&&(e.preventDefault(),l++,t.classList.add("dragto"))}),{signal:this.signal}),t.addEventListener("dragleave",(e=>{Yp&&Yp.listPicker==this&&(e.preventDefault(),l--,l<=0&&t.classList.remove("dragto"))}),{signal:this.signal}),t.addEventListener("dragover",(e=>{Yp&&Yp.listPicker==this&&e.preventDefault()}),{signal:this.signal}),t.addEventListener("drop",(i=>{if(!Yp||Yp.listPicker!=this)return;i.preventDefault(),l=0,t.classList.remove("dragto"),Yp.item.elem.classList.remove("dragfrom");const s=Yp.item.idx,n=e,o=this.config.getValue(this.modObject),r=o[s];o.splice(s,1),o.splice(n,0,r),this.config.setValue(a.nextEventID(),this.modObject,o),Yp=null}),{signal:this.signal})}if(this.actionEnabled("copy")){const t=Qp.makeActionElem("list-picker-item-copy","fa-copy");s.appendChild(t);const i=qa(t,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject).slice();t.splice(e,0,this.config.copyItem(t[e])),this.config.setValue(a.nextEventID(),this.modObject,t),i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>i?.destroy()))}if(this.actionEnabled("delete")&&(!this.config.minimumItems||e+1>this.config.minimumItems)){const t=Qp.makeActionElem("list-picker-item-delete","fa-times");t.classList.add("link-danger"),s.appendChild(t);const i=qa(t,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject);t.splice(e,1),this.config.setValue(a.nextEventID(),this.modObject,t),i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>i?.destroy()))}this.itemPickerPairs.push(o)}static makeActionElem(e,t){return f("a",{href:"javascript:void(0)",className:yt("list-picker-item-action",e),attributes:{role:"button"}},f("i",{className:yt("fa","fa-xl",t)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,i=t.nextElementSibling||t.previousElementSibling;if(!i?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return i}}const Xp={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[i]:[]}}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[i]:[]}}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[i]:[]}}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:i,cooldowns:s}=bi(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),a=[[xi.OtherActionPotion,"Uses the potion selected in consumables settings."],[xi.OtherActionOffensiveEquip,"Use any offensive on-use equipment."],[xi.OtherActionDefensiveEquip,"Use any defensive on-use equipment."]];return[[{value:E.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(i||[]).map((e=>{const t=e.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${t.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),a=i.filter((e=>!!e.id.name.match(s))).length>1;return{value:e.id,submenu:a?["Spells",t]:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:E.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(s||[]).map((e=>{const t=e.id.name.replace(/ \([\w\s%]+\)/g,""),i=new RegExp(`${t} \\(Rank [0-9]+\\)`),a=s.filter((e=>!!e.id.name.match(i))).length>1;return{value:e.id,submenu:a?["Cooldowns",t]:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:E.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],a.map((([e,t])=>({value:E.fromOtherId(e),submenu:["Placeholders"],tooltip:t})))].flat()}},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[i]:[]}}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[i]:[]}}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((t=>{const i=t.id.name.replace(/ \(Rank \d+\)/g,""),s=new RegExp(`${i} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(s))).length>1;return{value:t.id,submenu:a?[i]:[]}}))}};class eg extends fi{constructor(e,t,i){const s=Xp[i.actionIdSet];super(e,t,{...i,sourceToValue:e=>e?E.fromProto(e):E.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:s.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(e,t)=>{const s=t.value,a=I(),n=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(i.actionIdSet);e.appendChild(f(x,null,f("a",{ref:a,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),s.name)),s.setBackgroundAndHref(a.value),s.setWowheadDataset(a.value,{useBuffAura:n})},createMissingValue:e=>0==e.anyId()?new Promise((()=>{s.defaultLabel})):e.fill().then((e=>({value:e}))),values:[]});const a=i.getUnitRef,n="self"==i.defaultUnitRef?fe.create({type:ge.Self}):fe.create({type:ge.CurrentTarget}),o=s.getActionIDs,l=async()=>{const e=a(t),i=t.sim.getUnitMetadata(e,t,n);if(i){const e=await o(i);this.setOptions(e)}};l();const r=t.sim.unitMetadataEmitter.on(l),d=t.rotationChangeEmitter.on(l);this.addOnDisposeCallback((()=>{r.dispose(),d.dispose()}))}}class tg extends fi{constructor(e,t,i){super(e,t,{...i,sourceToValue:e=>"spellId"==e?.rawId.oneofKind?t.sim.db.getRuneById(e.rawId.spellId):Ii.create(),valueToSource:e=>gi.create({rawId:{oneofKind:"spellId",spellId:e.id}}),defaultLabel:"Runes",equals:(e,t)=>e==t,setOptionContent:(e,t)=>{const i=E.fromSpellId(t.value.id),s=document.createElement("a");s.classList.add("apl-actionid-item-icon"),s.dataset.whtticon="false",s.classList.add("apl-actionid-item-icon"),i.fillAndSet(s,!0,!0),e.appendChild(s);const a=document.createTextNode(t.value.name);e.appendChild(a)},values:[]});(async()=>{const e=Object.values(D).filter((e=>"string"!=typeof e)).map((e=>t.getRunes(e))).flat().map((e=>({value:e,submenu:[Si.get(e.type)??""]})));this.setOptions(e)})(),t.rotationChangeEmitter.on((()=>this.update))}}const ig={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>fe.create({type:ge.Pet,index:t,owner:fe.create({type:ge.Self})}))),fe.create({type:ge.CurrentTarget}),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>fe.create({type:ge.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>fe.create({type:ge.Target,index:t}))),fe.create({type:ge.Self}),e.getPetMetadatas().asList().map(((e,t)=>fe.create({type:ge.Pet,index:t,owner:fe.create({type:ge.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>fe.create({type:ge.Target,index:t})))].flat()}};class sg extends wi{constructor(e,t,i){const s=!!ig[i.unitSet].targetUI;super(e,t,{...i,sourceToValue:e=>sg.refToValue(e,t,s),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=i.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const a=t.sim.unitMetadataEmitter.on((()=>this.updateValues()));this.addOnDisposeCallback((()=>{a.dispose()}))}static refToValue(e,t,i){if(!e||e.type==ge.Unknown)return{value:e,iconUrl:i?"fa-bullseye":"fa-user",text:i?"Current Target":"Self"};if(e.type==ge.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==ge.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==ge.Player){const i=t.sim.raid.getPlayer(e.index);if(i)return{value:e,iconUrl:i.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==ge.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:vi,text:`Target ${e.index+1}`}}else if(e.type==ge.Pet){const i=t.sim.getUnitMetadata(e,t,fe.create({type:ge.Self}));let s=`Pet ${e.index+1}`,a="fa-paw";if(i){const e=i.getName();if(e){const t=e.indexOf(" - ");s=e.substring(t+3),a=Ei(s)||a}}return{value:e,iconUrl:a,text:s}}return{value:e}}updateValues(){const e=ig[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const i={value:sg.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==ge.Pet&&(e.targetUI?i.submenu=[sg.refToValue(t.owner,this.modObject,e.targetUI)]:i.submenu=[sg.refToValue(void 0,this.modObject,e.targetUI)]),i})))}}class ag extends w{constructor(e,t,i){super(e,"apl-picker-builder-root",t,i),this.config=i,this.fieldPickers=i.fields.map((e=>ag.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const i=t.field,s=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:He(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const s=e.getSourceValue();return s[i]||(s[i]=t.newValue()),s[i]},setValue:(t,s,a)=>{e.getSourceValue()[i]=a,s.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==i&&"actions"!==i||s.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:s}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function ng(e,t,i,s,a){return{field:e,newValue:()=>gi.create(),factory:(e,a,n,o)=>new eg(e,a,{id:He(),...n,actionIdSet:t,getUnitRef:()=>i?o()[i]:fe.create(),defaultUnitRef:s||"self"}),...a||{}}}function og(e,t,i){return{field:e,newValue:()=>{},factory:(e,i,s)=>new sg(e,i,{id:He(),...s,unitSet:t}),...i||{}}}function lg(e,t,i){return{field:e,newValue:()=>!1,factory:(e,t,i)=>(i.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new mt(e,t,{id:He(),...i})),...i||{},label:t}}function rg(e,t,i){return{field:e,newValue:()=>0,factory:(e,i,s)=>{const a=s;return a.float=t,a.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new Fc(e,i,a)},...i||{}}}function dg(e,t){return{field:e,newValue:()=>"",factory:(e,t,i)=>(i.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new Jp(e,t,{id:He(),...i})),...t||{}}}function cg(e,t){return(i,s,a)=>new ag(i,s,{...a,newValue:e,fields:t})}class hg extends w{constructor(e,t,i){super(e,"apl-value-picker-root",t,i);const s=null!=this.rootElem.closest(".apl-prepull-action-picker"),a=Object.keys(gg).filter((e=>gg[e].includeIf?.(t,s)??!0));this.kindPicker=new As(this.rootElem,t,{id:He(),defaultLabel:"No Condition",values:[{value:void 0,label:"<None>"}].concat(a.map((e=>{const t=gg[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}))),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,i)=>{const s=this.getSourceValue(),a=s?.value.oneofKind;if(a!=i){if(i){const t=gg[i];let n=this.makeAPLValue(i,t.newValue());s&&a&&this.valuePicker&&("not"==i?n.value.not.val=this.makeAPLValue(a,this.valuePicker.getInputValue()):"not"==s.value.oneofKind&&s.value.not.val?.value.oneofKind==i?n=s.value.not.val:"and"==i?"or"==s.value.oneofKind?n.value.and.vals=s.value.or.vals:n.value.and.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"or"==i?"and"==s.value.oneofKind?n.value.or.vals=s.value.and.vals:n.value.or.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"min"==i?"max"==s.value.oneofKind?n.value.min.vals=s.value.max.vals:n.value.min.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"max"==i?"min"==s.value.oneofKind?n.value.max.vals=s.value.min.vals:n.value.max.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"and"==s.value.oneofKind&&s.value.and.vals?.[0]?.value.oneofKind==i?n=s.value.and.vals[0]:"or"==s.value.oneofKind&&s.value.or.vals?.[0]?.value.oneofKind==i?n=s.value.or.vals[0]:"min"==s.value.oneofKind&&s.value.min.vals?.[0]?.value.oneofKind==i?n=s.value.min.vals[0]:"max"==s.value.oneofKind&&s.value.max.vals?.[0]?.value.oneofKind==i?n=s.value.max.vals[0]:"cmp"==i&&(n.value.cmp.lhs=this.makeAPLValue(a,this.valuePicker.getInputValue()))),s?s.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?Ws.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t])}makeAPLValue(e,t){if(!e)return Ws.create();const i={oneofKind:e};return i[e]=t,Ws.create({value:i})}updateValuePicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const i=gg[e];this.valuePicker=i.factory(this.rootElem,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||i.newValue()},setValue:(t,i,s)=>{const a=this.getSourceValue();a&&(a.value[e]=s),i.rotationChangeEmitter.emit(t)}})}}function mg(e,t){return{field:e,newValue:Ws.create,factory:(e,t,i)=>new hg(e,t,i),...t||{}}}function ug(e){return{field:e,newValue:()=>[],factory:(e,t,i)=>new Qp(e,t,{...i,setValue:(e,t,s)=>{i.setValue(e,t,s.map((e=>e||Ws.create())))},itemLabel:"Value",newItem:Ws.create,copyItem:e=>e?Ws.clone(e):e,newItemPicker:(e,i,s,a)=>new hg(e,t,a),allowedActions:["create","delete"],actions:{create:{useIcon:!0}}})}}function pg(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:cg(e.newValue,e.fields)}}const gg={const:pg({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:yi.create,fields:[dg("val")]}),cmp:pg({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:Pi.create,fields:[mg("lhs"),(fg="op",{field:fg,newValue:()=>_s.OpEq,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:_s.OpEq,label:"=="},{value:_s.OpNe,label:"!="},{value:_s.OpGe,label:">="},{value:_s.OpGt,label:">"},{value:_s.OpLe,label:"<="},{value:_s.OpLt,label:"<"}]})}),mg("rhs")]}),math:pg({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:ki.create,fields:[mg("lhs"),function(e){return{field:e,newValue:()=>Rs.OpAdd,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Rs.OpAdd,label:"+"},{value:Rs.OpSub,label:"-"},{value:Rs.OpMul,label:"*"},{value:Rs.OpDiv,label:"/"}]})}}("op"),mg("rhs")]}),max:pg({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:Ci.create,fields:[ug("vals")]}),min:pg({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:Li.create,fields:[ug("vals")]}),and:pg({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ti.create,fields:[ug("vals")]}),or:pg({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ni.create,fields:[ug("vals")]}),not:pg({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:_i.create,fields:[mg("val")]}),currentTime:pg({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Ai.create,fields:[]}),currentTimePercent:pg({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:Ri.create,fields:[]}),remainingTime:pg({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:Di.create,fields:[]}),remainingTimePercent:pg({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Mi.create,fields:[]}),isExecutePhase:pg({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:Vi.create,fields:[function(e){return{field:e,newValue:()=>Vs.E20,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Vs.E20,label:"20%"},{value:Vs.E25,label:"25%"},{value:Vs.E35,label:"35%"}]})}}("threshold")]}),numberTargets:pg({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:Ui.create,fields:[]}),frontOfTarget:pg({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Wi.create,fields:[]}),currentHealth:pg({label:"Health",submenu:["Resources"],shortDescription:"Amount of currently available Health.",newValue:Fi.create,fields:[og("sourceUnit","aura_sources")]}),currentHealthPercent:pg({label:"Health (%)",submenu:["Resources"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:Oi.create,fields:[og("sourceUnit","aura_sources")]}),currentMana:pg({label:"Mana",submenu:["Resources"],shortDescription:"Amount of currently available Mana.",newValue:Hi.create,fields:[],includeIf:(e,t)=>e.getClass()!=l.ClassRogue&&e.getClass()!=l.ClassWarrior}),currentManaPercent:pg({label:"Mana (%)",submenu:["Resources"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:qi.create,fields:[],includeIf:(e,t)=>e.getClass()!=l.ClassRogue&&e.getClass()!=l.ClassWarrior}),currentRage:pg({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:Bi.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassWarrior||e.getClass()==l.ClassDruid}),currentEnergy:pg({label:"Energy",submenu:["Resources"],shortDescription:"Amount of currently available Energy.",newValue:zi.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),timeToEnergyTick:pg({label:"Time to Next Energy Tick",submenu:["Resources"],shortDescription:"Time until the next energy regen tick will happen",newValue:ji.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),energyThreshold:pg({label:"Energy Threshold",submenu:["Resources"],shortDescription:"Compares current energy to a threshold value.",newValue:$i.create,fields:[rg("threshold",!1,{label:">=",labelTooltip:"Energy threshold. Subtracted from maximum energy if negative."})],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),currentComboPoints:pg({label:"Combo Points",submenu:["Resources"],shortDescription:"Amount of currently available Combo Points.",newValue:Gi.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),gcdIsReady:pg({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:Ki.create,fields:[]}),gcdTimeToReady:pg({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:Ji.create,fields:[]}),autoTimeToNext:pg({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:Zi.create,fields:[function(e){return{field:e,newValue:()=>Ds.Any,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ds.Any,label:"Any"},{value:Ds.Melee,label:"Melee"},{value:Ds.MainHand,label:"Main Hand"},{value:Ds.OffHand,label:"Off Hand"},{value:Ds.Ranged,label:"Ranged"}]})}}("autoType")]}),autoSwingTime:pg({label:"Auto Swing Time",submenu:["Auto"],shortDescription:"Total swing duration including all haste buffs.",newValue:Yi.create,fields:[function(e){return{field:e,newValue:()=>Ms.MainHand,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ms.MainHand,label:"Main Hand"},{value:Ms.OffHand,label:"Off Hand"},{value:Ms.Ranged,label:"Ranged"}]})}}("autoType")]}),spellIsKnown:pg({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:Qi.create,fields:[ng("spellId","castable_spells","")]}),spellCurrentCost:pg({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:Xi.create,fields:[ng("spellId","castable_spells","")]}),spellCanCast:pg({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:es.create,fields:[ng("spellId","castable_spells","")]}),spellIsReady:pg({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:ts.create,fields:[ng("spellId","castable_spells","")]}),spellTimeToReady:pg({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:is.create,fields:[ng("spellId","castable_spells","")]}),spellCastTime:pg({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:ss.create,fields:[ng("spellId","castable_spells","")]}),spellTravelTime:pg({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:as.create,fields:[ng("spellId","castable_spells","")]}),spellCpm:pg({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:ns.create,fields:[ng("spellId","castable_spells","")]}),spellIsChanneling:pg({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:os.create,fields:[ng("spellId","channel_spells","")]}),spellChanneledTicks:pg({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:ls.create,fields:[ng("spellId","channel_spells","")]}),channelClipDelay:pg({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:rs.create,fields:[]}),auraIsKnown:pg({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:ds.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","auras","sourceUnit")]}),auraIsActive:pg({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:cs.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:pg({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:hs.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","auras","sourceUnit")]}),auraRemainingTime:pg({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:ms.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","auras","sourceUnit")]}),auraNumStacks:pg({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:us.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:pg({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:ps.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:pg({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:gs.create,fields:[og("sourceUnit","aura_sources"),ng("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:pg({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>fs.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[og("sourceUnit","aura_sources_targets_first"),ng("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),mg("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),runeIsEquipped:pg({label:"Rune Equipped",submenu:["Rune"],shortDescription:"<b>True</b> if the rune is currently equipped, otherwise <b>False</b>.",newValue:Is.create,fields:[function(e){return{field:e,newValue:()=>gi.create(),factory:(e,t,i,s)=>new tg(e,t,{id:He(),...i})}}("runeId")]}),dotIsActive:pg({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:ws.create,fields:[og("targetUnit","targets"),ng("spellId","dot_spells","")]}),dotRemainingTime:pg({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:vs.create,fields:[og("targetUnit","targets"),ng("spellId","dot_spells","")]}),sequenceIsComplete:pg({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:bs.create,fields:[dg("sequenceName")]}),sequenceIsReady:pg({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:xs.create,fields:[dg("sequenceName")]}),sequenceTimeToReady:pg({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:Ss.create,fields:[dg("sequenceName")]}),totemRemainingTime:pg({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:Es.create,includeIf:(e,t)=>e.getClass()==l.ClassShaman,fields:[function(e){return{field:e,newValue:()=>Us.Water,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Us.Earth,label:"Earth"},{value:Us.Air,label:"Air"},{value:Us.Fire,label:"Fire"},{value:Us.Water,label:"Water"}]})}}("totemType")]}),catExcessEnergy:pg({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:ys.create,includeIf:(e,i)=>e.spec==t.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:pg({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:Ps.create,includeIf:(e,i)=>e.spec==t.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:pg({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:ks.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:pg({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:Cs.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[og("targetUnit","targets")]}),warlockCurrentPetMana:pg({label:"Pet Mana",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana.",newValue:Ls.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[]}),warlockCurrentPetManaPercent:pg({label:"Pet Mana (%)",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana, as a percentage.",newValue:Ts.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[]}),currentSealRemainingTime:pg({label:"Current Seal Remaining Time",submenu:["Paladin"],shortDescription:"Returns the amount of time remaining until the Paladin's current Seal aura will expire.",newValue:Ns.create,includeIf:(e,t)=>e.getClass()==l.ClassPaladin,fields:[]})};var fg;class Ig extends w{constructor(e,t,i){super(e,"apl-action-picker-root",t,i),this.conditionPicker=new hg(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,i)=>{const s=this.getSourceValue();s?(s.condition=i,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,na.create({condition:i}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const s=null!=this.rootElem.closest(".apl-prepull-action-picker"),a=Object.keys(bg).filter((e=>bg[e].includeIf?.(t,s)??!0));this.kindPicker=new As(this.actionDiv,t,{id:He(),defaultLabel:"Action",values:a.map((e=>{const t=bg[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,i)=>{const s=this.getSourceValue(),a=s?.action.oneofKind;if(a!=i){if(i){const t=bg[i];let n=this.makeAPLAction(i,t.newValue());s&&a&&this.actionPicker&&("sequence"==i?"strictSequence"==s.action.oneofKind?n.action.sequence.actions=s.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"strictSequence"==i?"sequence"==s.action.oneofKind?n.action.strictSequence.actions=s.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"sequence"==s.action.oneofKind&&s.action.sequence.actions?.[0]?.action.oneofKind==i?n=s.action.sequence.actions[0]:"strictSequence"==s.action.oneofKind&&s.action.strictSequence.actions?.[0]?.action.oneofKind==i&&(n=s.action.strictSequence.actions[0])),s?s.action=n.action:this.setSourceValue(e,n)}else s.action={oneofKind:i};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return na.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||Ws.create());const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return na.create();const i={oneofKind:e};return i[e]=t,na.create({action:i})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const i=bg[e];this.actionPicker=i.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||i.newValue(),setValue:(t,i,s)=>{const a=this.getSourceValue();a&&((a?.action)[e]=s),i.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function wg(e){return{field:e,newValue:()=>[],factory:(e,t,i)=>new Qp(e,t,{...i,setValue:(e,t,s)=>{i.setValue(e,t,s.map((e=>e||na.create())))},itemLabel:"Action",newItem:na.create,copyItem:e=>e?na.clone(e):e,newItemPicker:(e,i,s,a)=>new Ig(e,t,a),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function vg(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:cg(e.newValue,e.fields)}}const bg={castSpell:vg({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:Fs.create,fields:[ng("spellId","castable_spells",""),og("target","targets")]}),multidot:vg({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>Os.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[ng("spellId","dot_spells",""),rg("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),mg("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:vg({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&Hs(e.spec),newValue:()=>qs.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[ng("spellId","shield_spells",""),rg("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),mg("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:vg({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if Instant Interrupt is true OR all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>Bs.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[ng("spellId","channel_spells",""),og("target","targets"),mg("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),lg("instantInterrupt","Instant Interrupt",{labelTooltip:"If checked, interrupts of this channel will happen instantly after the cast."}),lg("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),autocastOtherCooldowns:vg({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:zs.create,fields:[]}),wait:vg({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>js.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[mg("duration")]}),waitUntil:vg({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>$s.create(),fields:[mg("condition")]}),schedule:vg({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>Gs.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[dg("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:Ws.create,factory:(e,t,i)=>new Ig(e,t,i)}}("innerAction")]}),sequence:vg({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Ks.create,fields:[dg("name"),wg("actions")]}),resetSequence:vg({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Js.create,fields:[dg("sequenceName")]}),strictSequence:vg({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Zs.create,fields:[wg("actions")]}),changeTarget:vg({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>Ys.create(),fields:[og("newTarget","targets")]}),activateAura:vg({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>Qs.create(),fields:[ng("auraId","auras")]}),activateAuraWithStacks:vg({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>Xs.create({numStacks:"1"}),fields:[ng("auraId","stackable_auras"),dg("numStacks",{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),addComboPoints:vg({label:"Add Combo Points",submenu:["Misc"],shortDescription:"Add combo points to target.",includeIf:(e,t)=>t,newValue:()=>ea.create({numPoints:"1"}),fields:[dg("numPoints",{labelTooltip:"Desired number of initial combo points."})]}),cancelAura:vg({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>ta.create(),fields:[ng("auraId","auras")]}),triggerIcd:vg({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>ia.create(),fields:[ng("auraId","icd_auras")]}),itemSwap:vg({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>tf.includes(e.spec),newValue:()=>oa.create(),fields:[function(e){return{field:e,newValue:()=>da.Swap1,factory:(e,t,i)=>new As(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:da.Main,label:"Main"},{value:da.Swap1,label:"Swapped"}]})}}("swapSet")]}),move:vg({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>sa.create(),fields:[mg("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),customRotation:vg({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>la.create(),fields:[]}),catOptimalRotationAction:vg({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded legacy algorithm.",includeIf:(e,i)=>e.spec==t.SpecFeralDruid,newValue:()=>aa.create({minCombosForRip:3,maxWaitTime:2,maintainFaerieFire:!1,useShredTrick:!1}),fields:[rg("minCombosForRip",!1,{label:"Min Rip CP",labelTooltip:"Combo Point threshold for allowing a Rip cast"}),rg("maxWaitTime",!0,{label:"Max Wait Time",labelTooltip:"Max seconds to wait for an Energy tick to cast rather than powershifting"}),lg("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"If checked, bundle Faerie Fire refreshes with powershifts. Ignored if an external Faerie Fire debuff is selected in settings."}),lg("useShredTrick","Use Shred Trick",{labelTooltip:'If checked, enable the "Shred trick" micro-optimization. This should only be used on short fight lengths with full powershifting uptime.'})]}),castPaladinPrimarySeal:vg({label:"Cast Primary Seal",submenu:["Paladin"],shortDescription:"Casts the Paladin's designated primary seal spell.",includeIf:(e,i)=>e.spec==t.SpecRetributionPaladin,newValue:()=>ra.create({}),fields:[]})};class xg extends g{constructor(e,t,i){super(e,"apl-rotation-picker-root"),new Qp(this.rootElem,i,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,i)=>{t.aplRotation.prepullActions=i,t.rotationChangeEmitter.emit(e)},newItem:()=>ca.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>ca.clone(e),newItemPicker:(e,t,s,a)=>new Sg(e,i,a,s),inlineMenuBar:!0}),new Qp(this.rootElem,i,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,i)=>{t.aplRotation.priorityList=i,t.rotationChangeEmitter.emit(e)},newItem:()=>ha.create({action:{}}),copyItem:e=>ha.clone(e),newItemPicker:(e,t,s,a)=>new Eg(e,i,a,s),inlineMenuBar:!0})}}class Sg extends w{getItem(){return this.getSourceValue()||ca.create({action:{}})}constructor(e,t,i,s){i.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,i),this.player=t;const a=Qp.getItemHeaderElem(this);yg(a,t,(e=>e.getCurrentStats().rotationStats?.prepullActions[s]?.warnings||[])),this.hidePicker=new Pg(a,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,i)=>{this.getItem().hide=i,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new Jp(this.rootElem,this.player,{id:He(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,i)=>{this.getItem().doAtValue=i?Ws.create({value:{oneofKind:"const",const:{val:i}}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new Ig(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,i)=>{this.getItem().action=i,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return ca.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||na.create()))}}class Eg extends w{getItem(){return this.getSourceValue()||ha.create({action:{}})}constructor(e,t,i,s){i.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,i),this.player=t;const a=Qp.getItemHeaderElem(this);yg(a,t,(e=>e.getCurrentStats().rotationStats?.priorityList[s]?.warnings||[])),this.hidePicker=new Pg(a,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,i)=>{this.getItem().hide=i,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new Ig(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,i)=>{this.getItem().action=i,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return ha.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||na.create()))}}function yg(e,t,i){const s=Qp.makeActionElem("apl-warnings","fa-exclamation-triangle");s.classList.add("warning","link-warning"),s.setAttribute("data-bs-html","true");const a=qa(s,{theme:"dropdown-tooltip",content:"Warnings"});e.appendChild(s);const n=async()=>{if(!ma(s))return a?.destroy(),s?.remove(),void t.currentStatsEmitter.off(n);a.setContent("");const e=i(t);if(e.length){s.style.visibility="visible";const t=await Promise.all(e.map((e=>E.replaceAllInString(e))));a.setContent(`\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${t.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t</ul>\n\t\t\t`)}else s.style.visibility="hidden"};n(),t.currentStatsEmitter.on(n)}class Pg extends w{constructor(e,t,i){super(e,"hide-picker-root",t,i),this.inputElem=Qp.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.rootElem.appendChild(this.inputElem),this.tooltip=qa(this.inputElem,{content:"Enable/Disable"}),this.init(),this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(a.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class kg extends w{constructor(e,t,i){super(e,"number-list-picker-root",t,i),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.placeholder=i.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(a.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){Dt(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class Cg extends g{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[],a.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((e=>{this.update()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const i=e[t],s=document.createElement("div");s.classList.add("cooldown-picker"),t==e.length&&s.classList.add("add-cooldown-picker"),this.rootElem.appendChild(s),this.makeActionPicker(s,t);const n=document.createElement("label");n.classList.add("cooldown-picker-label","form-label"),i&&i.id&&E.fromProto(i.id).fill(this.player.getRaidIndex()).then((e=>n.textContent=e.name)),s.appendChild(n),this.makeTimingsPicker(s,t);const o=document.createElement("fragment");o.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="delete-cooldown link-danger"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</a>\n\t\t\t';const l=o.children[0],r=qa(l,{content:"Delete Cooldown"});l.addEventListener("click",(e=>{const i=this.player.getSimpleCooldowns();i.cooldowns.splice(t,1),this.player.setSimpleCooldowns(a.nextEventID(),i),r.hide()})),s.appendChild(l),this.cooldownPickers.push(s)}}makeActionPicker(e,t){const i=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id));return new Fn(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:gi.create()}].concat(i.map((e=>({actionId:()=>e,value:e.toProto()})))),equals:(e,t)=>gi.equals(e,t),zeroValue:gi.create(),backupIconUrl:e=>E.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||gi.create(),setValue:(e,i,s)=>{const a=i.getSimpleCooldowns();for(;a.cooldowns.length<t;)a.cooldowns.push(ua.create());a.cooldowns[t]=ua.create({id:s,timings:[]}),i.setSimpleCooldowns(e,a)}})}makeTimingsPicker(e,t){return new kg(e,this.player,{extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,i,s)=>{const a=i.getSimpleCooldowns();a.cooldowns[t].timings=s,i.setSimpleCooldowns(e,a)},enableWhen:e=>{const i=e.getSimpleCooldowns().cooldowns[t];return i&&!gi.equals(i.id,gi.create())}})}}class Lg extends Fp{constructor(e,t){super(e,t,{identifier:"rotation-tab",title:"Rotation"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("rotation-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("rotation-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto"),this.rootElem.classList.remove("rotation-type-simple"),this.rootElem.classList.remove("rotation-type-apl"),this.rootElem.classList.remove("rotation-type-legacy");const e=this.simUI.player.getRotationType();e==$.TypeAuto?this.rootElem.classList.add("rotation-type-auto"):e==$.TypeSimple?this.rootElem.classList.add("rotation-type-simple"):e==$.TypeAPL?this.rootElem.classList.add("rotation-type-apl"):e==$.TypeLegacy&&this.rootElem.classList.add("rotation-type-legacy")}buildHeader(){const e=document.createElement("div");e.classList.add("rotation-tab-header"),this.leftPanel.appendChild(e),new kc(e,this.simUI.player,{id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:$.TypeAuto,name:"Auto"},{value:$.TypeSimple,name:"Simple"},{value:$.TypeAPL,name:"APL"}]:[{value:$.TypeAuto,name:"Auto"},{value:$.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,i)=>{t.aplRotation.type=i,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){const e=document.createElement("div");e.classList.add("rotation-tab-auto"),this.leftPanel.appendChild(e)}buildAplContent(){const e=document.createElement("div");e.classList.add("rotation-tab-apl"),this.leftPanel.appendChild(e),new xg(e,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new bp(this.leftPanel,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const i=w.newGroupContainer();i.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(i),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(i,this.simUI.individualConfig.rotationIconInputs.map((e=>ao(i,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs),t.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}));const s=new bp(this.leftPanel,"cooldown-settings",{header:{title:"Cooldowns",tooltip:"Specify cooldown timings, in seconds. Cooldowns will be used as soon as possible after their specified timings. When not specified, cooldowns will be used when ready and it is sensible to do so.<br><br>Multiple timings can be provided by separating with commas. Any cooldown usages after the last provided timing will use the default logic."}});s.rootElem.classList.add(e),new Cg(s.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new Fc(e,this.simUI.player,t):"boolean"==t.type?new mt(e,this.simUI.player,{...t}):"enum"==t.type&&new kc(e,this.simUI.player,t)}))}configureIconSection(e,t,i){0==t.length?e.classList.add("hide"):i&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}buildSavedDataPickers(){const e=new Gp(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>pa.create({rotation:T.clone(e.aplRotation)}),setData:(e,t,i)=>{a.freezeAllAndDo((()=>{t.setAplRotation(e,i.rotation||T.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>pa.equals(e,t),toJson:e=>pa.toJson(e),fromJson:e=>pa.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const i=t.rotation;i.rotation||(i.rotation=T.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:i,enableWhen:t.enableWhen})}))}))}}class Tg extends g{constructor(e,t,i,s){super(e,"encounter-picker-root"),Rg(this.rootElem,t,i.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets();new kc(this.rootElem,t,{id:"encounter-npc",extraCssClasses:["damage-metrics","npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>Mg(t.primaryTarget,e.target))),setValue:(t,i,s)=>{-1!=s&&i.applyPresetTarget(t,e[s],0)}}),s.isIndividualSim()&&Hs(s.player.spec)&&new Fc(this.rootElem,s.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:e=>e.targetDummiesChangeEmitter,getValue:e=>e.getTargetDummies(),setValue:(e,t,i)=>{t.setTargetDummies(e,i)}}),s.isIndividualSim()&&oe(s.player.spec)&&new Fc(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,i)=>{t.primaryTarget.minBaseDamage=i,t.targetsChangeEmitter.emit(e)}});const i=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),n=e[i]?.target?.targetInputs||[];(n.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=n[t].label)))&&(t.primaryTarget.targetInputs=n,t.targetsChangeEmitter.emit(a.nextEventID())),Dg(this.rootElem,t,0);const o=new Ng(s.rootElem,s,t),l=document.createElement("button");l.classList.add("advanced-button","btn","btn-primary"),l.textContent="Advanced",l.addEventListener("click",(()=>o.open())),this.rootElem.appendChild(l)}))}}class Ng extends tp{constructor(e,t,i){super(e,"advanced-encounter-picker-modal"),this.encounter=i,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const s=this.rootElem.getElementsByClassName("encounter-header")[0],a=this.rootElem.getElementsByClassName("encounter-targets")[0];Rg(s,this.encounter,!0),t.isIndividualSim()||new mt(s,i,{id:"encounter-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,i)=>{t.setUseHealth(e,i)}}),new Qp(a,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,i)=>{t.targets=i,t.targetsChangeEmitter.emit(e)},newItem:()=>kn.getPresetTargetForLevel(t.sim.raid.getPlayer(0)?.getLevel()??ce,t.sim).target,copyItem:e=>he.clone(e),newItemPicker:(e,t,s,a)=>new _g(e,i,s,a),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new kc(this.header,this.encounter,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,i,s)=>{-1!=s&&i.applyPreset(t,e[s])}})}}class _g extends w{getTarget(){return this.encounter.targets[this.targetIndex]||he.create()}constructor(e,t,i,s){super(e,"target-picker-root",t,s),this.encounter=t,this.targetIndex=i,this.rootElem.innerHTML='\n\t\t\t<div class="target-picker-section target-picker-section1"></div>\n\t\t\t<div class="target-picker-section target-picker-section2"></div>\n\t\t\t<div class="target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const a=this.rootElem.getElementsByClassName("target-picker-section1")[0],n=this.rootElem.getElementsByClassName("target-picker-section2")[0],o=this.rootElem.getElementsByClassName("target-picker-section3")[0],l=t.sim.db.getAllPresetTargets();new kc(a,null,{id:"encounter-npc-picker",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex((e=>Mg(this.getTarget(),e.target))),setValue:(e,i,s)=>{-1!=s&&(t.applyPresetTarget(e,l[s],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new kc(a,null,{id:"encounter-ai-picker",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,i,s)=>{const a=this.getTarget();a.id=s,a.targetInputs=(l.find((e=>a.id==e.target?.id))?.target?.targetInputs||[]).map((e=>fa.clone(e))),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new kc(a,null,{id:"encounter-level-picker",label:"Level",values:[{name:"63",value:63},{name:"62",value:62},{name:"61",value:61},{name:"60",value:60},{name:"53",value:53},{name:"52",value:52},{name:"51",value:51},{name:"50",value:50},{name:"43",value:43},{name:"42",value:42},{name:"41",value:41},{name:"40",value:40},{name:"28",value:28},{name:"27",value:27},{name:"26",value:26},{name:"25",value:25}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,i,s)=>{this.getTarget().level=s,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new kc(a,null,{id:"encounter-mob-type",label:"Mob Type",values:Ug,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,i,s)=>{this.getTarget().mobType=s,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new kc(a,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,i,s)=>{this.getTarget().tankIndex=s,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=Dg(a,t,this.targetIndex),this.statPickers=Vg.map((e=>{const i=e.stat;return new Fc(n,null,{id:`target-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:Ia.get(i),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[i],setValue:(e,s,a)=>{this.getTarget().stats[i]=a,t.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new Fc(o,null,{id:"target-picker-swing-speed",label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,i,s)=>{this.getTarget().swingSpeed=s,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new Fc(o,null,{id:"target-picker-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,i,s)=>{this.getTarget().minBaseDamage=s,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new Fc(o,null,{id:"target-picker-damage-spread",label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,i,s)=>{this.getTarget().damageSpread=s,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new mt(o,null,{id:"target-picker-dual-wield",label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,i,s)=>{this.getTarget().dualWield=s,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new mt(o,null,{id:"target-picker-dw-miss-penalty",label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,i,s)=>{this.getTarget().dualWieldPenalty=s,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new mt(o,null,{id:"target-picker-parry-haste",label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,i,s)=>{this.getTarget().parryHaste=s,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new kc(o,null,{id:"target-picker-spell-school",label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:wa.SpellSchoolPhysical},{name:"Arcane",value:wa.SpellSchoolArcane},{name:"Fire",value:wa.SpellSchoolFire},{name:"Frost",value:wa.SpellSchoolFrost},{name:"Holy",value:wa.SpellSchoolHoly},{name:"Nature",value:wa.SpellSchoolNature},{name:"Shadow",value:wa.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,i,s)=>{this.getTarget().spellSchool=s,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return he.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new tn).withStat(Vg[t].stat,e))).reduce(((e,t)=>e.add(t))).asArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),Vg.forEach(((t,i)=>this.statPickers[i].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class Ag extends w{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||fa.create()}constructor(e,t,i,s,a){super(e,"target-input-picker-root",t,a),this.encounter=t,this.targetIndex=i,this.targetInputIndex=s,this.boolPicker=null,this.numberPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return fa.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0})}setInputValue(e){e&&(e.inputType!=va.Number||this.numberPicker?e.inputType!=va.Bool||this.boolPicker||(this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.boolPicker=new mt(this.rootElem,null,{id:He(),label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,i)=>{this.getTargetInput().boolValue=i,this.encounter.targetsChangeEmitter.emit(e)}})):(this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker=new Fc(this.rootElem,null,{id:He(),label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,i)=>{this.getTargetInput().numberValue=i,this.encounter.targetsChangeEmitter.emit(e)}})))}}function Rg(e,t,i){const s=w.newGroupContainer();if(e.appendChild(s),new Fc(s,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,i)=>{t.setDuration(e,i)},enableWhen:e=>!t.getUseHealth()}),new Fc(s,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,i)=>{t.setDurationVariation(e,i)},enableWhen:e=>!t.getUseHealth()}),i){const i=w.newGroupContainer();i.classList.add("execute-group"),e.appendChild(i),new Fc(i,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,i)=>{t.setExecuteProportion20(e,i/100)},enableWhen:e=>!t.getUseHealth()}),new Fc(i,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,i)=>{t.setExecuteProportion25(e,i/100)},enableWhen:e=>!t.getUseHealth()}),new Fc(i,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,i)=>{t.setExecuteProportion35(e,i/100)},enableWhen:e=>!t.getUseHealth()})}}function Dg(e,t,i){return new Qp(e,t,{itemLabel:"Target Input",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[i].targetInputs,setValue:(e,t,s)=>{t.targets[i].targetInputs=s,t.targetsChangeEmitter.emit(e)},newItem:()=>fa.create(),copyItem:e=>fa.clone(e),newItemPicker:(e,s,a,n)=>new Ag(e,t,i,a,n),hideUi:!0})}function Mg(e,t){if(null==e!=(null==t))return!1;if(null==e)return!0;const i=he.clone(t);return i.targetInputs=e.targetInputs,he.equals(e,i)}const Vg=[{stat:c.StatHealth,tooltip:"",extraCssClasses:[]},{stat:c.StatArmor,tooltip:"",extraCssClasses:[]},{stat:c.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]},{stat:c.StatBlockValue,tooltip:"",extraCssClasses:["threat-metrics"]}],Ug=[{name:"None",value:ga.MobTypeUnknown},{name:"Beast",value:ga.MobTypeBeast},{name:"Demon",value:ga.MobTypeDemon},{name:"Dragonkin",value:ga.MobTypeDragonkin},{name:"Elemental",value:ga.MobTypeElemental},{name:"Giant",value:ga.MobTypeGiant},{name:"Humanoid",value:ga.MobTypeHumanoid},{name:"Mechanical",value:ga.MobTypeMechanical},{name:"Undead",value:ga.MobTypeUndead}];function Wg(e,t){return e.filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)&&(0==e.stats.length||e.stats.some((e=>t.individualConfig.epStats.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))))}class Fg extends g{constructor(e,t){super(e,"consumes-picker-root"),this.simUI=t,this.simUI.sim.waitForInit().then((()=>{this.buildPotionsPicker(),this.buildFlaskPicker(),this.buildWeaponImbuePicker(),this.buildFoodPicker(),this.buildPhysicalBuffPickers(),this.buildDefensiveBuffPickers(),this.buildSpellPowerBuffPickers(),this.buildMiscConsumesPickers(),this.buildEngPickers(),this.buildEnchPicker(),this.buildPetPicker()}))}buildPotionsPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Potions</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-potions"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-potions"),s=Fd(Wg(Wd,this.simUI),"Mana Potion"),n=tr(Wg(er,this.simUI)),o=[ao(i,this.simUI.player,s),ao(i,this.simUI.player,n),ao(i,this.simUI.player,Od)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildFlaskPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Flasks</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-flasks"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-flasks"),s=vr(Wg(wr,this.simUI)),n=[ao(i,this.simUI.player,s)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildWeaponImbuePicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Weapon Imbues</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-weapon-imbues"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-weapon-imbues"),s=yc(Wg(Ec,this.simUI),"Main-Hand"),n=Pc(Wg(Sc,this.simUI),"Off-Hand"),o=[ao(i,this.simUI.player,s),ao(i,this.simUI.player,n)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.gearChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildFoodPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Food</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-food"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-food"),s=Ar(Wg(_r,this.simUI)),n=Or(Wg(Fr,this.simUI)),o=[ao(i,this.simUI.player,s),ao(i,this.simUI.player,Rr),ao(i,this.simUI.player,n)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildPhysicalBuffPickers(){const e=this.simUI.individualConfig.epStats.includes(c.StatAgility),t=this.simUI.individualConfig.epStats.includes(c.StatStrength);if(!e&&!t)return;const i=document.createElement("fragment");i.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Physical</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-physical"></div>\n\t\t\t</div>\n\t\t';const s=this.rootElem.appendChild(i.children[0]),n=this.rootElem.querySelector(".consumes-physical"),o=td(Wg(ed,this.simUI),"Attack Power"),l=rd(Wg(ld,this.simUI),"Agility"),r=pd(Wg(ud,this.simUI),"Strength"),d=[ao(n,this.simUI.player,o),ao(n,this.simUI.player,l),ao(n,this.simUI.player,r)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(s,d))),this.updateRow(s,d)}buildDefensiveBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Defensive</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-defensive"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-defensive"),s=Yr(Wg(Zr,this.simUI),"Health"),n=Gr(Wg($r,this.simUI),"Armor"),o=[ao(i,this.simUI.player,s),ao(i,this.simUI.player,n)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildSpellPowerBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Spells</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-spells"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-spells"),s=jd(Wg(zd,this.simUI),"Spell Damage"),n=Jd(Wg(Kd,this.simUI),"Fire Damage"),o=Yd(Wg(Zd,this.simUI),"Frost Damage"),l=Xd(Wg(Qd,this.simUI),"Shadow Damage"),r=tc(Wg(ec,this.simUI),"Mana Regen"),d=[ao(i,this.simUI.player,s),ao(i,this.simUI.player,n),ao(i,this.simUI.player,o),ao(i,this.simUI.player,l),ao(i,this.simUI.player,r)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,d))),this.updateRow(t,d)}buildMiscConsumesPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Miscellaneous</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-misc"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-misc"),s=yd(Wg(Ed,this.simUI),"Zanza Buffs"),n=Wg(Pd,this.simUI),o=[ao(i,this.simUI.player,s),...n.map((e=>e.picker&&new e.picker(i,this.simUI.player,e.config,this.simUI)))];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildEngPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Engineering</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-engi"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-engi"),s=cr(Wg(dr,this.simUI),"Explosives"),n=[ao(i,this.simUI.player,hr),ao(i,this.simUI.player,s)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildEnchPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Enchanting</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-ench">\n\t\t\t\t\t\t</div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-ench"),s=ar(Wg(sr,this.simUI),"Enchanted Sigils"),n=[ao(i,this.simUI.player,s)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildPetPicker(){if(!this.simUI.individualConfig.petConsumeInputs?.length)return;const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Pet</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-pet"></div>\n\t\t\t</div>\n\t\t',this.rootElem.appendChild(e.children[0]);const t=this.rootElem.querySelector(".consumes-pet");this.simUI.individualConfig.petConsumeInputs.map((e=>ao(t,this.simUI.player,e)))}updateRow(e,t){t.find((e=>e?.showWhen()))?e.classList.remove("hide"):e.classList.add("hide")}}class Og extends g{constructor(e,t,i,s){super(e,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=i,this.slot=s,this.iconAnchor=document.createElement("a"),this.iconAnchor.classList.add("icon-picker-button"),this.iconAnchor.target="_blank",this.rootElem.prepend(this.iconAnchor);const a=new Mp(t.rootElem,t,this.player);i.sim.waitForInit().then((()=>{this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),a.openTab(this.slot,Dp.Items,this.createGearData())}))})),i.itemSwapChangeEmitter.on((()=>{this.update(i.getItemSwapGear().getEquippedItem(s))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${Rp(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",e?(this.iconAnchor.classList.add("active"),e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor)):this.iconAnchor.classList.remove("active")}createGearData(){return{equipItem:(e,t)=>{this.player.equipItemSwapitem(e,this.slot,t)},getEquippedItem:()=>this.player.getItemSwapItem(this.slot),changeEvent:this.player.itemSwapChangeEmitter}}}class Hg extends g{constructor(e,t,i,s){super(e,"item-swap-picker-root"),this.itemSlots=s.itemSlots,this.enableItemSwapPicker=new mt(this.rootElem,i,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.getEnableItemSwap(),setValue(e,t,i){t.setEnableItemSwap(e,i)},changedEvent:e=>e.itemSwapChangeEmitter});const n=document.createElement("div");let o;n.classList.add("input-root","input-inline"),this.rootElem.appendChild(n),s.note&&(o=this.rootElem.appendChild(f("p",{className:"form-text"},s.note)));const l=()=>{i.getEnableItemSwap()?(n.classList.remove("hide"),o?.classList.remove("hide")):(n.classList.add("hide"),o?.classList.add("hide"))};i.itemSwapChangeEmitter.on(l),l();const r=document.createElement("label");r.classList.add("form-label"),r.textContent="Item Swap",n.appendChild(r);const d=w.newGroupContainer();d.classList.add("icon-group"),n.appendChild(d);const c=f("a",{href:"javascript:void(0)",className:"gear-swap-icon",attributes:{role:"button"}},f("i",{className:"fas fa-arrows-rotate me-1"}));c.addEventListener("click",(e=>this.swapWithGear(a.nextEventID(),i))),d.appendChild(c),qa(c,{content:"Swap with equipped items"}),this.itemSlots.forEach((e=>{new Og(d,t,i,e)}))}swapWithGear(e,t){let i=t.getGear(),s=t.getItemSwapGear();this.itemSlots.forEach((e=>{const a=t.getGear().getEquippedItem(e),n=t.getItemSwapGear().getEquippedItem(e);i=i.withEquippedItem(e,n,t.canDualWield2H()),s=s.withEquippedItem(e,a,t.canDualWield2H())})),a.freezeAllAndDo((()=>{t.setGear(e,i),t.setItemSwapGear(e,s)}))}}class qg extends g{constructor(e,t){if(super(e,"preset-builds-picker-root"),this.simUI=t,this.builds=this.simUI.individualConfig.presets.builds??[],!this.builds.length)return void this.rootElem.classList.add("hide");const i=I(),s=I();this.rootElem.appendChild(f(x,null,f("label",{className:"form-label"},"Preset Builds",f("a",{href:"javascript:void(0)",className:"ms-1",ref:s},f("i",{className:"fa-regular fa-circle-question"}))),f("div",{className:"presets-container",ref:i}))),qa(s.value,{content:"Preset builds apply an optimal combination of gear, talents, and rotation."}),this.simUI.sim.waitForInit().then((()=>{this.builds.forEach((e=>{const t=I();i.value.appendChild(f("button",{className:"saved-data-set-chip badge rounded-pill",ref:t},f("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>this.applyBuild(e)},e.name)));const s=()=>{this.isBuildActive(e)?t.value.classList.add("active"):t.value.classList.remove("active")};s(),a.onAny([this.simUI.player.gearChangeEmitter,this.simUI.player.talentsChangeEmitter,this.simUI.player.rotationChangeEmitter]).on(s)}))}))}applyBuild(e){const t=a.nextEventID();a.freezeAllAndDo((()=>{this.simUI.player.setGear(t,this.simUI.sim.db.lookupEquipmentSpec(e.gear.gear)),this.simUI.player.setTalentsString(t,e.talents.data.talentsString),this.simUI.player.setAplRotation(t,e.rotation.rotation.rotation)}))}isBuildActive(e){return Nt.equals(e.gear.gear,this.simUI.player.getGear().asSpec())&&e.talents.data.talentsString==this.simUI.player.getTalentsString()&&T.equals(e.rotation.rotation.rotation,this.simUI.player.getResolvedAplRotation())}}class Bg extends Fp{constructor(e,t){super(e,t,{identifier:"settings-tab",title:"Settings"}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.simUI.sim.waitForInit().then((()=>{this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.buildIsbSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildWorldBuffsSettings(),this.buildDebuffsSettings(),this.buildSavedDataPickers())}))}buildEncounterSettings(){const e=new bp(this.column1,"encounter-settings",{header:{title:"Encounter"}});new Tg(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=new bp(this.column1,"player-settings",{header:{title:"Player"}}),t=w.newGroupContainer();t.classList.add("player-icon-group","icon-group"),e.bodyElement.appendChild(t),this.configureIconSection(t,this.simUI.individualConfig.playerIconInputs.map((e=>ao(t,this.simUI.player,e))),!0),new qg(e.bodyElement,this.simUI),new kc(e.bodyElement,this.simUI.player,{id:"player-level",label:"Level",values:ba.map((e=>({name:`Level ${e}`,value:e}))),changedEvent:e=>e.levelChangeEmitter,getValue:e=>e.getLevel(),setValue:(e,t,i)=>t.setLevel(e,i)});const i=A[this.simUI.player.spec];new kc(e.bodyElement,this.simUI.player,{id:"player-race",label:"Race",values:i.map((e=>({name:xa.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,i)=>t.setRace(e,i)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(e.bodyElement,this.simUI.individualConfig.playerInputs);const s=w.newGroupContainer();e.bodyElement.appendChild(s);const a=d(F);new kc(s,this.simUI.player,{id:"player-profession-1",label:"Profession 1",values:a.map((e=>({name:Jt.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,i)=>t.setProfession1(e,i)}),new kc(s,this.simUI.player,{id:"player-profession-2",label:"Profession 2",values:a.map((e=>({name:Jt.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,i)=>t.setProfession2(e,i)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new bp(e,"consumes-settings",{header:{title:"Consumables"}});new Fg(t.bodyElement,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses||!e.extraCssClasses?.includes("within-raid-sim-hide"))),t=this.simUI.individualConfig.itemSwapConfig;if(e.length||t?.itemSlots.length){const i=new bp(this.column2,"other-settings",{header:{title:"Other"}});e.length&&(this.configureInputSection(i.bodyElement,this.simUI.individualConfig.otherInputs),i.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t?.itemSlots.length&&new Hg(i.bodyElement,this.simUI,this.simUI.player,t)}}buildIsbSettings(){if(!this.simUI.isWithinRaidSim){const e=new bp(this.column1,"other-settings",{header:{title:"Improved Shadow Bolt"}});this.configureInputSection(e.bodyElement,_c),a.onAny([this.simUI.player.talentsChangeEmitter,this.simUI.player.getRaid().debuffsChangeEmitter]).on((()=>{const t=this.simUI.player?.getTalents().improvedShadowBolt>0,i=this.simUI.player?.getTalents().improvedShadowBolt>0;1==this.simUI.player.getRaid()?.getDebuffs()?.improvedShadowBolt||t||i?e.rootElem.classList.remove("hide"):e.rootElem.classList.add("hide")}))}}buildBuffsSettings(){const e=Wg(Ul,this.simUI),t=Wg(Wl,this.simUI),i=new bp(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:"Buffs provided by other party/raid members. Note only the highest available buff rank will be applied, if possible, based on level selected"}});this.configureIconSection(i.bodyElement,e.map((e=>e.picker&&new e.picker(i.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new vo(i.bodyElement,this.simUI.player,{inputs:t.map((e=>e.config)),label:"Misc Buffs"},this.simUI)}buildWorldBuffsSettings(){const e=new bp(this.column3,"world-buffs-settings",{header:{title:"World Buffs",tooltip:"World Buffs obtained from various sources across Azeroth."}}),t=Wg(Ol,this.simUI);new Fn(e.bodyElement,this.simUI.player,Qo(t));const i=Wg(Fl,this.simUI);this.configureIconSection(e.bodyElement,i.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))))}buildDebuffsSettings(){const e=Wg(Hl,this.simUI),t=Wg(ql,this.simUI);if(!e.length&&!t.length)return;const i=new bp(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:"Debuffs applied by other raid members."}});this.configureIconSection(i.bodyElement,e.map((e=>e.picker&&new e.picker(i.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new vo(i.bodyElement,this.simUI.player,{inputs:t.map((e=>e.config)),label:"Misc Debuffs"},this.simUI),this.simUI.player.getRaid()?.debuffsChangeEmitter.emit(a.nextEventID())}buildSavedDataPickers(){const e=new Gp(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>Sa.create({encounter:e.toProto()}),setData:(e,t,i)=>t.fromProto(e,i.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>Sa.equals(e,t),toJson:e=>Sa.toJson(e),fromJson:e=>Sa.fromJson(e)}),t=new Gp(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:e=>{const t=e.player;return Ea.create({raidBuffs:e.sim.raid.getBuffs(),partyBuffs:t.getParty()?.getBuffs()||s.create(),playerBuffs:t.getBuffs(),debuffs:e.sim.raid.getDebuffs(),consumes:t.getConsumes(),race:t.getRace(),level:t.getLevel(),professions:t.getProfessions(),enableItemSwap:t.getEnableItemSwap(),itemSwap:t.getItemSwapGear().toProto(),reactionTimeMs:t.getReactionTime(),channelClipDelayMs:t.getChannelClipDelay(),inFrontOfTarget:t.getInFrontOfTarget(),distanceFromTarget:t.getDistanceFromTarget(),healingModel:t.getHealingModel()})},setData:(e,t,i)=>{a.freezeAllAndDo((()=>{t.player.setLevel(e,i.level),t.sim.raid.setBuffs(e,i.raidBuffs||ue.create()),t.sim.raid.setDebuffs(e,i.debuffs||pe.create());const a=t.player.getParty();a&&a.setBuffs(e,i.partyBuffs||s.create()),t.player.setBuffs(e,i.playerBuffs||P.create()),t.player.setConsumes(e,i.consumes||k.create()),t.player.setRace(e,i.race),t.player.setProfessions(e,i.professions),t.player.setEnableItemSwap(e,i.enableItemSwap),t.player.setItemSwapGear(e,t.sim.db.lookupItemSwap(i.itemSwap||ya.create())),t.player.setReactionTime(e,i.reactionTimeMs),t.player.setChannelClipDelay(e,i.channelClipDelayMs),t.player.setInFrontOfTarget(e,i.inFrontOfTarget),t.player.setDistanceFromTarget(e,i.distanceFromTarget),t.player.setHealingModel(e,i.healingModel||N.create())}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapChangeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>Ea.equals(e,t),toJson:e=>Ea.toJson(e),fromJson:e=>Ea.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData()}))}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new Fc(e,this.simUI.player,t):"boolean"==t.type?new mt(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new kc(e,this.simUI.player,t)}))}configureIconSection(e,t,i){0==t.length?e.classList.add("hide"):i&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}class zg extends Fp{constructor(e,t){super(e,t,{identifier:"talents-tab",title:"Talents"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildTalentsPicker(this.leftPanel),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new an(e,this.simUI.player,{klass:this.simUI.player.getClass(),trees:wn[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,i)=>{t.setTalentsString(e,i)},pointsPerRow:5})}buildSavedTalentsPicker(){const e=new Gp(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>ui.create({talentsString:e.getTalentsString()}),setData:(e,t,i)=>{a.freezeAllAndDo((()=>{t.setTalentsString(e,i.talentsString)}))},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>ui.equals(e,t),toJson:e=>ui.toJson(e),fromJson:e=>ui.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,enableWhen:t.enableWhen})}))}))}}const jg=class e extends tp{constructor(e,t,i,s){super(e.rootElem,"ep-weights-menu",function(e){const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()&&e.sim.getShowExperimental()?{size:"xl",...t}:t}(e)),this.showAllStats=!1,this.simUI=e,this.statsType="ep",this.epStats=t,this.epPseudoStats=i,this.epReferenceStat=s,this.header?.insertAdjacentHTML("afterbegin",'<h5 class="modal-title">Calculate Stat Weights</h5>'),this.body.innerHTML='\n\t\t\t<div class="ep-weights-options row">\n\t\t\t\t<div class="col col-sm-3">\n\t\t\t\t\t<select class="ep-type-select form-select">\n\t\t\t\t\t\t<option value="ep">EP</option>\n\t\t\t\t\t\t<option value="weight">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="show-all-stats-container col col-sm-3"></div>\n\t\t\t</div>\n\t\t\t<div class="ep-reference-options row experimental">\n\t\t\t\t<div class="col col-sm-4 damage-metrics">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select damage-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 healing-metrics">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select healing-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 threat-metrics">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select threat-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The \'Current EP\' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href=\'javascript:void(0)\' class="fa fa-copy"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class="results-ep-table-container modal-scroll-table">\n\t\t\t\t<div class="results-pending-overlay"></div>\n\t\t\t\t<table class="results-ep-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style="text-align: center">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-arrows-rotate"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="ep-ratios">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;">\n\t\t\t\t\t\t\t\t<button class="btn btn-primary compute-ep">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\t\t\t\t\t\t<span class="not-tiny">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button class="btn btn-primary calc-weights">\n\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t',this.container=this.rootElem.querySelector(".results-ep-table-container"),this.table=this.rootElem.querySelector(".results-ep-table"),this.tableBody=this.rootElem.querySelector(".results-ep-table tbody");const n=this.rootElem.querySelector(".results-pending-overlay");this.resultsViewer=new Wp(n);const o=()=>{"ep"==this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},l=this.rootElem.getElementsByClassName("ep-type-select")[0];l.addEventListener("input",(e=>{this.statsType=l.value,o()})),l.value=this.statsType,o();const r=e=>void 0!==e?m(e,this.simUI.player.getClass()):"??",d=e=>{for(const t of this.epStats)if(r(t)==e)return t},c=()=>{this.simUI.player.epRefStatChangeEmitter.emit(a.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()};this.rootElem.querySelectorAll(".ref-stat-select").forEach(((e,t)=>{this.epStats.forEach((t=>{e.options[e.options.length]=new Option(r(t))})),e.classList.contains("damage-metrics")?(e.addEventListener("input",(t=>{this.simUI.dpsRefStat=d(e.value),c()})),e.value=r(this.getDpsEpRefStat())):e.classList.contains("healing-metrics")?(e.addEventListener("input",(t=>{this.simUI.healRefStat=d(e.value),c()})),e.value=r(this.getHealEpRefStat())):e.classList.contains("threat-metrics")&&(e.addEventListener("input",(t=>{this.simUI.tankRefStat=d(e.value),c()})),e.value=r(this.getTankEpRefStat()))}));const h=this.rootElem.getElementsByClassName("calc-weights")[0];h.addEventListener("click",(async e=>{const t=h.innerHTML;h.classList.add("disabled"),h.style.width=`${h.getBoundingClientRect().width.toFixed(3)}px`,h.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running',this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const i=this.simUI.sim.getIterations(),s=await this.simUI.player.computeStatWeights(a.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.container.classList.remove("pending"),this.resultsViewer.hideAll(),h.innerHTML=t,h.classList.remove("disabled"),this.simUI.prevEpIterations=i,this.simUI.prevEpSimResult=this.calculateEp(s),this.updateTable()}));const u=Array.from(this.rootElem.getElementsByClassName("col-action")),p=(e,t,i,s,n)=>{const o=e.previousElementSibling;qa(o,{content:()=>{if(!n)return t;const e=r(n());return t+` Normalized by ${e}.`}}),qa(e,{content:i}),e.addEventListener("click",(e=>{this.simUI.player.setEpWeights(a.nextEventID(),tn.fromProto(s())),this.updateTable()}))};p(u[0],"Per-point increase in DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.weights)),p(u[1],"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.epValues),(()=>this.getDpsEpRefStat())),p(u[2],"Per-point increase in HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.weights)),p(u[3],"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.epValues),(()=>this.getHealEpRefStat())),p(u[4],"Per-point increase in TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.weights)),p(u[5],"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.epValues),(()=>this.getDpsEpRefStat())),p(u[6],"Per-point increase in DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.weights)),p(u[7],"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.epValues),(()=>this.getTankEpRefStat())),p(u[8],"Per-point decrease in TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.weights)),p(u[9],"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.epValues),(()=>this.getTankEpRefStat())),p(u[10],"Per-point decrease in p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.weights)),p(u[11],"EP (Equivalency Points) for p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.epValues),(()=>this.getTankEpRefStat())),p(u[12],"Current EP Weights. Used to sort the gear selector menus.","Restore Default EP",(()=>this.simUI.individualConfig.defaults.epWeights.toProto()));const g=this.rootElem.getElementsByClassName("show-all-stats-container")[0];new mt(g,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new a,getValue:()=>this.showAllStats,setValue:(e,t,i)=>{this.showAllStats=i,this.updateTable()}}),this.updateTable();const f=(e,t)=>{new Fc(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:e=>this.simUI.player.getEpRatios()[t],setValue:(e,i,s)=>{const a=i.getEpRatios();a[t]=s,i.setEpRatios(e,a)}})};this.body.querySelectorAll(".type-ratio.type-ep").forEach(f),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));this.body.querySelectorAll(".type-ratio.type-weight").forEach(f);const I=this.rootElem.getElementsByClassName("compute-ep")[0];qa(I,{content:"Compute Weighted EP"}),I.addEventListener("click",(e=>{const t=this.getPrevSimResult(),i=this.simUI.player.getEpRatios();if("ep"==this.statsType){const e=tn.fromProto(t.dps.epValues).scale(i[0]),s=tn.fromProto(t.hps.epValues).scale(i[1]),n=tn.fromProto(t.tps.epValues).scale(i[2]),o=tn.fromProto(t.dtps.epValues).scale(i[3]),l=tn.fromProto(t.tmi.epValues).scale(i[4]),r=tn.fromProto(t.pDeath.epValues).scale(i[5]),d=e.add(s).add(n).add(o).add(l).add(r);this.simUI.player.setEpWeights(a.nextEventID(),d)}else{const e=tn.fromProto(t.dps.weights).scale(i[0]),s=tn.fromProto(t.hps.weights).scale(i[1]),n=tn.fromProto(t.tps.weights).scale(i[2]),o=tn.fromProto(t.dtps.weights).scale(i[3]),l=tn.fromProto(t.tmi.weights).scale(i[4]),r=tn.fromProto(t.pDeath.weights).scale(i[5]),d=e.add(s).add(n).add(o).add(l).add(r);this.simUI.player.setEpWeights(a.nextEventID(),d)}this.updateTable()}))}setSimProgress(e){this.resultsViewer.setContent(`\n\t\t\t<div class="results-sim">\n\t\t\t\t<div class=""> ${e.completedSims} / ${e.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class="">\n\t\t\t\t\t${e.completedIterations} / ${e.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}updateTable(){this.tableBody.innerHTML="",e.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);this.tableBody.appendChild(t)}))}makeTableRow(e){const t=document.createElement("tr"),i=this.simUI.prevEpSimResult,s=this.simUI.player.getEpRatios(),a=function(e,t,i){return i?(i.dps?.epValues?t[0]*e.getProtoValue(i.dps.epValues):0)+(i.hps?.epValues?t[1]*e.getProtoValue(i.hps.epValues):0)+(i.tps?.epValues?t[2]*e.getProtoValue(i.tps.epValues):0)+(i.dtps?.epValues?t[3]*e.getProtoValue(i.dtps.epValues):0)+(i.tmi?.epValues?t[4]*e.getProtoValue(i.tmi.epValues):0)+(i.pDeath?.epValues?t[5]*e.getProtoValue(i.pDeath.epValues):0):0}(e,s,i);t.innerHTML=`\n\t\t\t<td>${e.getName(this.simUI.player.getClass())}</td>\n\t\t\t${this.makeTableRowCells(e,i?.dps,"damage-metrics",a,s[0])}\n\t\t\t${this.makeTableRowCells(e,i?.hps,"healing-metrics",a,s[1])}\n\t\t\t${this.makeTableRowCells(e,i?.tps,"threat-metrics",a,s[2])}\n\t\t\t${this.makeTableRowCells(e,i?.dtps,"threat-metrics",a,s[3])}\n\t\t\t${this.makeTableRowCells(e,i?.tmi,"threat-metrics experimental",a,s[4])}\n\t\t\t${this.makeTableRowCells(e,i?.pDeath,"threat-metrics experimental",a,s[5])}\n\t\t\t<td class="current-ep"></td>\n\t\t`;const n=t.querySelector(".current-ep");return new Fc(n,this.simUI.player,{id:`ep-weight-stat-${e}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:t=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,i,s)=>{const a=i.getEpWeights().withUnitStat(e,s);i.setEpWeights(t,a)}}),t}makeTableRowCells(e,t,i,s,a){let n,o;if(t){const i=e.getProtoValue(t.weights),s=e.getProtoValue(t.weightsStdev);n=this.makeTableCellContents(i,s);const a=e.getProtoValue(t.epValues),l=e.getProtoValue(t.epValuesStdev);o=this.makeTableCellContents(a,l)}else n='<span class="results-avg notapplicable">N/A</span>',o=n;const l=document.createElement("template");if(l.innerHTML=`\n\t\t\t<td class="stdev-cell ${i} type-weight">\n\t\t\t\t${n}\n\t\t\t</td>\n\t\t\t<td class="stdev-cell ${i} type-ep">\n\t\t\t\t${o}\n\t\t\t</td>\n\t\t`,!t)return l.innerHTML;if(0==a){return l.content.querySelectorAll(".stdev-cell").forEach((e=>e.classList.add("unused-ep"))),l.innerHTML}const r=s-this.simUI.player.getEpWeights().getUnitStat(e),d=l.content.querySelector(".type-ep .results-avg");return"0.00"==r.toFixed(2)||(r>0?d.classList.add("positive"):r<0&&d.classList.add("negative")),l.innerHTML}makeTableCellContents(e,t){const i=this.simUI.prevEpIterations||1;return`\n\t\t\t<span class="results-avg">${e.toFixed(2)}</span>\n\t\t\t<span class="results-stdev">\n\t\t\t\t(<i class="fas fa-plus-minus fa-xs"></i>${Pa(t,i).toFixed(2)})\n\t\t\t</span>\n\t\t`}calculateEp(t){const i=ye.clone(t),s=(t,i)=>{const s=en.fromStat(t),a=s.getProtoValue(i.weights),n=s.getProtoValue(i.weightsStdev);e.epUnitStats.forEach((e=>{const t=e.getProtoValue(i.weights);e.setProtoValue(i.epValues,0==a?0:t/a);const s=e.getProtoValue(i.weightsStdev);e.setProtoValue(i.epValuesStdev,0==n?0:s/n)}))};return void 0!==this.simUI.dpsRefStat&&(s(this.simUI.dpsRefStat,i.dps),s(this.simUI.dpsRefStat,i.tps)),void 0!==this.simUI.healRefStat&&s(this.simUI.healRefStat,i.hps),void 0!==this.simUI.tankRefStat&&(s(this.simUI.tankRefStat,i.dtps),s(this.simUI.tankRefStat,i.tmi),s(this.simUI.tankRefStat,i.pDeath)),i}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:c.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||ye.create({dps:{weights:(new tn).toProto(),weightsStdev:(new tn).toProto(),epValues:(new tn).toProto(),epValuesStdev:(new tn).toProto()},hps:{weights:(new tn).toProto(),weightsStdev:(new tn).toProto(),epValues:(new tn).toProto(),epValuesStdev:(new tn).toProto()},tps:{weights:(new tn).toProto(),weightsStdev:(new tn).toProto(),epValues:(new tn).toProto(),epValuesStdev:(new tn).toProto()},dtps:{weights:(new tn).toProto(),weightsStdev:(new tn).toProto(),epValues:(new tn).toProto(),epValuesStdev:(new tn).toProto()},tmi:{weights:(new tn).toProto(),weightsStdev:(new tn).toProto(),epValues:(new tn).toProto(),epValuesStdev:(new tn).toProto()},pDeath:{weights:(new tn).toProto(),weightsStdev:(new tn).toProto(),epValues:(new tn).toProto(),epValuesStdev:(new tn).toProto()}})}};jg.epUnitStats=en.getAll().filter((e=>!!e.isStat()||[h.PseudoStatMainHandDps,h.PseudoStatOffHandDps,h.PseudoStatRangedDps].includes(e.getPseudoStat())));let $g=jg;class Gg extends tp{constructor(e,t){super(e,"settings-menu",{title:"Options",footer:!0}),this.simUI=t;const i=I(),s=I(),n=I(),o=I(),l=I(),r=I(),d=I(),c=f("div",null,f("div",{className:"picker-group"},f("div",{className:"fixed-rng-seed-container"},f("div",{ref:s,className:"fixed-rng-seed"}),f("div",{className:"form-text"},f("span",null,"Last used RNG seed:"),"",f("span",{ref:n,className:"last-used-rng-seed"},"0"))),f("div",{ref:o,className:"language-picker within-raid-sim-hide"})),f("div",{ref:l,className:"show-threat-metrics-picker w-50 pe-2"}),f("div",{ref:r,className:"show-experimental-picker w-50 pe-2"}),f("div",{ref:d,className:"show-quick-swap-picker w-50 pe-2"}));this.body.replaceChildren(c);const h=f("button",{ref:i,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&this.footer.replaceChildren(h),i.value&&(qa(i.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),i.value.addEventListener("click",(()=>{this.simUI.applyDefaults(a.nextEventID()),new ip({variant:"success",body:"Restored to default settings."})}))),s.value&&new Fc(s.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,i)=>{t.setFixedRngSeed(e,i)}}),n.value&&(n.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>{n.value&&(n.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))}))),o.value){const e=Object.keys(ka),t=e.indexOf("en");new kc(o.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map(((e,t)=>({name:ka[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:i=>{const s=e.indexOf(i.getLanguage());return-1==s?t:s},setValue:(t,i,s)=>{i.setLanguage(t,e[s]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)))}l.value&&new mt(l.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,i)=>{t.setShowThreatMetrics(e,i)}}),r.value&&new mt(r.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,i)=>{t.setShowExperimental(e,i)}})}}class Kg extends g{static buildDiscordLink(){const e=f("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},f("i",{className:"fab fa-discord fa-lg"}));return qa(e),e}static buildGitHubLink(){const e=f("a",{href:"https://github.com/wowsims/sod",target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},f("i",{className:"fab fa-github fa-lg"}));return qa(e),e}static buildPatreonLink(){const e=f("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},f("i",{className:"fab fa-patreon fa-lg"})," Patreon");return qa(e),e}}class Jg extends g{constructor(e,t){super(e,"sim-header"),this.simUI=t,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=f("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(e,t){const i=0==this.simTabsContainer.children.length,s=f("li",{className:`${t} nav-item`,attributes:{role:"presentation"}},f("a",{className:`nav-link ${i&&"active"}`,dataset:{bsToggle:"tab",bsTarget:`#${t}`},attributes:{role:"tab","aria-selected":i},type:"button"},e));s.setAttribute("aria-controls",t),this.simTabsContainer.appendChild(s)}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,i){this.addImportExportLink(".import-dropdown",e,t,i)}addExportLink(e,t,i){this.addImportExportLink(".export-dropdown",e,t,i)}addImportExportLink(e,t,i,s){const a=this.rootElem.querySelector(e).querySelector(".dropdown-menu"),n=I();a.appendChild(f("li",null,f("a",{ref:n,href:"javascript:void(0)",className:"dropdown-item",attributes:{role:"button"}},t))),n.value?.addEventListener("click",(()=>i.open()))}addToolbarLink(e){const t=I();return e.parent.appendChild(f("div",{className:"sim-toolbar-item"},f("a",{ref:t,href:e.href?e.href:"javascript:void(0)",className:e.classes||"",target:e.href?"_blank":"_self"},e.icon&&f("i",{className:e.icon}),e.text?` ${e.text} `:""))),t.value&&(e.onclick&&t.value.addEventListener("click",e.onclick),e.tooltip&&qa(t.value,{content:e.tooltip,placement:"bottom"})),t.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(e){const t=f("li",null);t.innerHTML=e,this.knownIssuesContent.appendChild(t),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:"https://github.com/wowsims/sod/issues/new/choose",parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e="https://github.com/wowsims/sod/releases",t="fas fa-gauge-high fa-lg",i=this.simToolbar;Ca()?fetch("/version").then((s=>{s.json().then((s=>{2==s.outdated&&this.addToolbarLink({href:e,parent:i,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})):this.addToolbarLink({href:e,parent:i,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new Gg(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const e=document.createElement("div");e.classList.add("sim-toolbar-socials"),this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(e){e.appendChild(f("div",{className:"sim-toolbar-item"},Kg.buildDiscordLink()))}addGitHubLink(e){e.appendChild(f("div",{className:"sim-toolbar-item"},Kg.buildGitHubLink()))}addPatreonLink(e){e.appendChild(f("div",{className:"sim-toolbar-item"},Kg.buildPatreonLink()))}customRootElement(){return f("header",{className:"sim-header"},f("div",{className:"sim-header-container"},f("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),f("div",{className:"import-export within-raid-sim-hide"},f("div",{className:"dropdown sim-dropdown-menu import-dropdown"},f("a",{href:"javascript:void(0)",className:"import-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},f("i",{className:"fa fa-download"})," Import "),f("ul",{className:"dropdown-menu"})),f("div",{className:"dropdown sim-dropdown-menu export-dropdown"},f("a",{href:"javascript:void(0)",className:"export-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},f("i",{className:"fa fa-right-from-bracket"})," Export "),f("ul",{className:"dropdown-menu"}))),f("div",{className:"sim-toolbar"})))}}class Zg extends g{constructor(e,i,s={}){super(e,"sim-title-dropdown-root"),this.specLabels={[t.SpecBalanceDruid]:"Balance",[t.SpecFeralDruid]:"Feral DPS",[t.SpecFeralTankDruid]:"Feral Tank",[t.SpecRestorationDruid]:"Restoration",[t.SpecElementalShaman]:"Elemental",[t.SpecEnhancementShaman]:"Enhancement",[t.SpecRestorationShaman]:"Restoration",[t.SpecHunter]:"Hunter",[t.SpecMage]:"Mage",[t.SpecRogue]:"DPS",[t.SpecTankRogue]:"Tank",[t.SpecHolyPaladin]:"Holy",[t.SpecProtectionPaladin]:"Protection",[t.SpecRetributionPaladin]:"Retribution",[t.SpecHealingPriest]:"Healing",[t.SpecShadowPriest]:"Shadow",[t.SpecWarlock]:"DPS",[t.SpecTankWarlock]:"Tank",[t.SpecWarrior]:"DPS",[t.SpecProtectionWarrior]:"Protection"};const a=null===i?{type:"Raid"}:{type:"Spec",index:i},n=this.buildRootSimLink(a);s.noDropdown?this.rootElem.innerHTML=n.outerHTML:(this.rootElem.innerHTML=`\n      <div class="dropdown sim-link-dropdown">\n        ${n.outerHTML}\n        <ul class="dropdown-menu"></ul>\n      </div>\n    `,this.dropdownMenu=this.rootElem.getElementsByClassName("dropdown-menu")[0],this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest('a:not([href="javascript:void(0)"]')||(e.stopPropagation(),e.preventDefault())})))}buildDropdown(){La.forEach((e=>{const t=document.createElement("li"),i=Ja(e);1==i.length?(t.appendChild(this.buildClassLink(e)),this.dropdownMenu?.appendChild(t)):i.length>1&&(t.appendChild(this.buildClassDropdown(e)),this.dropdownMenu?.appendChild(t))}))}buildClassDropdown(e){const t=Ja(e),i=document.createElement("fragment"),s=document.createElement("ul");s.classList.add("dropdown-menu");const a=this.buildClassLink(e);return t.forEach((e=>{const t=document.createElement("li"),i=this.buildSpecLink(e);t.appendChild(i),s.appendChild(t)})),i.innerHTML=`\n\t\t\t<div class="dropend sim-link-dropdown">\n\t\t\t\t${a.outerHTML}\n\t\t\t\t${s.outerHTML}\n\t\t\t</div>\n    \t`,i.children[0]}buildRootSimLink(e){let t;if("Raid"==e.type)t=Va;else{const s=i[e.index];t=Ja(s).length>1?Mt[e.index]:_a[s]}return f("a",{href:"javascript:void(0)",className:yt("sim-link",this.getContextualKlass(e)),dataset:{bsToggle:"dropdown",bsTrigger:"click"}},f("div",{className:"sim-link-content"},f("img",{src:this.getSimIconPath(e),className:"sim-link-icon"}),f("div",{className:"d-flex flex-column"},f("span",{className:"sim-link-label text-white"},"WoWSims - Season of Discovery"),f("span",{className:"sim-link-title"},t),this.launchStatusLabel(e))))}buildRaidLink(){const e=this.getContextualKlass({type:"Raid"}),t=this.getSimIconPath({type:"Raid"}),i=Va,s=document.createElement("fragment");return s.innerHTML=`\n      <a href="${Ta}" class="sim-link ${e}">\n        <div class="sim-link-content">\n          <img src="${t}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${i}</span>\n            ${this.launchStatusLabel({type:"Raid"})}\n          </div>\n        </div>\n      </a>\n    `,s.children[0]}buildClassLink(e){const t=Ja(e),i=t.length>1,s=i?"javascript:void(0)":Na(t[0]);return f("a",{href:s,className:yt("sim-link",this.getContextualKlass({type:"Class",index:e})),dataset:i?{bsToggle:"dropdown"}:{}},f("div",{className:"sim-link-content"},f("img",{src:this.getSimIconPath({type:"Class",index:e}),className:"sim-link-icon"}),f("div",{className:"d-flex flex-column"},f("span",{className:"sim-link-title"},_a[e]),!i&&this.launchStatusLabel({type:"Spec",index:t[0]}))))}buildSpecLink(e){const t=Na(e);return f("a",{href:t,className:yt("sim-link",this.getContextualKlass({type:"Spec",index:e}))},f("div",{className:"sim-link-content"},f("img",{src:this.getSimIconPath({type:"Spec",index:e}),className:"sim-link-icon"}),f("div",{className:"d-flex flex-column"},f("span",{className:"sim-link-label"},_a[i[e]]),f("span",{className:"sim-link-title"},this.specLabels[e]),this.launchStatusLabel({type:"Spec",index:e}))))}launchStatusLabel(e){const t="Raid"==e.type?Ga.status:Ka[e.index].status,i="Raid"==e.type?Ga.phase:Ka[e.index].phase;return f("span",{className:"launch-status-label text-brand"},t===$a.Unlaunched?f(x,null,"Not Yet Supported"):f(x,null,"Phase ",i,t!=$a.Launched&&f(x,null," - ",$a[t])))}getSimIconPath(e){let t;return t="Raid"==e.type?Ua:"Class"==e.type?Aa[e.index]:Ra[e.index],t}getContextualKlass(e){return"Raid"==e.type?"text-white":"Class"==e.type?Da(e.index):Ma(e.index)}}const Yg=[];class Qg extends g{constructor(e,t,i){super(e,"sim-ui"),this.sim=t,this.cssClass=i.cssClass,this.cssScheme=i.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const s=f(x,null,f("div",{className:"sim-root"},f("div",{className:"sim-bg"}),i.noticeText?f("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},i.noticeText):null,f("div",{className:"sim-container"},f("aside",{className:"sim-sidebar"},f("div",{className:"sim-title"}),f("div",{className:"sim-sidebar-content"},f("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),f("div",{className:"sim-sidebar-results within-raid-sim-hide"}),f("div",{className:"sim-sidebar-stats"}),f("div",{className:"sim-sidebar-socials"}))),f("div",{className:"sim-content container-fluid"}))),f("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(s),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new Jg(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=a.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const n=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};n(),this.sim.showDamageMetricsChangeEmitter.on(n);const o=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};o(),this.sim.showThreatMetricsChangeEmitter.on(o);const l=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};l(),this.sim.showHealingMetricsChangeEmitter.on(l);const r=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};r(),this.sim.showDamageMetricsChangeEmitter.on(r),this.sim.showHealingMetricsChangeEmitter.on(r),this.sim.showThreatMetricsChangeEmitter.on(r);const d=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};d(),this.sim.showExperimentalChangeEmitter.on(d),this.addKnownIssues(i);const c=this.rootElem.querySelector(".sim-title");new Zg(c,i.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.iterationsPicker=new Fc(this.simActionsContainer,this.sim,{id:"simui-iterations",label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,i)=>{t.setIterations(e,i)}}).rootElem;const h=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new Wp(h);const m=this.rootElem.querySelector(".sim-sidebar-socials");m.appendChild(Kg.buildDiscordLink()),m.appendChild(Kg.buildGitHubLink()),m.appendChild(Kg.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addAction(e,t,i){const s=document.createElement("button");s.classList.add("btn","btn-primary","w-100",t),s.textContent=e,s.addEventListener("click",i),this.simActionsContainer.appendChild(s)}addTab(e,t,i){const s=t.replace(/\s+/g,"-")+"-tab",a=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,s);const n=document.createElement("fragment");n.innerHTML=`\n\t\t\t<div\n\t\t\t\tid="${s}"\n\t\t\t\tclass="tab-pane fade ${a?"active show":""}"\n\t\t\t>${i}</div>\n\t\t`,this.simTabContentsContainer.appendChild(n.children[0])}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";t=e.simStatus.status==$a.Unlaunched?"This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.":e.simStatus.status==$a.Alpha?"This sim is in ALPHA status. New runes and items may not yet be functional and further testing is needed.":"This sim is in BETA status. New runes and items should be mostly functional.",t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues&&e.knownIssues.length&&e.knownIssues.forEach((e=>this.simHeader.addKnownIssue(e))),Yg.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.runRaidSim(a.nextEventID(),e)}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(a.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof Vn))return void alert(e);const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await E.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),i=this.toLink(),s=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/sod+"+e).then((a=>{a.json().then((a=>{if(a.total_count>0)window.open(a.items[0].html_url,"_blank");else{const a=`${"https://github.com/wowsims/sod/issues/new?assignees=&labels=&title=Crash%20Report%20"}${e}&body=`,n=2048-a.length;let o=encodeURIComponent(`Link:\n${i}\n\nRNG Seed: ${s}\n\n${t}`);i.includes("/raid/")&&(o=encodeURIComponent(`${t}\nRNG Seed: ${s}\nLink:\n${i}`));let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new Xg(this.rootElem,i)),window.open(a+o,"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let i=0,s=e.length;i<s;i++){t=(t<<5)-t+e.charCodeAt(i),t|=0}return t}}class Xg extends tp{constructor(e,t){super(e,"crash",{title:"Extra Crash Information"}),this.body.innerHTML='\n\t\t\t<div class="sim-crash-report">\n\t\t\t\t<h3 class="sim-crash-report-header">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class="sim-crash-report-text form-control"></textarea>\n\t\t\t</div>\n\t\t';const i=document.createTextNode(t);this.body.querySelector("textarea")?.appendChild(i)}}function ef(e,t){return function(e,t){Sn[e]=t}(e,t),t}const tf=[];class sf extends Qg{constructor(e,t,i){super(e,t.sim,{cssClass:i.cssClass,cssScheme:i.cssScheme,spec:t.spec,knownIssues:i.knownIssues,simStatus:Ka[t.spec]}),this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=i,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,(i.itemSwapConfig?.itemSlots||[]).length>0&&!tf.includes(t.spec)&&tf.push(t.spec),this.addWarning({updateOn:a.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${Jt.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:a.onAny([this.player.talentsChangeEmitter,this.player.levelChangeEmitter]),getContent:()=>{const e=Wa(this.player.getTalentsString());return 0==e?"":e<this.player.getLevel()-9?"Unspent talent points.":e>this.player.getLevel()-9?"More talent points spent than current level selected.":""}}),this.addWarning({updateOn:a.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(D.ItemSlotMainHand)?.item.handType!=re.HandTypeTwoHand||null==this.player.getEquippedItem(D.ItemSlotOffHand))&&this.player.getEquippedItem(D.ItemSlotOffHand)?.item.handType!=re.HandTypeTwoHand?"":"Dual wielding two-handed weapon(s) without Titan's Grip spec."}),(i.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{this.loadSettings(),Hs(this.player.spec)&&alert("*** WARNING - USE AT YOUR OWN RISK ***\n\nThe entire concept of a healing sim is EXPERIMENTAL. All results should be taken with an EXTREMELY large grain of salt.\n\nThis tool is currently more similar to a spreadsheet than a true sim. Options for specifying incoming damage profiles in order to have proper reactive rotations have not yet been added.")})),this.addSidebarComponents(),this.addGearTab(),this.bt=this.addBulkTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()}loadSettings(){const e=a.nextEventID();a.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const i=Pt.fromJsonString(t);this.fromProto(e,i)}catch(i){console.warn("Failed to parse saved settings: "+i)}try{const t=np.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(i){console.warn("Failed to parse link settings: "+i)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=Pt.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){var e,t,i,s;this.raidSimResultsManager=Fa(this),e=this,t=this.individualConfig.epStats,i=this.individualConfig.epPseudoStats,s=this.individualConfig.epReferenceStat,e.addAction("Stat Weights","ep-weights-action",(()=>{new $g(e,t,i||[],s).open()})),new Oc(this.rootElem.getElementsByClassName("sim-sidebar-stats")[0],this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats)}addGearTab(){new Kp(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new $p(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new Bg(this.simTabContentsContainer,this)}addTalentsTab(){new zg(this.simTabContentsContainer,this)}addRotationTab(){new Lg(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new Oa(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new op(this.rootElem,this),!0),this.simHeader.addImportLink("60U SoD",new lp(this.rootElem,this),!0),this.simHeader.addImportLink("Addon",new dp(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new mp(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new up(this.rootElem,this),!0),this.simHeader.addExportLink("60U SoD EP",new gp(this.rootElem,this),!1),this.simHeader.addExportLink("Pawn EP",new Ip(this.rootElem,this),!1)}applyDefaults(e){a.freezeAllAndDo((()=>{const t=oe(this.player.spec),i=Hs(this.player.spec);this.player.applySharedDefaults(e),this.player.setRace(e,this.individualConfig.defaults.race??A[this.player.spec][0]),this.player.setLevel(e,R[Ka[this.player.spec].phase]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setItemSwapGear(e,new L({})),this.player.setConsumes(e,this.individualConfig.defaults.consumes),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const s=this.player.getDefaultEpRatios(t,i);this.player.setEpRatios(e,s),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||F.Engineering),this.player.setProfession2(e,this.individualConfig.defaults.other?.profession2||F.ProfessionUnknown),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,i?9:0),this.sim.encounter.applyDefaults(e),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,i),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return Ha[this.player.spec]+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),i=Pt.create({player:this.player.toProto(!0,!1,e)});return t(Rn.Miscellaneous)&&Pt.mergePartial(i,{tanks:this.sim.raid.getTanks()}),t(Rn.Encounter)&&Pt.mergePartial(i,{encounter:this.sim.encounter.toProto()}),t(Rn.External)&&Pt.mergePartial(i,{partyBuffs:this.player.getParty()?.getBuffs()||s.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(Rn.UISettings)&&Pt.mergePartial(i,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),i}toLink(){return mp.createLink(this)}fromProto(e,t,i){const n=e=>!i||0==i.length||i.includes(e),o=oe(this.player.spec),l=Hs(this.player.spec);a.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,i),n(Rn.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),n(Rn.External)){this.sim.raid.setBuffs(e,t.raidBuffs||ue.create()),this.sim.raid.setDebuffs(e,t.debuffs||pe.create());const i=this.player.getParty();i&&i.setBuffs(e,t.partyBuffs||s.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(n(Rn.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||me.create()),n(Rn.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,tn.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const i=this.player.getDefaultEpRatios(o,l);if(t.epRatios){const s=new Array(i.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(s))}else this.player.setEpRatios(e,i);t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,o,l)}}}))}}function af(e,t,i){return function(e,t,i){const s=[];null!=i.talentTree&&s.push((e=>e.getTalentTree()==i.talentTree));null!=i.talentTrees&&s.push((e=>(i.talentTrees||[]).includes(e.getTalentTree())));null!=i.faction&&s.push((e=>e.getFaction()==i.faction));null!=i.customCondition&&s.push(i.customCondition);return{name:e,tooltip:i.tooltip||Sp,gear:t,enableWhen:s.length>0?e=>s.every((t=>t(e))):void 0}}(e,Nt.fromJson(t),i||{})}function nf(e,t,i){const s=[];return i&&i.customCondition&&s.push(i.customCondition),{name:e,data:t,enableWhen:s.length>0?e=>s.every((t=>t(e))):void 0}}function of(e,t,i){return rf(e,pa.create({rotation:T.fromJson(t)}),i)}function lf(e,t,i,s){return rf(e,pa.create({rotation:{type:$.TypeSimple,simple:{specRotationJson:JSON.stringify(y[t].rotationToJson(i))}}}),s)}function rf(e,t,i){const s=[];return null!=i?.talentTree&&s.push((e=>e.getTalentTree()==i.talentTree)),null!=i?.customCondition&&s.push(i.customCondition),{name:e,rotation:t,enableWhen:s.length>0?e=>s.every((t=>t(e))):void 0}}function df(e,t,i,s){return{name:e,gear:t,talents:i,rotation:s}}export{Mc as $,ld as A,tp as B,bp as C,Nc as D,cp as E,Kd as F,Kn as G,Mo as H,sp as I,Vo as J,Ao as K,Tc as L,Cn as M,jn as N,qn as O,Pn as P,$n as Q,Cc as R,Mn as S,Ac as T,Bn as U,lf as V,_o as W,Cl as X,Fo as Y,Rc as Z,Dc as _,kn as a,Vc as a0,Wc as a1,Uc as a2,Qn as a3,so as a4,Jn as a5,df as a6,kd as a7,Cd as a8,Rr as a9,ko as aa,El as ab,Sl as ac,Nl as ad,$o as ae,Lc as af,Po as ag,hl as ah,ml as ai,ul as aj,Lo as ak,To as al,Ro as am,Wo as an,Rl as ao,Dl as ap,Ml as aq,Vl as ar,kc as b,Za as c,Fp as d,Gp as e,Fn as f,En as g,Tg as h,xp as i,Wn as j,Qg as k,of as l,af as m,nf as n,ef as o,Xu as p,tn as q,Ga as r,vl as s,bl as t,xl as u,ud as v,Zd as w,Qd as x,sf as y,fl as z};
